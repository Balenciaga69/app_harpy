# Character 模組規格書

## 目標功能與範圍

### 會實現的功能

- 定義角色靜態模板
- 定義職業靜態模板
- 提供角色定義註冊表
- 提供職業定義註冊表
- 作為角色管理器與戰鬥引擎的共享資料層

### 不會實現的功能

- 角色戰鬥實例（由 Combat Engine 負責）
- 角色狀態管理（由 Combat Engine 負責）
- 角色面板 UI（由 UI 模組負責）
- 角色裝備與遺物實例（由 Inventory 模組負責）
- 裝備池管理（由 Item 模組過濾邏輯負責）

---

## 架構與元件關係

### 模組定位

角色系統的共享定義層，提供純資料模板。

### 依賴方向

- CharacterManager 使用此模組選擇與管理角色
- Combat Engine 使用此模組建立戰鬥實例
- UI 模組使用此模組顯示角色資訊
- ItemGenerator 使用職業限制過濾裝備池

### 檔案結構

- definitions 目錄包含角色與職業定義介面
- registries 目錄包含角色與職業註冊表
- errors 目錄包含錯誤處理類別

---

## 核心定義

### 角色定義

包含角色唯一識別碼、名稱、對應職業、基礎屬性。不包含大招配置，大招由玩家自由選擇。

### 職業定義

包含職業唯一識別碼、名稱、屬性修正值。不包含裝備池，裝備池由物品定義的職業限制欄位過濾。

### 裝備池過濾機制

不在職業中儲存成百上千個裝備 ID，而是在物品定義中加入職業限制欄位，生成裝備時動態過濾。

---

## 註冊表設計

### 角色定義註冊表

- 註冊與查詢角色定義
- 支援按職業查詢所有角色
- 預估規模 10-30 個角色

### 職業定義註冊表

- 註冊與查詢職業定義
- 提供所有職業列表
- 預估規模 5-10 個職業

### 錯誤處理

- 重複定義錯誤
- 定義未找到錯誤
- 使用專屬 CharacterError 類別

---

## 對外暴露的主要功能

### 類型定義

- ICharacterDefinition 角色定義介面
- IClassDefinition 職業定義介面

### 註冊表實例

- CharacterDefinitionRegistry 角色註冊表
- ClassDefinitionRegistry 職業註冊表

### 資料流程

角色管理器選擇角色定義，查詢對應職業定義，合併基礎屬性與職業修正，傳遞給戰鬥引擎建立實例。

### 想像中的運用情境

- 遊戲啟動時，註冊表會被填充（register）所有角色與職業定義。這通常在應用啟動時發生一次，例如從 JSON 檔案或硬編碼資料載入。
- 當其他模組需要角色或職業的靜態資訊時，會從註冊表查詢，而非直接建立實例。
- 註冊表儲存的是「模板」而 Combat Engine 需要的是「實例」，Combat Engine 的輸入是已經準備好的實例，它不會直接查詢註冊表，專注於戰鬥運算。
