# 遊戲機制與設計大綱（2025/12/06）(最終調整版)

## 遊戲核心概念

- 基於 RogueLite 概念，強化賭博、刺激、緊張。
- 讓玩家感覺從頭到尾都在賭。
- 玩家選擇一名角色（Character），透過管理裝備與遺物挑戰連續遭遇戰。
- 角色無等級，所有成長完全來自裝備與遺物。

## 戰鬥系統

### 1. 攻擊邏輯

- 僅分「普通攻擊」與「大招」兩種，無元素或物理魔法傷害規則之分。
- 普通攻擊有 cooldown（單位 tick），大招需能量條充滿後釋放，無 cooldown。
- 能量條由屬性決定獲取速度，並有自然回復。
- 傷害分為「一般傷害」與「真實傷害 True Damage」（無視任何減免）。
- 異常狀態獨立於元素，可被裝備、遺物影響。
- 閃避與減免機制自訂，簡化公式。

### 2. 戰鬥流程

- Tick-based 自動戰鬥，玩家僅戰前配置。
- 後端瞬間運算完畢，前端呈現為可控重播：
  - 支援任意暫停、拖動時間條、1x~3x 變速(Replay,UI負責)。
  - 玩家與敵人依冷卻時間自動行動（附加隨機延遲）。
- 戰鬥結果於載入時即決定，過程不可干預。
- 傷害流程：BeforeDamage → HitCheck → Critical → DamageModify → Defense → BeforeApply → Apply → AfterApply。
- 支援目標選擇策略（攻擊第一位、血最少、血最多等）。
- 重點行動皆進入日誌隊列供重播。

### 3. 異常狀態與效果

- 異常狀態機制仍在構思，可能大改。
- 聖火、充能、冰緩、毒等有各自疊加與觸發規則。
- 無屬性異常如致盲、破甲、出血、褻瀆等。
- 部分裝備、遺物可改變異常狀態計算方式或效果。

### 4. 戰鬥內復活（死亡檢查）

- 血量歸零進入死亡檢查。
- 依屬性提供起死回生概率（3%~50%），復活後恢復 10%~100% 血量。
- 復活後異常狀態全部清除。

### 5. 賽前變數

- 進入戰鬥前有 1~n 個賽前變數注入階段。
- 效果通常影響雙方，例如開局皆受 16 層 Chill、復活率提升 20%、大招充能效率 ×30% 等。
- 玩家可以花錢 reroll 賽前變數。(但很貴。)

### 6. 賽前博弈（血量區間下注）

- 玩家下注勝利時剩餘血量區間：
  - 1-10%（8 倍）
  - 11-30%（4 倍）
  - 31-60%（2 倍）
  - 61-100%（1.2 倍）
- 猜中獲得對應倍率金幣，猜錯僅得基礎獎勵，沒收賭金。
- 賭金通常是玩家總資產的 %，而非固定金額。

## 角色系統

- 角色為模板，僅提供基礎數值與職業標籤，無等級。
- 職業決定專屬裝備池與部分遺物生成權重。
- 角色資訊面板顯示完整計算後屬性、裝備、遺物、大招。

## 裝備與遺物系統

### 1. 屬性分層

- 防禦：HP、護甲（%減傷）、閃避。
- 攻擊：攻擊力、攻擊冷卻、暴擊率、命中值、攻擊標籤。
- 機制：大招充能效率、復活率等。

### 2. 裝備與遺物差異

- 裝備：每類僅裝備一件（武器、頭盔、裝甲、項鍊、鞋子等），可放入倉庫或售出。
- 遺物：可無限堆疊，僅可穿戴或售出。
- 兩者皆為 Modifier 容器，無固定屬性類型。
- 裝備無升級系統，過時即淘汰。

### 3. 裝備稀有度與生成

- 稀有度：普通、魔法、稀有、傳說（可擴充）。
- 生成依賴獨立物品生成系統，受職業與當前難度係數影響。

### 4. 倉庫機制

- 倉庫無數量限制。
- 倉庫內裝備不再強制變現。

## 難度係數

- 依關卡層數計算。
- 決定敵人與玩家可獲得裝備、遺物強度。
- 敵人同樣穿戴由難度係數生成的裝備與遺物。

## 關卡與進程

- 每 10 關為一章節，共 10 個遭遇節點。
- 敵人資訊完全未知，僅顯示威脅等級。
- 第 5 關為中型 Boss，第 10 關為大型 Boss。
- 路線為直線向上，每戰勝利後提供 2 條可預覽的分支路線（內含 1~3 個事件）。
- 分支獎勵高度分化。
- 超過 30 關進入無盡模式。

## 商店與賭博

- 商店常駐，每戰勝利後刷新商品。
- 功能：購買、出售、拉霸機賭博。
- 出售價格為原價打折。
- 大章節推進後，商品價格與賭博最低注額提升。
- 角色真死（Run 失敗）後，商店永久通膨（商品價格與賭博費用進一步提高）。

## 失敗與重試

- 戰鬥內復活失敗 → 進入 Run 失敗檢查。
- 若持有續命道具（極稀有、極昂貴或需支付當前所有金幣），消耗後由商店老闆 Clone 角色，保留全部裝備遺物，並獲得一次免費賭博 + 商店刷新。
- 無續命手段則本 Run 結束。
- 允許自由 save & load。

## 新的一輪遊戲流程

- 選擇角色模板（決定職業與初始裝備）。
- 進入章節，顯示 10 個未知威脅等級節點。
- 每戰前可進入商店、下注血量區間、觸發賽前變數。
- 戰鬥自動進行，重播可任意拖動與變速。
- 勝利按下注結算倍率金幣，失敗進入 Run 失敗檢查。

## 個人偏好命名（保持可移植性）

### 正面例子

- Character、Entity、Creature、Combat、Encounter、Run、Equipment、Relic、Inventory、Shop 等。

### 反面例子（禁用）

- Gladiator、Noble、Arena 等綁定競技場詞彙。

## 模組分割（調整後）

### 後端純運算模組

- [幾乎完工]CombatEngine（瞬間運算戰鬥 + 返回戰鬥日誌）
- CharacterModifierSystem (角色身上的基礎詞綴計算模組)
- DifficultyScaler (難度係數計算模組)
- ItemGenerator (獨立物品生成模組)
- EnemyGenerator (敵人生成模組)

### 後端遊戲模組(他們共用同的 EventBus)

- CharacterManager: 角色管理與面板展示
- Encounter: 關卡地圖、房間、事件生成的控制器
- PreCombat: 賽前事宜準備模組
- Shop: 商店邏輯模組
- ShopGambling: 賭博模組
- Inventory: 背包／倉庫管理模組
- Run(RunOrchestrator): 關卡進程控制模組
- PersistentStorage (存讀檔模組)

### 前端模組

- [幾乎完工]Replay: 戰鬥重播模組 (含時間條控制)
