---
applyTo: '**'
---

Provide project context and coding guidelines that AI should follow when generating code, answering questions, or reviewing changes.

# 遊戲機制與設計大綱（2025/12/01）

## 遊戲核心概念

- 單機即時制戰鬥 Roguelite，玩家配置角色、裝備、技能，挑戰層層關卡。
- 戰鬥以 tick 為單位，自動進行，玩家僅於戰前配置與選擇技能。Replay 的時候是以 1x速度播放，同時10ms = 1tick。
- 具備裝備、大絕招、遺物等多元養成與策略選擇。

## 戰鬥系統

### 1. 攻擊邏輯

- 僅分「普通攻擊」與「大招」兩種，無元素傷害規則。
- 普通攻擊有 cooldown（等待時間，單位 tick），大招需能量條充滿後釋放，無 cooldown。
- 能量條由角色屬性決定獲取速度，並有自然回復。
- 傷害分為「一般傷害」與「真實傷害 True Damage」（無視任何減免）。
- 異常狀態（聖火、燃燒、中毒、充能等）獨立於元素屬性，並可被裝備、角色、聖物等影響。
- 閃避與減免機制自訂，簡化公式，避免複雜計算。

### 2. 戰鬥流程

- 玩家與敵人依據冷卻時間自動執行行動。
- 主攻擊僅能有一種（武器或法術），法術必中、無暴擊，武器有命中與暴擊判定。
- 戰鬥結果於載入時即決定，過程不可干預。

### 3. 異常狀態與效果

- 異常狀態機制目前還在構思，可能會大改動
- 聖火、充能、冰緩、毒等異常狀態有各自疊加、減少、觸發規則。
- 無屬性異常如致盲、破甲、出血、褻瀆等，影響命中、護甲、生命等。
- 部分裝備、聖物可改變異常狀態的計算方式或效果。

## 角色與裝備系統

### 1. 屬性分層

- 防禦：HP、護甲（%減傷）、閃避（與命中值運算）。
- 攻擊：攻擊力、冷卻、暴擊率、命中值、攻擊標籤。

### 2. 裝備分類與機制

- 武器（或魔法書）、頭盔、裝甲、項鍊。
- 其實本質上都是遺物(Items)，只不過遺物可以無限堆疊，但裝備武器只能裝備一個。
- 遺物物品可能改變遊戲玩法，所以需要複雜運算鍊。
- 裝備有升級系統

## 關卡與進程

- 關卡分一般、小型 Boss、大型 Boss、正面事件。
- 層數遞增，怪物屬性依難度係數調整。
- 最高 30 關，每 5 關有中型 Boss，每 10 關有大型 Boss。
- 超過 30 關，則進入無盡模式，難度持續提升。

## 掉落與商店

- 每關結束可三選一獎勵（裝備、遺物）。
- 商店可隨時進入，購買物品。
- 物品價格被係數控制，隨關卡提升而通膨。

## 死亡與重試

- 玩家有 n 次死亡機會，失敗將回到戰鬥前，並且商店老闆會給你一個抽獎盲盒作為補償並刷新商店內容。

## 模組分割

- CombatEngine: 戰鬥運算回傳結果與日誌、武器效果等等運算都集中在此
- Replay: 基於日誌與快照驅動的日誌控制邏輯
- GameManager: 管理從第 1 層到第 n 層的完整流程，處理死亡、存檔、場景切換。
- Encounter: 生成敵人、商店、偶遇事件等等與路線三選一等等
- EquipmentModule: 生成裝備
- RewardModule: 負責生成獎勵物品、Reward, Loot 等等
- EventModule: 生成偶遇事件
- CreatureModule: 生成戰鬥敵人、角色等等
- InventoryModule: 管理玩家背包
- ShopModule: 生成商店邏輯
- PersistentStorageModule: 存與讀檔案
