# Ultimate ç³»çµ±è¨­è¨ˆè¨è«–å ±å‘Š

## ğŸ“‹ æœƒè­°è³‡è¨Š

- **æ—¥æœŸ**: 2025-12-01
- **åƒèˆ‡è€…**: PM (ç”¢å“ç¶“ç†) | Tech Lead (æŠ€è¡“ä¸»ç®¡) | Client (æ¥­ä¸»)
- **è­°é¡Œ**: Ultimate (å¤§æ‹›) ç³»çµ±åœ¨ Combat Module ä¸­çš„å®šä½èˆ‡è¨­è¨ˆæ–¹å‘

---

## ğŸ¯ è¨è«–ç›®æ¨™

1. æ˜ç¢º Ultimate åœ¨éŠæˆ²æ©Ÿåˆ¶ä¸­çš„å®šä½
2. ç¢ºèª Ultimate èˆ‡å…¶ä»–ç³»çµ± (Effect, Equipment) çš„é—œä¿‚
3. è©•ä¼°ç•¶å‰æŠ€è¡“å¯¦ä½œçš„åˆç†æ€§
4. è¦åŠƒæœªä¾†æ“´å±•æ–¹å‘

---

## ğŸ’¼ æ¥­ä¸»è¦–è§’ (Client Perspective)

### æœŸæœ›åŠŸèƒ½

> **æ¥­ä¸»**: "æˆ‘å¸Œæœ›ç©å®¶èƒ½æ„Ÿå—åˆ°è§’è‰²çš„ç¨ç‰¹æ€§ï¼Œå¤§æ‹›æ‡‰è©²æ˜¯è§’è‰²çš„æ¨™èªŒæ€§æŠ€èƒ½ï¼Œèƒ½æ‰­è½‰æˆ°å±€ã€‚"

**æ ¸å¿ƒéœ€æ±‚**:

- âœ… æ¯å€‹è§’è‰²æœ‰ç¨ç‰¹çš„å¤§æ‹›æŠ€èƒ½
- âœ… å¤§æ‹›éœ€è¦èƒ½é‡/æ¢ä»¶è§¸ç™¼ï¼Œä¸èƒ½ç„¡é™ä½¿ç”¨
- âœ… å¤§æ‹›æ•ˆæœæ‡‰è©²æ¯”æ™®é€šæ”»æ“Šæ›´å¼·å¤§
- âœ… ç©å®¶æ‡‰è©²èƒ½é€ééŠæˆ²é€²ç¨‹è§£é–/å‡ç´šå¤§æ‹›

### éŠæˆ²æ€§æœŸæœ›

1. **å·®ç•°åŒ–**: ä¸åŒè§’è‰²çš„å¤§æ‹›æ‡‰è©²æœ‰æ˜é¡¯å€åˆ¥ (å‚·å®³å‹ã€æ§å ´å‹ã€å¢ç›Šå‹)
2. **ç­–ç•¥æ€§**: ç©å®¶éœ€è¦åˆ¤æ–·ä½•æ™‚é‡‹æ”¾å¤§æ‹› (èƒ½é‡ç®¡ç†)
3. **æˆé•·æ€§**: å¤§æ‹›å¯ä»¥é€éå‡ç´šã€è£å‚™ã€è–ç‰©å¼·åŒ–
4. **è¦–è¦ºè¡æ“Š**: å¤§æ‹›é‡‹æ”¾æ‡‰è©²æœ‰æ˜é¡¯çš„å‹•ç•«/ç‰¹æ•ˆ (æœªä¾† UI éœ€æ±‚)

---

## ğŸ“Š ç”¢å“ç¶“ç†è¦–è§’ (PM Perspective)

### ç³»çµ±å®šä½åˆ†æ

| ç³»çµ±          | æ€§è³ª     | è§¸ç™¼æ–¹å¼  | å¯æ›¿æ›æ€§       | æ•¸é‡é™åˆ¶        |
| ------------- | -------- | --------- | -------------- | --------------- |
| **Effect**    | è‡¨æ™‚ç‹€æ…‹ | è¢«å‹•/è‡ªå‹• | âœ… å‹•æ…‹å¢æ¸›    | âŒ ç„¡é™åˆ¶       |
| **Equipment** | æ°¸ä¹…å±¬æ€§ | è¢«å‹•ç”Ÿæ•ˆ  | âœ… å¯è£å‚™/å¸ä¸‹ | âš ï¸ å—è£å‚™æ¬„é™åˆ¶ |
| **Ultimate**  | ä¸»å‹•æŠ€èƒ½ | ä¸»å‹•é‡‹æ”¾  | âš ï¸ **å¾…å®š**    | âœ… æ¯è§’è‰² 1 å€‹  |

### æ ¸å¿ƒå•é¡Œ

**Q1: Ultimate æ‡‰è©²æ˜¯ã€Œå›ºå®šã€é‚„æ˜¯ã€Œå¯æ›¿æ›ã€ï¼Ÿ**

**é¸é … A: å›ºå®šç¶å®šè§’è‰²** (é¡ä¼¼ MOBA è‹±é›„æŠ€èƒ½)

- âœ… å„ªé»: å¼·åŒ–è§’è‰²è¾¨è­˜åº¦ï¼Œè¨­è¨ˆæ›´èšç„¦
- âŒ ç¼ºé»: æ¸›å°‘ç©æ³•å¤šæ¨£æ€§ï¼Œé‡è¤‡éŠç©åƒ¹å€¼é™ä½

**é¸é … B: å¯æ›¿æ›æ’æ‹”** (é¡ä¼¼è£å‚™ç³»çµ±)

- âœ… å„ªé»: ç©æ³•éˆæ´»ï¼Œå¯é€éæŠ€èƒ½æ›¸/é“å…·è§£é–æ–°å¤§æ‹›
- âŒ ç¼ºé»: è§’è‰²ç‰¹è‰²æ¨¡ç³Šï¼Œå¹³è¡¡æ€§é›£åº¦æé«˜

**PM å»ºè­°**:

> **æ··åˆæ¨¡å¼** - æ¯å€‹è§’è‰²æœ‰ã€Œé è¨­å¤§æ‹›ã€ï¼Œä½†å¯é€éç¨€æœ‰é“å…· (æŠ€èƒ½æ›¸) æ›¿æ›ç‚ºã€Œè®Šé«”å¤§æ‹›ã€ã€‚
>
> ç¯„ä¾‹: æˆ°å£«é è¨­ã€Œç‹‚æš´æ–¬æ“Šã€ï¼Œå¯æ›¿æ›ç‚ºã€Œé›·éœ†è¡æ“Šã€(åŒæ¨£æ˜¯å‚·å®³å‹ï¼Œä½†æ©Ÿåˆ¶ä¸åŒ)

---

**Q2: Ultimate èˆ‡ Effect çš„é—œä¿‚ï¼Ÿ**

**ç¾æ³è§€å¯Ÿ**:

```typescript
// ThunderStrikeUltimate æœƒæ–½åŠ  ChargeEffect
const chargeEffect = new ChargeEffect(this.chargeStacks)
caster.addEffect(chargeEffect, context)
```

**PM è§€é»**:

- âœ… Ultimate å¯ä»¥**è§¸ç™¼** Effect (å¦‚é‡‹æ”¾å¤§æ‹›å¾Œçµ¦è‡ªå·±ä¸Š Buff)
- âœ… Ultimate å¯ä»¥**å—ç›Šæ–¼** Effect (å¦‚å……èƒ½æ•ˆæœæå‡å¤§æ‹›å‚·å®³)
- âŒ Ultimate **ä¸æ‡‰è©²æ˜¯** Effect (å…©è€…è§¸ç™¼æ©Ÿåˆ¶å®Œå…¨ä¸åŒ)

**çµè«–**: Ultimate æ˜¯**æ•ˆæœçš„ç”Ÿç”¢è€…**ï¼Œè€Œéæ•ˆæœæœ¬èº«ã€‚

---

**Q3: èƒ½é‡ç³»çµ±å¦‚ä½•è¨­è¨ˆï¼Ÿ**

**ç•¶å‰å•é¡Œ**: ç›®å‰æ²’æœ‰èƒ½é‡/å†·å»æ©Ÿåˆ¶ï¼Œå¤§æ‹›å¯ä»¥ç„¡é™é‡‹æ”¾ã€‚

**å»ºè­°æ–¹æ¡ˆ**:

| æ–¹æ¡ˆ             | æ©Ÿåˆ¶                               | ç¯„ä¾‹éŠæˆ²            |
| ---------------- | ---------------------------------- | ------------------- |
| **èƒ½é‡æ¢ç³»çµ±**   | æ”»æ“Š/å—æ“Šç´¯ç©èƒ½é‡ï¼Œæ»¿ 100 å¯é‡‹æ”¾   | Overwatch, Valorant |
| **å†·å»æ™‚é–“ç³»çµ±** | é‡‹æ”¾å¾Œé€²å…¥å†·å»ï¼ŒX å›åˆå¾Œå¯å†æ¬¡ä½¿ç”¨ | League of Legends   |
| **æ··åˆç³»çµ±**     | éœ€è¦èƒ½é‡ + å†·å»éƒ½æ»¿è¶³              | Dota 2 (éƒ¨åˆ†è‹±é›„)   |

**PM å»ºè­°**: å…ˆå¯¦ä½œ**èƒ½é‡æ¢ç³»çµ±** (ç°¡å–®ä¸”ç¬¦åˆæ¥­ä¸»æœŸæœ›)

---

## ğŸ”§ æŠ€è¡“ä¸»ç®¡è¦–è§’ (Tech Lead Perspective)

### ç•¶å‰å¯¦ä½œåˆ†æ

**ç¾æœ‰æ¶æ§‹**:

```typescript
// IUltimateOwner (Character ä»‹é¢çš„ä¸€éƒ¨åˆ†)
interface IUltimateOwner {
  getUltimate(): unknown | undefined // âŒ é¡å‹ä¸å®‰å…¨
  setUltimate(ultimate: unknown): void
}

// IUltimateAbility (ç­–ç•¥ä»‹é¢)
interface IUltimateAbility {
  readonly id: string
  readonly name: string
  readonly description: string
  readonly type: 'damage' | 'buff' | 'hybrid'
  execute(caster: ICharacter, context: CombatContext): void
}
```

**æŠ€è¡“å•é¡Œ**:

1. âŒ **é¡å‹ä¸å®‰å…¨**: `IUltimateOwner` ä½¿ç”¨ `unknown`ï¼Œå¤±å» TypeScript é¡å‹æª¢æŸ¥
2. âš ï¸ **èƒ½é‡ç³»çµ±ç¼ºå¤±**: ç„¡æ³•é™åˆ¶å¤§æ‹›ä½¿ç”¨é »ç‡
3. âš ï¸ **ç›®æ¨™é¸æ“‡è€¦åˆ**: æ¯å€‹ Ultimate éƒ½è¦è‡ªå·±å¯¦ä½œç›®æ¨™é¸æ“‡é‚è¼¯ (é‡è¤‡ä»£ç¢¼)
4. âœ… **ç­–ç•¥æ¨¡å¼æ­£ç¢º**: ä½¿ç”¨ `IUltimateAbility` ä»‹é¢ï¼Œç¬¦åˆé–‹æ”¾å°é–‰åŸå‰‡

### æŠ€è¡“å»ºè­°

#### ä¿®æ­£ 1: ä¿®å¾©é¡å‹å®‰å…¨

```typescript
import type { IUltimateAbility } from '../../../coordination'

export interface IUltimateOwner {
  getUltimate(): IUltimateAbility | undefined
  setUltimate(ultimate: IUltimateAbility): void
}
```

**ç†ç”±**:

- âœ… é¿å…é¡å‹éŒ¯èª¤
- âœ… æä¾› IDE è‡ªå‹•å®Œæˆ
- âœ… ä¸æœƒé€ æˆå¾ªç’°ä¾è³´ (domain â†’ coordination æ˜¯åˆç†çš„å–®å‘ä¾è³´)

---

#### ä¿®æ­£ 2: å¼•å…¥èƒ½é‡ç³»çµ±

**é¸é … A: èƒ½é‡å±¬æ€§åŒ–** (ç°¡å–®)

```typescript
// åœ¨ AttributeCore ä¸­åŠ å…¥
export const AttributeCore = {
  // ...existing attributes...
  ultimateEnergy: 0, // ç•¶å‰èƒ½é‡
  ultimateMaxEnergy: 100, // æœ€å¤§èƒ½é‡
  ultimateEnergyCost: 100, // é‡‹æ”¾æ¶ˆè€—
} as const
```

**å„ªé»**:

- âœ… ç„¡éœ€æ–°å¢ç³»çµ±ï¼Œç›´æ¥ä½¿ç”¨ç¾æœ‰å±¬æ€§æ©Ÿåˆ¶
- âœ… Effect å¯ä»¥ä¿®æ”¹èƒ½é‡ç›¸é—œå±¬æ€§ (å¦‚ã€Œå¿«é€Ÿå……èƒ½ã€Buff)

**ç¼ºé»**:

- âŒ èƒ½é‡èˆ‡ HP/æ”»æ“ŠåŠ›æ··åœ¨ä¸€èµ·ï¼Œæ¦‚å¿µä¸æ¸…æ™°

---

**é¸é … B: ç¨ç«‹èƒ½é‡ç®¡ç†å™¨** (æ›´ä¹¾æ·¨)

```typescript
/** èƒ½é‡ç®¡ç†å™¨ */
class EnergyManager {
  private current: number = 0
  private max: number = 100

  /** å¢åŠ èƒ½é‡ */
  gain(amount: number): void {
    this.current = Math.min(this.current + amount, this.max)
  }

  /** æ¶ˆè€—èƒ½é‡ */
  consume(amount: number): boolean {
    if (this.current >= amount) {
      this.current -= amount
      return true
    }
    return false
  }

  /** æª¢æŸ¥æ˜¯å¦å¯é‡‹æ”¾ */
  canCast(cost: number): boolean {
    return this.current >= cost
  }
}

// Character ä¸­åŠ å…¥
class Character {
  private energyManager: EnergyManager

  /** æª¢æŸ¥å¤§æ‹›æ˜¯å¦å¯é‡‹æ”¾ */
  canCastUltimate(): boolean {
    const ultimate = this.getUltimate()
    return ultimate && this.energyManager.canCast(ultimate.energyCost)
  }
}
```

**å„ªé»**:

- âœ… è·è²¬åˆ†é›¢ï¼Œç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡
- âœ… æœªä¾†å¯æ“´å±• (å¦‚å†·å»ç³»çµ±ã€å……èƒ½é€Ÿç‡)

**ç¼ºé»**:

- âŒ å¢åŠ è¤‡é›œåº¦

**Tech Lead å»ºè­°**: å…ˆç”¨**é¸é … A** (å±¬æ€§åŒ–)ï¼Œå¦‚æœæœªä¾†éœ€æ±‚è¤‡é›œåŒ–å†é‡æ§‹ç‚º**é¸é … B**

---

#### ä¿®æ­£ 3: ç›®æ¨™é¸æ“‡å™¨çµ±ä¸€åŒ–

**å•é¡Œç¯„ä¾‹**:

```typescript
// æ¯å€‹ Ultimate éƒ½è¦è‡ªå·±å¯«ç›®æ¨™é¸æ“‡
const enemyTeam = caster.team === 'player' ? 'enemy' : 'player'
const enemies = context.getEntitiesByTeam(enemyTeam)
const aliveEnemies = enemies.filter((e) => 'isDead' in e && !e.isDead)
const selector = new FirstAliveSelector()
const target = selector.selectTarget(caster, aliveEnemies)
```

**å»ºè­°é‡æ§‹**:

```typescript
/** Ultimate åŸºç¤é¡åˆ¥ */
abstract class BaseUltimate implements IUltimateAbility {
  abstract readonly id: string
  abstract readonly name: string
  abstract readonly type: 'damage' | 'buff' | 'hybrid'

  /** ç²å–æ•µæ–¹ç›®æ¨™ */
  protected getEnemyTargets(caster: ICharacter, context: CombatContext): ICharacter[] {
    const enemyTeam = caster.team === 'player' ? 'enemy' : 'player'
    return context
      .getEntitiesByTeam(enemyTeam)
      .filter(isCharacter)
      .filter((c) => !c.isDead)
  }

  /** ç²å–å‹æ–¹ç›®æ¨™ */
  protected getAllyTargets(caster: ICharacter, context: CombatContext): ICharacter[] {
    return context
      .getEntitiesByTeam(caster.team)
      .filter(isCharacter)
      .filter((c) => !c.isDead)
  }

  abstract execute(caster: ICharacter, context: CombatContext): void
}

// ç°¡åŒ–å¯¦ä½œ
class ThunderStrikeUltimate extends BaseUltimate {
  execute(caster: ICharacter, context: CombatContext): void {
    const enemies = this.getEnemyTargets(caster, context)
    const target = new FirstAliveSelector().selectTarget(caster, enemies)
    // ...
  }
}
```

---

### æ¶æ§‹å±¤ç´šç¢ºèª

**ç•¶å‰ä½ç½®**: `coordination/ability/models/` âœ…

**ä¾è³´æª¢æŸ¥**:

```
Ultimate (coordination å±¤)
  â†“ ä¾è³´
character, effect, damage, context (domain + logic å±¤)
```

**çµè«–**: âœ… ä¾è³´æ–¹å‘æ­£ç¢ºï¼Œç„¡å¾ªç’°ä¾è³´

---

## ğŸ¨ ç³»çµ±è¨­è¨ˆæ–¹å‘å»ºè­°

### çŸ­æœŸç›®æ¨™ (v0.3)

1. **ä¿®å¾©é¡å‹å®‰å…¨** âœ… å„ªå…ˆç´š: ğŸ”´ é«˜
   - ä¿®æ­£ `IUltimateOwner` çš„ `unknown` é¡å‹

2. **å¼•å…¥èƒ½é‡ç³»çµ±** âœ… å„ªå…ˆç´š: ğŸŸ¡ ä¸­
   - åœ¨ `AttributeCore` åŠ å…¥èƒ½é‡ç›¸é—œå±¬æ€§
   - åœ¨ `AbilitySystem` åŠ å…¥èƒ½é‡æª¢æŸ¥é‚è¼¯

3. **é‡æ§‹ç›®æ¨™é¸æ“‡** âœ… å„ªå…ˆç´š: ğŸŸ¢ ä½
   - å»ºç«‹ `BaseUltimate` æŠ½è±¡é¡åˆ¥
   - æ¶ˆé™¤é‡è¤‡ä»£ç¢¼

---

### ä¸­æœŸç›®æ¨™ (v0.4-v0.5)

1. **å¯æ›¿æ›å¤§æ‹›ç³»çµ±**
   - æŠ€èƒ½æ›¸é“å…·ç³»çµ± (å¯å­¸ç¿’æ–°å¤§æ‹›)
   - å¤§æ‹›å‡ç´šç³»çµ± (æå‡å‚·å®³/æ•ˆæœ)

2. **å¤§æ‹›é¡å‹æ“´å±•**
   - æ§å ´å‹: çœ©æšˆã€æ¸›é€Ÿã€æ²‰é»˜
   - å¢ç›Šå‹: ç¾¤é«”åŠ æ”»ã€è­·ç›¾ã€æ²»ç™‚
   - ç‰¹æ®Šå‹: å¾©æ´»ã€æ™‚å…‰å€’æµã€å‚³é€

3. **ç¨ç«‹èƒ½é‡ç®¡ç†å™¨**
   - å¦‚æœèƒ½é‡æ©Ÿåˆ¶è®Šè¤‡é›œ (å¤šèƒ½é‡æ§½ã€å……èƒ½é€Ÿç‡),å‰‡é‡æ§‹ç‚º `EnergyManager`

---

### é•·æœŸç›®æ¨™ (v1.0)

1. **å¤§æ‹›é€£æ”œç³»çµ±**
   - å¤šå€‹è§’è‰²å¤§æ‹›çµ„åˆè§¸ç™¼ç‰¹æ®Šæ•ˆæœ

2. **å¤§æ‹›è‡ªè¨‚ç³»çµ±**
   - ç©å®¶å¯èª¿æ•´å¤§æ‹›åƒæ•¸ (å‚·å®³å€ç‡ vs å†·å»æ™‚é–“)

3. **AI å¤§æ‹›æ±ºç­–**
   - æ•µæ–¹ AI åˆ¤æ–·æœ€ä½³å¤§æ‹›é‡‹æ”¾æ™‚æ©Ÿ

---

## ğŸ“ çµè«–èˆ‡è¡Œå‹•é …

### æœƒè­°å…±è­˜

1. âœ… **Ultimate å®šä½**: ä¸»å‹•æŠ€èƒ½ï¼Œå¯æ’æ‹” (é¡ä¼¼è£å‚™)ï¼Œä½†æ¯è§’è‰²é è¨­ä¸€å€‹
2. âœ… **èˆ‡ Effect é—œä¿‚**: Ultimate æ˜¯æ•ˆæœçš„**ç”Ÿç”¢è€…**ï¼Œè€Œéæ•ˆæœæœ¬èº«
3. âœ… **èƒ½é‡ç³»çµ±**: å…ˆä½¿ç”¨å±¬æ€§åŒ–æ–¹æ¡ˆï¼Œæœªä¾†è¦–éœ€æ±‚é‡æ§‹
4. âœ… **ç•¶å‰æ¶æ§‹**: åŸºæœ¬åˆç†ï¼Œåƒ…éœ€ä¿®å¾©é¡å‹å®‰å…¨å•é¡Œ

---

### Action Items

| ä»»å‹™                         | è² è²¬äºº    | å„ªå…ˆç´š | é è¨ˆå®Œæˆ |
| ---------------------------- | --------- | ------ | -------- |
| ä¿®å¾© `IUltimateOwner` é¡å‹   | Tech Lead | ğŸ”´ é«˜  | v0.3     |
| å¼•å…¥èƒ½é‡å±¬æ€§                 | Tech Lead | ğŸŸ¡ ä¸­  | v0.3     |
| å»ºç«‹ `BaseUltimate` åŸºç¤é¡åˆ¥ | Tech Lead | ğŸŸ¢ ä½  | v0.4     |
| è¨­è¨ˆæŠ€èƒ½æ›¸ç³»çµ±               | PM        | ğŸŸ¡ ä¸­  | v0.4     |
| å¤§æ‹› UI/ç‰¹æ•ˆè¨­è¨ˆ             | UI/UX     | ğŸŸ¢ ä½  | v0.5     |

---

### é¢¨éšªæç¤º

âš ï¸ **å¹³è¡¡æ€§é¢¨éšª**: å¯æ›¿æ›å¤§æ‹›å¯èƒ½å°è‡´æŸäº›çµ„åˆéå¼·ï¼Œéœ€è¦æŒçºŒèª¿æ•´
âš ï¸ **è¤‡é›œåº¦é¢¨éšª**: èƒ½é‡ç³»çµ±ã€å†·å»ç³»çµ±ã€å‡ç´šç³»çµ±ç–ŠåŠ å¯èƒ½è®“æ–°æ‰‹å›°æƒ‘
âš ï¸ **æ€§èƒ½é¢¨éšª**: å¦‚æœå¤§æ‹›ç‰¹æ•ˆéæ–¼è¤‡é›œï¼Œå¯èƒ½å½±éŸ¿æˆ°é¬¥æµæš¢åº¦

---

## ğŸ“š åƒè€ƒè³‡æ–™

- [ç­–ç•¥æ¨¡å¼ (Strategy Pattern)](https://refactoring.guru/design-patterns/strategy)
- [çµ„åˆå„ªæ–¼ç¹¼æ‰¿ (Composition over Inheritance)](https://en.wikipedia.org/wiki/Composition_over_inheritance)
- [SOLID åŸå‰‡](https://en.wikipedia.org/wiki/SOLID)

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-01  
**ä¸‹æ¬¡å¯©æŸ¥**: v0.3 é‡‹å‡ºå¾Œ
