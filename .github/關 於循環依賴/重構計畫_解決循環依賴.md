# Combat æ¨¡çµ„å¾ªç’°ä¾è³´é‡æ§‹è¨ˆç•«

## ğŸ¯ ç›®æ¨™

**å¾¹åº•æ¶ˆé™¤æ‰€æœ‰å¾ªç’°ä¾è³´ï¼Œä¿æŒè¨­è¨ˆç†å¿µä¸è®Š**

---

## ğŸ“‹ é‡æ§‹è¨ˆç•«ç¸½è¦½

### éšæ®µ 1ï¼šå¿«é€Ÿä¿®å¾©ï¼ˆç«‹å³åŸ·è¡Œï¼Œ1-2 å°æ™‚ï¼‰

- âœ… ä¿®æ­£ barrel exports
- âœ… æ‰“ç ´æ‰€æœ‰å¾ªç’°ä¾è³´
- âœ… ä¿æŒåŠŸèƒ½ä¸è®Š

### éšæ®µ 2ï¼šå„ªåŒ–åˆ†å±¤ï¼ˆå¯é¸ï¼Œ2-4 å°æ™‚ï¼‰

- ğŸ“Š æå‡å…±äº«æ¥å£
- ğŸ“Š å„ªåŒ–ä¾è³´æ–¹å‘
- ğŸ“Š æ·»åŠ æ¶æ§‹æ–‡æª”

### éšæ®µ 3ï¼šæŒçºŒç›£æ§ï¼ˆé•·æœŸï¼‰

- ğŸ”§ æ·»åŠ æª¢æ¸¬å·¥å…·
- ğŸ”§ è¨­ç½® Git Hooks
- ğŸ”§ ä»£ç¢¼å¯©æŸ¥è¦ç¯„

---

## ğŸš€ éšæ®µ 1ï¼šå¿«é€Ÿä¿®å¾©ï¼ˆæ¨è–¦ç«‹å³åŸ·è¡Œï¼‰

### æ ¸å¿ƒç­–ç•¥

**åŸå‰‡**ï¼š`index.ts` åªå°å‡ºå…¬å…± APIï¼Œå…§éƒ¨æ¨¡çµ„ç›´æ¥ import

### æ­¥é©Ÿ 1.1ï¼šä¿®æ­£ `domain/character/index.ts`

**ç•¶å‰å•é¡Œ**ï¼šå°å‡ºæ‰€æœ‰å…§å®¹ï¼Œå°è‡´å¾ªç’°

#### å¯¦éš›æ“ä½œï¼š

```typescript
// ğŸ“ src/modules/combat/domain/character/index.ts

// === åˆªé™¤ä»¥ä¸‹å…§å®¹ ===
// export * from './attribute.calculator'
// export * from './attribute.container'
// export * from './character'
// export * from './character.templates'
// export * from './interfaces'
// export * from './models'

// === æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ ===

// å…¬å…±é¡ï¼ˆçµ¦å¤–éƒ¨ä½¿ç”¨ï¼‰
export { Character } from './character'

// è§’è‰²æ¨¡æ¿å·¥å» å‡½æ•¸ï¼ˆçµ¦å¤–éƒ¨ä½¿ç”¨ï¼‰
export { createWarrior, createMage } from './character.templates'

// å…¬å…±æ¥å£ï¼ˆé¡å‹å®šç¾©ï¼‰
export type { ICharacter, CharacterId, CharacterSnapshot } from './interfaces/character.interface'

export type { IAttributeProvider } from './interfaces/attribute.provider.interface'

export type { IEffectOwner } from './interfaces/effect.owner.interface'

export type { IUltimateOwner } from './interfaces/ultimate.owner.interface'

// å…¬å…±é¡å‹ï¼ˆå±¬æ€§ç›¸é—œï¼‰
export type { AttributeType, AttributeCategory } from './models/attribute.core.model'

export type { AttributeModifier } from './models/attribute.modifier.model'

export type { BaseAttributeValues } from './models/base.attribute.values.model'

// æ³¨æ„ï¼šAttributeContainer å’Œ AttributeCalculator æ˜¯å…§éƒ¨å¯¦ç¾ï¼Œä¸å°å‡º
// æ³¨æ„ï¼šEffectManager ä¹Ÿæ˜¯å…§éƒ¨å¯¦ç¾ï¼Œä¸å°å‡º
```

**ç‚ºä»€éº¼é€™æ¨£æ”¹ï¼Ÿ**

- âœ… åªå°å‡ºã€Œéœ€è¦è¢«å¤–éƒ¨ä½¿ç”¨ã€çš„æ±è¥¿
- âœ… `AttributeContainer`ã€`AttributeCalculator`ã€`EffectManager` æ˜¯ `Character` çš„å…§éƒ¨å¯¦ç¾ç´°ç¯€ï¼Œä¸æ‡‰è©²æš´éœ²
- âœ… æ‰“ç ´äº†èˆ‡ `coordination` çš„å¾ªç’°

---

### æ­¥é©Ÿ 1.2ï¼šä¿®æ­£ `coordination/index.ts`

**ç•¶å‰å•é¡Œ**ï¼šå°å‡ºæ‰€æœ‰ modelsï¼ŒåŒ…æ‹¬å…·é«”å¯¦ç¾é¡

#### å¯¦éš›æ“ä½œï¼š

```typescript
// ğŸ“ src/modules/combat/coordination/index.ts

// === åˆªé™¤ä»¥ä¸‹å…§å®¹ ===
// export * from './ability.system'
// export * from './factories'
// export * from './models'
// export * from './target-select-strategies'

// === æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ ===

// å…¬å…±ç³»çµ±é¡
export { AbilitySystem } from './ability.system'

// å…¬å…±æ¥å£ï¼ˆæœ€é‡è¦ï¼ï¼‰
export type { IUltimateAbility } from './models/ultimate.ability.interface'

// ç›®æ¨™é¸æ“‡å™¨æ¥å£
export type { ITargetSelector } from './target-select-strategies/target.selector.interface'

// å…·é«”çš„ç›®æ¨™é¸æ“‡å™¨å¯¦ç¾ï¼ˆé€™äº›å¯ä»¥å°å‡ºï¼Œå› ç‚ºæ˜¯å·¥å…·é¡ï¼‰
export { FirstAliveSelector, LowestHealthSelector } from './target-select-strategies'

// æ³¨æ„ï¼šä¸å°å‡º SimpleDamageUltimateã€ThunderStrikeUltimate ç­‰å…·é«”å¯¦ç¾
// é€™äº›æ‡‰è©²åœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥ import
// æ³¨æ„ï¼šä¸å°å‡º DamageFactoryï¼ˆå…§éƒ¨å·¥å…·ï¼‰
```

**ç‚ºä»€éº¼é€™æ¨£æ”¹ï¼Ÿ**

- âœ… `IUltimateAbility` æ˜¯æ¥å£ï¼Œå¯ä»¥å°å‡ºï¼ˆCharacter éœ€è¦å®ƒï¼‰
- âœ… å…·é«”çš„ Ultimate å¯¦ç¾é¡ä¸æ‡‰è©²å¾ index å°å‡ºï¼ˆé¿å…å¾ªç’°ï¼‰
- âœ… éœ€è¦ä½¿ç”¨å…·é«” Ultimate çš„åœ°æ–¹ï¼Œæ‡‰è©²ç›´æ¥ import

---

### æ­¥é©Ÿ 1.3ï¼šä¿®æ­£ `logic/damage/index.ts`

**ç•¶å‰å•é¡Œ**ï¼šå…§éƒ¨å¾ªç’°ï¼ˆdamage.chain â†” models/indexï¼‰

#### å¯¦éš›æ“ä½œï¼š

```typescript
// ğŸ“ src/modules/combat/logic/damage/index.ts

// === åˆªé™¤ä»¥ä¸‹å…§å®¹ ===
// export * from './damage.chain'
// export * from './models'
// export * from './utils/damage.calculator.util'

// === æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ ===

// å…¬å…±é¡
export { DamageChain } from './damage.chain'

// å…¬å…±é¡å‹ï¼ˆæ˜ç¢ºåˆ—å‡ºï¼Œé¿å…å¾ªç’°ï¼‰
export type { DamageEvent } from './models/damage.event.model'

export type { ICombatHook } from './models/combat.hook.interface'

// å…¬å…±å·¥å…·å‡½æ•¸
export { calculateFinalDamage } from './utils/damage.calculator.util'

// æ³¨æ„ï¼šä¸å°å‡ºå…§éƒ¨ stepsï¼ˆBeforeDamageStep ç­‰ï¼‰
// æ³¨æ„ï¼šä¸å°å‡º hookCollector
```

**ç‚ºä»€éº¼é€™æ¨£æ”¹ï¼Ÿ**

- âœ… æ‰“ç ´äº† `damage.chain.ts` â†’ `models/index.ts` â†’ `damage.chain.ts` çš„å¾ªç’°
- âœ… æ˜ç¢ºåˆ—å‡ºæ¯å€‹é¡å‹ï¼Œè€Œä¸æ˜¯ `export *`

---

### æ­¥é©Ÿ 1.4ï¼šä¿®æ­£ `domain/effect/index.ts`

**ç•¶å‰å•é¡Œ**ï¼šå°å‡ºæ‰€æœ‰å¯¦ç¾ï¼Œå°è‡´èˆ‡ character å¾ªç’°

#### å¯¦éš›æ“ä½œï¼š

```typescript
// ğŸ“ src/modules/combat/domain/effect/index.ts

// === åˆªé™¤ä»¥ä¸‹å…§å®¹ ===
// export * from './effect.manager'
// export * from './models'
// export * from './Implementation'

// === æ›¿æ›ç‚ºä»¥ä¸‹å…§å®¹ ===

// å…¬å…±é¡ï¼ˆä½†å…¶å¯¦ EffectManager æ‡‰è©²æ˜¯å…§éƒ¨çš„ï¼Œè€ƒæ…®ç§»é™¤ï¼‰
export { EffectManager } from './effect.manager'

// å…¬å…±æ¥å£
export type { IEffect } from './models/effect.model'

// å¯å †ç–Šæ•ˆæœåŸºé¡ï¼ˆå¦‚æœå¤–éƒ¨éœ€è¦ç¹¼æ‰¿å®ƒï¼‰
export { StackableEffect } from './models/stackable.effect.model'

// å…·é«”æ•ˆæœå¯¦ç¾ï¼ˆé€™äº›æ˜¯çµ¦å¤–éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥å°å‡ºï¼‰
export { PoisonEffect, ChillEffect, ChargeEffect, HolyFireEffect } from './Implementation/NativeStatus'

export { ChargedCriticalEffect, LowHealthArmorEffect } from './Implementation/Equipment'

// ä½†è¦æ³¨æ„ï¼šå¦‚æœé€™äº›æ•ˆæœåœ¨å…§éƒ¨ import äº† character/indexï¼Œ
// ä»å¯èƒ½å½¢æˆå¾ªç’°ï¼Œéœ€è¦æ”¹ç‚ºç›´æ¥è·¯å¾‘
```

**ç‚ºä»€éº¼é€™æ¨£æ”¹ï¼Ÿ**

- âœ… æ˜ç¢ºåˆ—å‡ºæ¯å€‹å°å‡ºé …
- âš ï¸ ä½†å¦‚æœ `ChargedCriticalEffect.ts` å…§éƒ¨ import äº† `'../../../character'`ï¼Œä»æœƒå¾ªç’°

---

### æ­¥é©Ÿ 1.5ï¼šä¿®æ­£å…·é«” Effect å¯¦ç¾çš„ import è·¯å¾‘

**é—œéµï¼é€™æ˜¯æœ€é‡è¦çš„ä¸€æ­¥ï¼**

#### å¯¦éš›æ“ä½œï¼š

æ‰¾åˆ°æ‰€æœ‰ `domain/effect/Implementation/**/*.ts` æ–‡ä»¶ï¼Œå°‡ï¼š

```typescript
// âŒ éŒ¯èª¤çš„ importï¼ˆé€šé barrel exportï¼‰
import type { ICharacter } from '../../../character'
import type { DamageEvent } from '@/modules/combat/logic/damage'

// âœ… æ­£ç¢ºçš„ importï¼ˆç›´æ¥è·¯å¾‘ï¼‰
import type { ICharacter } from '../../../character/interfaces/character.interface'
import type { DamageEvent } from '@/modules/combat/logic/damage/models/damage.event.model'
import type { ICombatHook } from '@/modules/combat/logic/damage/models/combat.hook.interface'
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

- `domain/effect/Implementation/Equipment/ChargedCriticalEffect.ts`
- `domain/effect/Implementation/Equipment/LowHealthArmorEffect.ts`
- `domain/effect/Implementation/NativeStatus/ChargeEffect.ts`
- `domain/effect/Implementation/NativeStatus/ChillEffect.ts`
- `domain/effect/Implementation/NativeStatus/HolyFireEffect.ts`
- `domain/effect/Implementation/NativeStatus/PoisonEffect.ts`

**ç¯„ä¾‹ï¼šä¿®æ­£ ChargedCriticalEffect.ts**

```typescript
// ğŸ“ domain/effect/Implementation/Equipment/ChargedCriticalEffect.ts

// === ä¿®æ­£å‰ ===
import type { DamageEvent, ICombatHook } from '@/modules/combat/logic/damage'
import type { ICharacter } from '../../../character'
import type { IEffect } from '../../models/effect.model'

// === ä¿®æ­£å¾Œ ===
// ç›´æ¥ import å…·é«”æ–‡ä»¶ï¼Œä¸é€šé index.ts
import type { DamageEvent } from '@/modules/combat/logic/damage/models/damage.event.model'
import type { ICombatHook } from '@/modules/combat/logic/damage/models/combat.hook.interface'
import type { ICharacter } from '../../../character/interfaces/character.interface'
import type { IEffect } from '../../models/effect.model'
import type { CombatContext } from '../../../../context'

// ... å…¶é¤˜ä»£ç¢¼ä¸è®Š
```

---

### æ­¥é©Ÿ 1.6ï¼šä¿®æ­£ coordination å±¤çš„ import è·¯å¾‘

#### å¯¦éš›æ“ä½œï¼š

æ‰¾åˆ°æ‰€æœ‰ `coordination/**/*.ts` æ–‡ä»¶ï¼Œå°‡ï¼š

```typescript
// âŒ éŒ¯èª¤çš„ import
import type { ICharacter } from '../domain/character'

// âœ… æ­£ç¢ºçš„ import
import type { ICharacter } from '../domain/character/interfaces/character.interface'
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

- `coordination/ability.system.ts`
- `coordination/factories/damage.factory.ts`
- `coordination/models/simple.damage.ultimate.ts`
- `coordination/models/thunder.strike.ultimate.ts`
- `coordination/target-select-strategies/*.ts`

**ç¯„ä¾‹ï¼šä¿®æ­£ ability.system.ts**

```typescript
// ğŸ“ coordination/ability.system.ts

// === ä¿®æ­£å‰ ===
import type { CharacterId, ICharacter } from '../domain/character'
import { DamageChain } from '../damage'

// === ä¿®æ­£å¾Œ ===
import type { CharacterId, ICharacter } from '../domain/character/interfaces/character.interface'
import { DamageChain } from '../logic/damage/damage.chain'
import type { CombatContext } from '../context'
import { isCharacter } from '../infra/shared'
import { DamageFactory } from './factories/damage.factory'
import { FirstAliveSelector, type ITargetSelector } from './target-select-strategies/target.selector.interface'

// æ³¨æ„ï¼šä¹Ÿè¦æª¢æŸ¥å…¶ä»– import æ˜¯å¦æ­£ç¢º
```

---

### æ­¥é©Ÿ 1.7ï¼šé©—è­‰ä¿®å¾©çµæœ

#### å¯¦éš›æ“ä½œï¼š

```bash
# 1. æª¢æŸ¥å¾ªç’°ä¾è³´
npx madge --circular --extensions ts,tsx src/modules/combat

# æ‡‰è©²çœ‹åˆ°ï¼š
# âœ“ No circular dependencies found!

# 2. ç·¨è­¯æª¢æŸ¥
pnpm build

# 3. é‹è¡Œæ¸¬è©¦ï¼ˆå¦‚æœæœ‰ï¼‰
pnpm test

# 4. å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
pnpm dev
```

---

## ğŸ¨ éšæ®µ 2ï¼šå„ªåŒ–åˆ†å±¤ï¼ˆå¯é¸ï¼‰

### ç‚ºä»€éº¼éœ€è¦é€™å€‹éšæ®µï¼Ÿ

å³ä½¿æ‰“ç ´äº†å¾ªç’°ï¼Œç•¶å‰çš„ä¾è³´æ–¹å‘ä»æœ‰äº›å¥‡æ€ªï¼š

- `domain/character` ä¾è³´ `coordination/models/ultimate.ability.interface`
- é€™æ„å‘³è‘—ä½å±¤ï¼ˆdomainï¼‰ä¾è³´é«˜å±¤ï¼ˆcoordinationï¼‰

### è§£æ±ºæ–¹æ¡ˆï¼šæå‡å…±äº«æ¥å£åˆ° infra/shared

#### æ­¥é©Ÿ 2.1ï¼šå‰µå»ºå…±äº«æ¥å£æ–‡ä»¶

```typescript
// ğŸ“ src/modules/combat/infra/shared/interfaces/ultimate.ability.interface.ts

import type { ICharacter } from '../../../domain/character/interfaces/character.interface'
import type { CombatContext } from '../../../context'

/**
 * å¤§æ‹›èƒ½åŠ›æ¥å£
 *
 * æå‡åˆ° shared å±¤çš„åŸå› ï¼š
 * - Character éœ€è¦æŒæœ‰ IUltimateAbility
 * - AbilitySystem éœ€è¦èª¿ç”¨ IUltimateAbility
 * - é¿å… domain â†’ coordination çš„ä¾è³´
 */
export interface IUltimateAbility {
  readonly id: string
  readonly name: string
  readonly energyCost: number

  execute(caster: ICharacter, context: CombatContext): void
  canExecute(caster: ICharacter, context: CombatContext): boolean
}
```

#### æ­¥é©Ÿ 2.2ï¼šæ›´æ–° shared/index.ts

```typescript
// ğŸ“ src/modules/combat/infra/shared/index.ts

export * from './interfaces/entity.interface'
export * from './interfaces/ultimate.ability.interface' // æ–°å¢
export * from './models/combat.random.generator'
export * from './utils/type.guard'
```

#### æ­¥é©Ÿ 2.3ï¼šåˆªé™¤èˆŠæ–‡ä»¶ä¸¦æ›´æ–°æ‰€æœ‰ import

```bash
# åˆªé™¤èˆŠæ–‡ä»¶
rm src/modules/combat/coordination/models/ultimate.ability.interface.ts
```

æ›´æ–°æ‰€æœ‰ä½¿ç”¨ `IUltimateAbility` çš„åœ°æ–¹ï¼š

```typescript
// âŒ èˆŠçš„ import
import type { IUltimateAbility } from '../../coordination/models/ultimate.ability.interface'

// âœ… æ–°çš„ import
import type { IUltimateAbility } from '@/modules/combat/infra/shared'
```

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

- `domain/character/interfaces/ultimate.owner.interface.ts`
- `domain/character/character.ts`
- `coordination/ability.system.ts`
- `coordination/models/simple.damage.ultimate.ts`
- `coordination/models/thunder.strike.ultimate.ts`

#### æ­¥é©Ÿ 2.4ï¼šï¼ˆå¯é¸ï¼‰ç§»å‹• ICombatHook

å¦‚æœä½ æƒ³è¦æ›´è§£è€¦ï¼Œä¹Ÿå¯ä»¥æŠŠ `ICombatHook` ç§»åˆ° sharedï¼š

```typescript
// ğŸ“ src/modules/combat/infra/shared/interfaces/combat.hook.interface.ts

import type { CombatContext } from '../../../context'
import type { DamageEvent } from '../../../logic/damage/models/damage.event.model'

/**
 * æˆ°é¬¥é‰¤å­æ¥å£
 *
 * æå‡åˆ° shared å±¤çš„åŸå› ï¼š
 * - effect éœ€è¦å¯¦ç¾å®ƒ
 * - damage éœ€è¦èª¿ç”¨å®ƒ
 * - ä½œç‚ºé€šç”¨æ“´å±•é»ï¼Œæ‡‰è©²åœ¨å…±äº«å±¤
 */
export interface ICombatHook {
  beforeDamageCalculation?(event: DamageEvent, context: CombatContext): DamageEvent
  onHitCheck?(event: DamageEvent, context: CombatContext): DamageEvent
  onCritCheck?(event: DamageEvent, context: CombatContext): DamageEvent
  onDamageModify?(event: DamageEvent, context: CombatContext): DamageEvent
  onDefenseCalculation?(event: DamageEvent, context: CombatContext): DamageEvent
  beforeDamageApply?(event: DamageEvent, context: CombatContext): DamageEvent
  afterDamageApply?(event: DamageEvent, context: CombatContext): void
}
```

**ä½†æ³¨æ„**ï¼šé€™æœƒå¼•å…¥ `shared â†’ logic/damage` çš„ä¾è³´ï¼ˆå› ç‚ºéœ€è¦ `DamageEvent`ï¼‰ï¼Œå¯èƒ½ä¸å¤ªå¥½ã€‚

**å»ºè­°**ï¼š`ICombatHook` ä¿æŒåœ¨ `logic/damage`ï¼Œé€™æ˜¯åˆç†çš„ã€‚

---

## ğŸ”§ éšæ®µ 3ï¼šæŒçºŒç›£æ§

### æ­¥é©Ÿ 3.1ï¼šæ·»åŠ  npm script

```json
// ğŸ“ package.json

{
  "scripts": {
    // ... å…¶ä»– scripts
    "check:circular": "madge --circular --extensions ts,tsx src/modules/combat",
    "check:deps": "madge --image dev_log/combat-deps.svg --extensions ts,tsx src/modules/combat"
  }
}
```

### æ­¥é©Ÿ 3.2ï¼šè¨­ç½® Git Hookï¼ˆå¯é¸ï¼‰

```bash
# å®‰è£ husky
pnpm add -D husky

# åˆå§‹åŒ– husky
npx husky init

# å‰µå»º pre-commit hook
echo "pnpm check:circular" > .husky/pre-commit
```

### æ­¥é©Ÿ 3.3ï¼šå‰µå»ºæ¶æ§‹æ–‡æª”

```markdown
// ğŸ“ src/modules/combat/ARCHITECTURE.md

# Combat æ¨¡çµ„æ¶æ§‹è¦ç¯„

## ä¾è³´è¦å‰‡

### âœ… å…è¨±çš„ä¾è³´æ–¹å‘
```

combat-engine â†’ coordination â†’ logic â†’ domain â†’ context â†’ infra

````

### âŒ ç¦æ­¢çš„ä¾è³´

- domain â†’ coordination
- domain â†’ logic
- context â†’ domain
- ä»»ä½•å¾ªç’°ä¾è³´

## Barrel Export è¦ç¯„

### index.ts åªèƒ½å°å‡ºï¼š
- å…¬å…±é¡ï¼ˆçµ¦å¤–éƒ¨ä½¿ç”¨çš„ï¼‰
- å…¬å…±æ¥å£ï¼ˆé¡å‹å®šç¾©ï¼‰
- å…¬å…±å·¥å…·å‡½æ•¸

### index.ts ä¸èƒ½å°å‡ºï¼š
- å…§éƒ¨å¯¦ç¾ç´°ç¯€
- å…§éƒ¨è¼”åŠ©é¡
- å…§éƒ¨å·¥å…·å‡½æ•¸

### ç¯„ä¾‹

```typescript
// âœ… æ­£ç¢º
export { Character } from './character'
export type { ICharacter } from './interfaces/character.interface'

// âŒ éŒ¯èª¤
export * from './character'  // å¤ªå¯¬æ³›
export { AttributeContainer } from './attribute.container'  // å…§éƒ¨å¯¦ç¾
````

## æª¢æŸ¥å·¥å…·

```bash
# æª¢æŸ¥å¾ªç’°ä¾è³´
pnpm check:circular

# ç”Ÿæˆä¾è³´åœ–
pnpm check:deps
```

````

---

## ğŸ“Š å®Œæ•´æ¸…å–®ï¼ˆChecklistï¼‰

### éšæ®µ 1ï¼šå¿«é€Ÿä¿®å¾©ï¼ˆå¿…åšï¼‰

- [ ] 1.1 ä¿®æ­£ `domain/character/index.ts`
- [ ] 1.2 ä¿®æ­£ `coordination/index.ts`
- [ ] 1.3 ä¿®æ­£ `logic/damage/index.ts`
- [ ] 1.4 ä¿®æ­£ `domain/effect/index.ts`
- [ ] 1.5 ä¿®æ­£æ‰€æœ‰ Effect å¯¦ç¾çš„ import è·¯å¾‘
  - [ ] `ChargedCriticalEffect.ts`
  - [ ] `LowHealthArmorEffect.ts`
  - [ ] `ChargeEffect.ts`
  - [ ] `ChillEffect.ts`
  - [ ] `HolyFireEffect.ts`
  - [ ] `PoisonEffect.ts`
- [ ] 1.6 ä¿®æ­£ coordination å±¤çš„ import è·¯å¾‘
  - [ ] `ability.system.ts`
  - [ ] `damage.factory.ts`
  - [ ] `simple.damage.ultimate.ts`
  - [ ] `thunder.strike.ultimate.ts`
  - [ ] æ‰€æœ‰ target selectors
- [ ] 1.7 é©—è­‰ä¿®å¾©çµæœ
  - [ ] `npx madge --circular` ç„¡å¾ªç’°
  - [ ] `pnpm build` ç·¨è­¯æˆåŠŸ
  - [ ] `pnpm test` æ¸¬è©¦é€šéï¼ˆå¦‚æœæœ‰ï¼‰
  - [ ] `pnpm dev` é‹è¡Œæ­£å¸¸

### éšæ®µ 2ï¼šå„ªåŒ–åˆ†å±¤ï¼ˆå¯é¸ï¼‰

- [ ] 2.1 å‰µå»º `infra/shared/interfaces/ultimate.ability.interface.ts`
- [ ] 2.2 æ›´æ–° `infra/shared/index.ts`
- [ ] 2.3 åˆªé™¤èˆŠæ–‡ä»¶ä¸¦æ›´æ–°æ‰€æœ‰ import
- [ ] 2.4 æ±ºå®šæ˜¯å¦ç§»å‹• `ICombatHook`ï¼ˆå»ºè­°ä¸ç§»ï¼‰

### éšæ®µ 3ï¼šæŒçºŒç›£æ§ï¼ˆå¯é¸ï¼‰

- [ ] 3.1 æ·»åŠ  npm scripts
- [ ] 3.2 è¨­ç½® Git Hook
- [ ] 3.3 å‰µå»º ARCHITECTURE.md

---

## ğŸ¯ æœ€ç°¡å–®çš„é–‹å§‹æ–¹å¼

**å¦‚æœä½ åªæƒ³å¿«é€Ÿä¿®å¾©ï¼Œå¾é€™è£¡é–‹å§‹ï¼š**

### ç¬¬ä¸€æ­¥ï¼šä¿®æ­£ 4 å€‹ index.ts

```bash
# 1. ä¿®æ­£ character/index.tsï¼ˆåªå°å‡º Character, createWarrior, createMage, å’Œé¡å‹ï¼‰
# 2. ä¿®æ­£ coordination/index.tsï¼ˆåªå°å‡º AbilitySystem, IUltimateAbility, é¸æ“‡å™¨ï¼‰
# 3. ä¿®æ­£ damage/index.tsï¼ˆåªå°å‡º DamageChain, DamageEvent, ICombatHookï¼‰
# 4. ä¿®æ­£ effect/index.tsï¼ˆåªå°å‡º IEffect å’Œå…·é«”æ•ˆæœï¼‰
````

### ç¬¬äºŒæ­¥ï¼šä¿®æ­£æ‰€æœ‰ effect å¯¦ç¾çš„ import

```bash
# å°‡æ‰€æœ‰ effect çš„ import æ”¹ç‚ºç›´æ¥è·¯å¾‘ï¼š
# import type { ICharacter } from '../../../character/interfaces/character.interface'
# import type { DamageEvent } from '@/modules/combat/logic/damage/models/damage.event.model'
```

### ç¬¬ä¸‰æ­¥ï¼šé©—è­‰

```bash
npx madge --circular --extensions ts,tsx src/modules/combat
```

---

## â±ï¸ é ä¼°æ™‚é–“

- **æœ€å°å¯è¡Œæ–¹æ¡ˆ**ï¼š30 åˆ†é˜ï¼ˆåªä¿®æ­£ index.ts å’Œ effect importsï¼‰
- **å®Œæ•´éšæ®µ 1**ï¼š1-2 å°æ™‚
- **éšæ®µ 1 + 2**ï¼š3-6 å°æ™‚
- **å…¨éƒ¨å®Œæˆ**ï¼š4-7 å°æ™‚

---

## ğŸ’¡ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼ä¸èƒ½ç”¨ `export *`ï¼Ÿ

**A**: `export *` æœƒå°å‡ºæ¨¡çµ„å…§çš„æ‰€æœ‰å…§å®¹ï¼ŒåŒ…æ‹¬å…§éƒ¨å¯¦ç¾ã€‚ç•¶å…©å€‹æ¨¡çµ„äº’ç›¸ `export *` å°æ–¹æ™‚ï¼Œå°±æœƒå½¢æˆå¾ªç’°ã€‚

### Q2: ç›´æ¥è·¯å¾‘ import æœƒä¸æœƒå¤ªé•·ï¼Ÿ

**A**: å¯ä»¥ç”¨ TypeScript çš„ path aliasï¼š

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@combat/*": ["src/modules/combat/*"]
    }
  }
}

// ç„¶å¾Œå°±å¯ä»¥ï¼š
import type { ICharacter } from '@combat/domain/character/interfaces/character.interface'
```

### Q3: ä¿®æ”¹å¾Œæœƒä¸æœƒç ´å£ç¾æœ‰ä»£ç¢¼ï¼Ÿ

**A**: ä¸æœƒï¼åªè¦ï¼š

1. æ‰€æœ‰éœ€è¦çš„é¡å‹å’Œé¡éƒ½æœ‰å°å‡º
2. import è·¯å¾‘æ­£ç¢º
3. é‚è¼¯å®Œå…¨ä¸è®Š

### Q4: æˆ‘è©²å…ˆåšå“ªå€‹éšæ®µï¼Ÿ

**A**:

- **å¿…é ˆåš**ï¼šéšæ®µ 1ï¼ˆæ‰“ç ´å¾ªç’°ï¼‰
- **å»ºè­°åš**ï¼šéšæ®µ 2ï¼ˆå„ªåŒ–åˆ†å±¤ï¼‰
- **å¯é¸åš**ï¼šéšæ®µ 3ï¼ˆå·¥å…·è¨­ç½®ï¼‰

---

## ğŸš¦ æº–å‚™å¥½äº†å—ï¼Ÿ

**å»ºè­°åŸ·è¡Œé †åº**ï¼š

1. **å‚™ä»½ç•¶å‰ä»£ç¢¼**ï¼ˆGit commitï¼‰
2. **åŸ·è¡Œéšæ®µ 1.1-1.4**ï¼ˆä¿®æ­£ index.tsï¼‰
3. **åŸ·è¡Œ madge æª¢æŸ¥**ï¼Œçœ‹çœ‹å¾ªç’°æ˜¯å¦æ¸›å°‘
4. **åŸ·è¡Œéšæ®µ 1.5-1.6**ï¼ˆä¿®æ­£ import è·¯å¾‘ï¼‰
5. **å†æ¬¡æª¢æŸ¥**ï¼Œæ‡‰è©²å·²ç¶“ç„¡å¾ªç’°
6. **æ¸¬è©¦åŠŸèƒ½**ï¼Œç¢ºä¿ä¸€åˆ‡æ­£å¸¸
7. **æäº¤ä»£ç¢¼**

**æˆ‘å¯ä»¥å¹«ä½ ï¼š**

- ç”Ÿæˆå…·é«”çš„æ–‡ä»¶ä¿®æ”¹å…§å®¹
- ä¸€æ­¥ä¸€æ­¥æŒ‡å°ä½ æ“ä½œ
- é©—è­‰æ¯ä¸€æ­¥çš„çµæœ

**ä½ æƒ³å¾å“ªè£¡é–‹å§‹ï¼Ÿ**
