# Combat v0.5 ç›¤é»å ±å‘Š

## ç‰ˆæœ¬è³‡è¨Š

- **ç‰ˆæœ¬è™Ÿ**: v0.5
- **å®Œæˆæ—¥æœŸ**: 2025-12-02
- **æ¶µè“‹ç¯„åœ**: Combat æ ¸å¿ƒå¼•æ“ + Combat-Impl å¯¦ä½œå±¤

---

## ä¸€ã€åŸ·è¡Œæ‘˜è¦ï¼ˆçµ¦éæŠ€è¡“äººå“¡ï¼‰

### é€™å€‹ç‰ˆæœ¬èƒ½åšä»€éº¼ï¼Ÿ

Combat v0.5 æ˜¯ä¸€å€‹**å®Œæ•´å¯é‹è¡Œçš„æˆ°é¬¥æ¨¡æ“¬å¼•æ“**ï¼Œç›®å‰å·²ç¶“å¯ä»¥ï¼š

1. **æ¨¡æ“¬å®Œæ•´çš„è§’è‰²å°æˆ°**
   - æ”¯æ´å¤šè§’è‰²éšŠä¼ï¼ˆç©å®¶ vs æ•µäººï¼‰
   - è‡ªå‹•é€²è¡Œå›åˆåˆ¶æˆ°é¬¥ç›´åˆ°ä¸€æ–¹å…¨æ»…
   - ç”¢ç”Ÿè©³ç´°çš„æˆ°é¬¥è¨˜éŒ„èˆ‡å¿«ç…§

2. **è±å¯Œçš„è§’è‰²é¤Šæˆç³»çµ±**
   - è§’è‰²æœ‰ 12+ ç¨®å±¬æ€§ï¼ˆç”Ÿå‘½ã€è­·ç”²ã€é–ƒé¿ã€æ”»æ“ŠåŠ›ã€æš´æ“Šç‡ç­‰ï¼‰
   - å¯è£å‚™æ­¦å™¨ã€é˜²å…·ã€é£¾å“
   - å¯æ”œå¸¶å¤šå€‹éºç‰©ï¼ˆstackable relicsï¼‰å¢å¼·èƒ½åŠ›
   - æ¯å€‹è§’è‰²æœ‰å°ˆå±¬å¤§çµ•æ‹›ï¼ˆUltimateï¼‰

3. **æˆ°é¬¥ç­–ç•¥æ·±åº¦**
   - æ”»æ“Šæœ‰å‘½ä¸­åˆ¤å®šï¼ˆæº–ç¢ºåº¦ vs é–ƒé¿ï¼‰
   - æš´æ“Šç³»çµ±ï¼ˆæ©Ÿç‡èˆ‡å€ç‡ï¼‰
   - è­·ç”²æ¸›å‚·æ©Ÿåˆ¶
   - èƒ½é‡ç´¯ç©ç³»çµ±ï¼ˆæ”»æ“Šç´¯ç©èƒ½é‡ï¼Œæ»¿ 100 é‡‹æ”¾å¤§æ‹›ï¼‰

4. **æ•ˆæœèˆ‡ç‹€æ…‹ç³»çµ±**
   - æ¯’ç´ æ•ˆæœï¼ˆæŒçºŒå‚·å®³ã€å¯å †ç–Šã€è‡ªç„¶è¡°æ¸›ï¼‰
   - å……èƒ½ç‹€æ…‹ï¼ˆæå‡æš´æ“Šç‡ï¼‰
   - è¡€å¥‘æ•ˆæœï¼ˆçŠ§ç‰²ç”Ÿå‘½æ›å–å‚·å®³åŠ æˆï¼‰
   - è­·ç”²å¼·åŒ–ï¼ˆä½è¡€é‡æ™‚è§¸ç™¼ï¼‰

### å¯¦éš›æ‡‰ç”¨ç¯„ä¾‹

å‡è¨­ä½ æƒ³æ¨¡æ“¬ä¸€å ´æˆ°é¬¥ï¼š

**ç©å®¶éšŠä¼**:

- æˆ°å£«ï¼šè£å‚™ã€Œå®ˆè­·è€…æ¿ç”²ã€ï¼ˆä½è¡€é‡æ™‚è­·ç”²æå‡ï¼‰+ ã€Œè¡€å¥‘ã€å¤§æ‹›ï¼ˆçŠ§ç‰²ç”Ÿå‘½å¼·åŒ– 3 æ¬¡æ”»æ“Šï¼‰
- å¼“ç®­æ‰‹ï¼šè£å‚™ã€Œé¢¨æš´ä¹‹åˆƒã€ï¼ˆå……èƒ½æ™‚æš´æ“Šç‡ç¿»å€ï¼‰+ ã€Œæ¯’è—¥ç“¶ã€éºç‰© x2ï¼ˆæ”»æ“Šé™„åŠ é›™å±¤æ¯’ç´ ï¼‰+ ã€Œé›·éœ†ä¸€æ“Šã€å¤§æ‹›ï¼ˆç¯„åœå‚·å®³ï¼‰

**æ•µæ–¹éšŠä¼**:

- å“¥å¸ƒæ— x2ï¼šåŸºç¤å±¬æ€§ï¼Œç„¡ç‰¹æ®Šè£å‚™

**æˆ°é¬¥éç¨‹**:

1. æˆ°é¬¥è‡ªå‹•é€²è¡Œï¼Œæ¯å€‹ tickï¼ˆ0.01 ç§’ï¼‰ç³»çµ±æœƒï¼š
   - æª¢æŸ¥å†·å»æ™‚é–“ï¼Œæ±ºå®šèª°èƒ½æ”»æ“Š
   - è¨ˆç®—å‘½ä¸­åˆ¤å®šï¼ˆæº–ç¢ºåº¦ vs é–ƒé¿ï¼‰
   - è¨ˆç®—æš´æ“Šåˆ¤å®šï¼ˆé¢¨æš´ä¹‹åˆƒçš„å……èƒ½æ•ˆæœï¼‰
   - è¨ˆç®—å‚·å®³ï¼ˆè¡€å¥‘åŠ æˆã€è­·ç”²æ¸›å…ï¼‰
   - æ‡‰ç”¨æ¯’ç´ æ•ˆæœï¼ˆæ¯ tick æŒçºŒå‚·å®³ï¼‰
   - ç´¯ç©èƒ½é‡ï¼ˆæ”»æ“Šæ™‚ç²å¾—èƒ½é‡ï¼‰
   - é‡‹æ”¾å¤§æ‹›ï¼ˆèƒ½é‡æ»¿ 100 æ™‚ï¼‰

2. æˆ°é¬¥çµæŸæ¢ä»¶ï¼š
   - ä¸€æ–¹å…¨æ»…
   - æˆ–é”åˆ°æœ€å¤§å›åˆæ•¸ï¼ˆé è¨­ 10000 ticksï¼‰

3. è¼¸å‡ºçµæœï¼š
   - å‹åˆ©æ–¹
   - å­˜æ´»è€…åå–®èˆ‡å‰©é¤˜è¡€é‡
   - å®Œæ•´æˆ°é¬¥æ—¥èªŒï¼ˆæ¯æ¬¡æ”»æ“Šã€å‚·å®³ã€å¤§æ‹›ã€æ­»äº¡ï¼‰
   - å¿«ç…§åºåˆ—ï¼ˆæ¯ 100 ticks è¨˜éŒ„ä¸€æ¬¡æ‰€æœ‰è§’è‰²ç‹€æ…‹ï¼‰
   - çµ±è¨ˆæ•¸æ“šï¼ˆç¸½å‚·å®³ã€æš´æ“Šæ¬¡æ•¸ã€å¤§æ‹›ä½¿ç”¨æ¬¡æ•¸ç­‰ï¼‰

### ç›®å‰é™åˆ¶

1. **åƒ…æ”¯æ´æˆ°é¬¥é‚è¼¯**ï¼šä¸åŒ…å« UI ä»‹é¢ã€é—œå¡ç³»çµ±ã€å•†åº—ç³»çµ±
2. **æˆ°é¬¥ç„¡æ³•å¹²é **ï¼šæˆ°é¬¥é–‹å§‹å¾Œè‡ªå‹•åŸ·è¡Œï¼Œç©å®¶ç„¡æ³•ä¸­é€”æ“ä½œ
3. **ç„¡å­˜æª”åŠŸèƒ½**ï¼šæˆ°é¬¥çµæœåƒ…å­˜åœ¨è¨˜æ†¶é«”ä¸­
4. **æ•ˆæœç¨®é¡æœ‰é™**ï¼šç›®å‰åƒ…å¯¦ä½œ 3-4 ç¨®æ•ˆæœä½œç‚ºç¯„ä¾‹

---

## äºŒã€æŠ€è¡“æ¶æ§‹å ±å‘Šï¼ˆçµ¦é–‹ç™¼äººå“¡ï¼‰

### 2.1 ç³»çµ±åˆ†å±¤æ¶æ§‹

```
combat/
â”œâ”€â”€ infra/           ã€åŸºç¤è¨­æ–½å±¤ã€‘æœ€åº•å±¤ï¼Œæä¾›é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ config/      - å¸¸æ•¸å®šç¾©ï¼ˆå±¬æ€§ã€å…¬å¼ã€é è¨­å€¼ï¼‰
â”‚   â”œâ”€â”€ event-bus/   - äº‹ä»¶ç¸½ç·šï¼ˆç™¼å¸ƒ/è¨‚é–±ï¼‰
â”‚   â”œâ”€â”€ resource-registry/  - è³‡æºè¨»å†Šè¡¨ï¼ˆæ•ˆæœã€è£å‚™ã€è§’è‰²æŸ¥æ‰¾ï¼‰
â”‚   â””â”€â”€ shared/      - å…±ç”¨å·¥å…·ï¼ˆRNGã€ID ç”Ÿæˆã€å‹åˆ¥å®ˆè¡›ï¼‰
â”‚
â”œâ”€â”€ domain/          ã€é ˜åŸŸå±¤ã€‘æ ¸å¿ƒæ¥­å‹™å¯¦é«”
â”‚   â”œâ”€â”€ character/   - è§’è‰²å¯¦é«”ï¼ˆå±¬æ€§ã€ç®¡ç†å™¨ï¼‰
â”‚   â”œâ”€â”€ effect/      - æ•ˆæœç®¡ç†å™¨
â”‚   â”œâ”€â”€ item/        - è£å‚™èˆ‡éºç‰©ç®¡ç†å™¨
â”‚   â””â”€â”€ ultimate/    - å¤§æ‹›ç®¡ç†å™¨
â”‚
â”œâ”€â”€ logic/           ã€é‚è¼¯å±¤ã€‘ç¨ç«‹æ¥­å‹™é‚è¼¯
â”‚   â”œâ”€â”€ damage/      - å‚·å®³è¨ˆç®—éˆï¼ˆ8 éšæ®µæ­¥é©Ÿæ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ logger/      - äº‹ä»¶è¨˜éŒ„å™¨
â”‚   â”œâ”€â”€ snapshot/    - å¿«ç…§æ”¶é›†å™¨
â”‚   â””â”€â”€ tick/        - Tick é©…å‹•å™¨
â”‚
â”œâ”€â”€ coordination/    ã€å”èª¿å±¤ã€‘è·¨æ¨¡çµ„å”ä½œ
â”‚   â”œâ”€â”€ tick.action.system.ts  - æ”»æ“Šå”èª¿ç³»çµ±
â”‚   â”œâ”€â”€ attack.executor.ts     - æ”»æ“ŠåŸ·è¡Œå™¨
â”‚   â”œâ”€â”€ energy.manager.ts      - èƒ½é‡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ cooldown.manager.ts    - å†·å»ç®¡ç†å™¨
â”‚   â””â”€â”€ effect.processor.ts    - æ•ˆæœè™•ç†å™¨
â”‚
â”œâ”€â”€ context/         ã€ä¸Šä¸‹æ–‡å±¤ã€‘å…¨åŸŸç‹€æ…‹ç®¡ç†
â”‚   â””â”€â”€ combat.context.ts  - æˆ°é¬¥ä¸Šä¸‹æ–‡ï¼ˆEventBusã€RNGã€å¯¦é«”é›†åˆï¼‰
â”‚
â””â”€â”€ combat-engine/   ã€å¼•æ“å±¤ã€‘æœ€é«˜å±¤ï¼Œç·¨æ’æ‰€æœ‰ç³»çµ±
    â””â”€â”€ combat.engine.ts  - æˆ°é¬¥å¼•æ“ï¼ˆç”Ÿå‘½é€±æœŸç®¡ç†ï¼‰
```

**ä¾è³´è¦å‰‡**: ä¸‹å±¤ä¸ä¾è³´ä¸Šå±¤ï¼Œç®­é ­å‘ä¸‹

- `combat-engine` â†’ æ‰€æœ‰å±¤
- `coordination` â†’ `domain`, `logic`, `context`, `infra`
- `logic` â†’ `domain`, `context`, `infra`
- `domain` â†’ `infra`
- `infra` â†’ ç„¡å¤–éƒ¨ä¾è³´

### 2.2 æ ¸å¿ƒå­ç³»çµ±è¨­è¨ˆ

#### A. æˆ°é¬¥å¼•æ“ (CombatEngine)

**è·è²¬**: é ‚å±¤ç·¨æ’è€…ï¼Œè² è²¬åˆå§‹åŒ–ã€å•Ÿå‹•ã€çµæŸæˆ°é¬¥

**å·¥ä½œæµç¨‹**:

```typescript
1. new CombatEngine(config)
   â†’ å»ºç«‹ ResourceRegistry
   â†’ å»ºç«‹ CombatContextï¼ˆEventBus, RNGï¼‰
   â†’ åˆå§‹åŒ–å­ç³»çµ±ï¼ˆTicker, TickActionSystem, Logger, SnapshotCollectorï¼‰
   â†’ è¨»å†Šè§’è‰²åˆ° Context

2. engine.start()
   â†’ å•Ÿå‹• Tickerï¼ˆé–‹å§‹ tick å¾ªç’°ï¼‰
   â†’ æˆ°é¬¥è‡ªå‹•åŸ·è¡Œç›´åˆ°åœæ­¢æ¢ä»¶
   â†’ æ”¶é›†æ—¥èªŒèˆ‡å¿«ç…§
   â†’ å»ºæ§‹ CombatResultï¼ˆå‹è² ã€çµ±è¨ˆã€å€–å­˜è€…ï¼‰

3. engine.dispose()
   â†’ æ¸…ç†æ‰€æœ‰è¨‚é–±èˆ‡è³‡æº
```

**é—œéµç‰¹æ€§**:

- å–®ä¸€å…¥å£é»ï¼Œç°¡åŒ–å¤–éƒ¨èª¿ç”¨
- ä½¿ç”¨ Builder æ¨¡å¼ç”¢ç”Ÿçµæœ
- è‡ªå‹•åˆ†ææˆ°é¬¥çµæœï¼ˆå‹è² ã€çµ±è¨ˆï¼‰

---

#### B. è§’è‰²ç³»çµ± (Character)

**è·è²¬**: æˆ°é¬¥å¯¦é«”ï¼Œå°è£å±¬æ€§ã€è£å‚™ã€æ•ˆæœã€å¤§æ‹›

**å…§éƒ¨çµæ§‹**:

```typescript
Character
â”œâ”€â”€ AttributeContainer    - å„²å­˜åŸºç¤å±¬æ€§ + Modifiers
â”œâ”€â”€ AttributeCalculator   - è¨ˆç®—æœ€çµ‚å±¬æ€§ï¼ˆåŠ ç®— â†’ ä¹˜ç®—ï¼‰
â”œâ”€â”€ EffectManager         - ç®¡ç†é™„åŠ æ•ˆæœ
â”œâ”€â”€ EquipmentManager      - ç®¡ç†è£å‚™æ§½ï¼ˆweapon, armor, accessoryï¼‰
â”œâ”€â”€ RelicManager          - ç®¡ç†éºç‰©ï¼ˆå¯å †ç–Šï¼‰
â””â”€â”€ UltimateManager       - ç®¡ç†å¤§çµ•æ‹›
```

**å±¬æ€§è¨ˆç®—æµç¨‹**:

```
Base Value (åŸºç¤å€¼)
  â†“
+ Additive Modifiers (åŠ ç®—ä¿®æ­£ï¼Œå¦‚ +10 æ”»æ“Š)
  â†“
Ã— Multiplicative Modifiers (ä¹˜ç®—ä¿®æ­£ï¼Œå¦‚ Ã—1.2 æ”»æ“Š)
  â†“
Final Value (æœ€çµ‚å€¼)
```

**è¨­è¨ˆå„ªé»**:

- **å–®ä¸€è·è²¬**: æ¯å€‹ Manager åªè™•ç†ä¸€ä»¶äº‹
- **ä¾è³´æ³¨å…¥**: é€é Registry æŸ¥æ‰¾è³‡æºï¼Œé¿å…ç›´æ¥æŒæœ‰
- **å¯æ“´å±•**: æ–°å¢è£å‚™/æ•ˆæœåªéœ€å¯¦ä½œä»‹é¢

---

#### C. å‚·å®³è¨ˆç®—éˆ (DamageChain)

**è·è²¬**: å°‡è¤‡é›œçš„å‚·å®³è¨ˆç®—æ‹†æˆ 8 å€‹æœ‰åºéšæ®µï¼Œæ”¯æ´ Hook æ“´å±•

**åŸ·è¡Œæµç¨‹**:

```typescript
DamageEvent (åˆå§‹å‚·å®³äº‹ä»¶)
  â†“
[Stage 1] BeforeDamageStep       - è§¸ç™¼ beforeDamageCalculation hooks
  â†“
[Stage 2] HitCheckStep           - å‘½ä¸­åˆ¤å®šï¼ˆæº–ç¢ºåº¦ vs é–ƒé¿ï¼‰
  â†“
[Stage 3] CriticalStep           - æš´æ“Šåˆ¤å®šï¼ˆæš´æ“Šç‡ vs RNGï¼‰
  â†“
[Stage 4] DamageModifyStep       - å‚·å®³ä¿®æ­£ï¼ˆè¡€å¥‘åŠ æˆã€è£å‚™åŠ æˆï¼‰
  â†“
[Stage 5] DefenseCalculationStep - é˜²ç¦¦è¨ˆç®—ï¼ˆè­·ç”²æ¸›å…ï¼‰
  â†“
[Stage 6] BeforeApplyStep        - æ‡‰ç”¨å‰æœ€å¾Œç¢ºèª
  â†“
[Stage 7] ApplyDamageStep        - æ‰£è¡€ã€æª¢æŸ¥æ­»äº¡
  â†“
[Stage 8] AfterApplyStep         - è§¸ç™¼ afterDamageApply hooks
```

**Hook æ©Ÿåˆ¶**:

- æ¯å€‹ Effect/Equipment å¯å¯¦ä½œ `ICombatHook` ä»‹é¢
- åœ¨ç‰¹å®šéšæ®µæ’å…¥è‡ªè¨‚é‚è¼¯
- ç¯„ä¾‹ï¼š
  - `ChargedCriticalEffect` åœ¨ Stage 3 ä¿®æ”¹æš´æ“Šç‡
  - `BloodPactEffect` åœ¨ Stage 4 ä¿®æ”¹å‚·å®³å€ç‡
  - `GuardianPlateEffect` åœ¨ Stage 5 ä¿®æ”¹è­·ç”²å€¼

**è¨­è¨ˆå„ªé»**:

- **é–‹æ”¾å°é–‰åŸå‰‡**: æ–°å¢æ•ˆæœç„¡éœ€ä¿®æ”¹æ ¸å¿ƒé‚è¼¯
- **è²¬ä»»éˆæ¨¡å¼**: æ¯å€‹ Step å¯çµ‚æ­¢æµç¨‹ï¼ˆå¦‚ Miss å¾Œç›´æ¥è·³å‡ºï¼‰
- **å¯æ¸¬è©¦æ€§**: æ¯å€‹ Step ç¨ç«‹ï¼Œæ˜“æ–¼å–®å…ƒæ¸¬è©¦

---

#### D. æ•ˆæœç³»çµ± (Effect System)

**è·è²¬**: ç®¡ç†è§’è‰²èº«ä¸Šçš„å¢ç›Š/æ¸›ç›Šæ•ˆæœ

**ç”Ÿå‘½é€±æœŸ**:

```typescript
1. onApply(characterId, context)   - æ•ˆæœè¢«æ–½åŠ æ™‚ï¼ˆåˆå§‹åŒ–ï¼‰
2. onTick(characterId, context)    - æ¯å€‹ tick è§¸ç™¼ï¼ˆå¯é¸ï¼‰
3. onRemove(characterId, context)  - æ•ˆæœè¢«ç§»é™¤æ™‚ï¼ˆæ¸…ç†ï¼‰
```

**Hook ä»‹é¢**:

```typescript
interface ICombatHook {
  beforeDamageCalculation?(event, context): DamageEvent
  onHitCheck?(event, context): DamageEvent
  onCritCheck?(event, context): DamageEvent
  onDamageModify?(event, context): DamageEvent
  onDefenseCalculation?(event, context): DamageEvent
  beforeDamageApply?(event, context): DamageEvent
  afterDamageApply?(event, context): void
}
```

**å¯¦ä½œç¯„ä¾‹**:

- `PoisonEffect`: æ¯ tick é€ æˆçœŸå¯¦å‚·å®³ï¼Œæ¯ç§’è¡°æ¸› 10% å±¤æ•¸
- `BloodPactEffect`: ä¿®æ”¹å‚·å®³å€ç‡ï¼Œ3 æ¬¡æ”»æ“Šå¾Œè‡ªå‹•ç§»é™¤
- `ChargedCriticalEffect`: æª¢æ¸¬å……èƒ½ç‹€æ…‹ï¼Œä¿®æ”¹æš´æ“Šç‡

**è¨­è¨ˆå„ªé»**:

- **äº‹ä»¶é©…å‹•**: æ•ˆæœè¢«å‹•éŸ¿æ‡‰ï¼Œä¸ä¸»å‹•è¼ªè©¢
- **çµ±ä¸€ç®¡ç†**: é€é EffectManager é›†ä¸­è™•ç†
- **è³‡æºè¿½è¹¤**: é€é Registry å…¨åŸŸæŸ¥æ‰¾

---

#### E. è£å‚™èˆ‡éºç‰©ç³»çµ±

**è£å‚™ (Equipment)**:

- ç¨ä½”å¼ï¼ˆæ¯å€‹æ§½ä½åªèƒ½è£ä¸€ä»¶ï¼‰
- æ§½ä½é¡å‹ï¼š`weapon`, `armor`, `accessory`
- è£å‚™æ™‚è‡ªå‹•æ‡‰ç”¨å…§å»ºæ•ˆæœ
- å¸ä¸‹æ™‚è‡ªå‹•ç§»é™¤æ•ˆæœ

**éºç‰© (Relic)**:

- å¯å †ç–Šï¼ˆåŒä¸€å€‹éºç‰©å¯æŒæœ‰å¤šå€‹ï¼‰
- æ¯æ¬¡å †ç–Šæœƒé‡æ–°åˆå§‹åŒ–æ•ˆæœ
- ç¯„ä¾‹ï¼š`PoisonVial` å…©å±¤ = æ”»æ“Šæ™‚æ–½åŠ å…©æ¬¡æ¯’ç´ 

**å¯¦ä½œç¯„ä¾‹**:

```typescript
// Stormblade: å……èƒ½æ™‚æš´æ“Šç‡ç¿»å€
class Stormblade extends Equipment {
  constructor() {
    super({ name: 'Stormblade', rarity: 'epic' })
  }
  protected initializeEffects(): void {
    this.effects.push(new ChargedCriticalEffect())
  }
}

// PoisonVial: å¯å †ç–Šæ¯’ç´ 
class PoisonVial extends Relic {
  protected initializeEffects(): void {
    for (let i = 0; i < this.getStackCount(); i++) {
      this.effects.push(new PoisonEffect(1))
    }
  }
}
```

---

#### F. å¤§æ‹›ç³»çµ± (Ultimate)

**èƒ½é‡æ©Ÿåˆ¶**:

- è§’è‰²æœ‰èƒ½é‡æ¢ï¼ˆ0-100ï¼‰
- æ¯æ¬¡æ”»æ“Šç²å¾—èƒ½é‡ï¼ˆç”± `energyGainOnAttack` å±¬æ€§æ±ºå®šï¼‰
- èƒ½é‡æ»¿ 100 æ™‚è‡ªå‹•é‡‹æ”¾å¤§æ‹›

**å¤§æ‹›é¡å‹**:

1. **å‚·å®³å‹** (`ThunderStrikeUltimate`): é€ æˆå€ç‡å‚·å®³
2. **å¢ç›Šå‹** (`BloodPactUltimate`): æ–½åŠ è‡ªèº«æ•ˆæœ

**å¯¦ä½œç¯„ä¾‹**:

```typescript
class BloodPactUltimate implements IUltimateAbility {
  execute(casterId: string, context: ICombatContext): void {
    const caster = context.getCharacter(casterId)
    // 1. æ‰£é™¤ 20% ç”Ÿå‘½
    const maxHp = caster.getAttribute('maxHp')
    const sacrifice = maxHp * 0.2
    caster.setCurrentHpClamped(currentHp - sacrifice)

    // 2. æ–½åŠ  Blood Pact æ•ˆæœï¼ˆ3 æ¬¡æ”»æ“Š 2 å€å‚·å®³ï¼‰
    caster.addEffect(new BloodPactEffect(2.0, 3), context)
  }
}
```

---

#### G. è³‡æºè¨»å†Šè¡¨ (ResourceRegistry)

**è·è²¬**: é›†ä¸­ç®¡ç†æ‰€æœ‰æˆ°é¬¥å…§è³‡æºçš„æŸ¥æ‰¾èˆ‡è¿½è¹¤

**ç®¡ç†è³‡æº**:

- Charactersï¼ˆè§’è‰²ï¼‰
- Effectsï¼ˆæ•ˆæœï¼‰
- Equipmentï¼ˆè£å‚™ï¼‰
- Relicsï¼ˆéºç‰©ï¼‰
- Ultimatesï¼ˆå¤§æ‹›ï¼‰

**ç‚ºä½•éœ€è¦ Registryï¼Ÿ**

1. **é¿å…å¾ªç’°ä¾è³´**: Effect ä¸ç›´æ¥æŒæœ‰ Character å¼•ç”¨ï¼Œè€Œæ˜¯é€é ID æŸ¥æ‰¾
2. **é›†ä¸­è¿½è¹¤**: æ‰€æœ‰æ•ˆæœéƒ½åœ¨ Registry è¨»å†Šï¼Œä¾¿æ–¼é™¤éŒ¯èˆ‡æ¸…ç†
3. **æ•ˆèƒ½å„ªåŒ–**: O(1) Map æŸ¥æ‰¾

**å¯¦ä½œ**:

```typescript
class InMemoryResourceRegistry implements IResourceRegistry {
  private characters = new Map<string, ICharacter>()
  private effects = new Map<string, IEffect>()
  // ...

  registerEffect(effect: IEffect): void {
    this.effects.set(effect.id, effect)
  }

  getEffect(id: string): IEffect | undefined {
    return this.effects.get(id)
  }
}
```

---

#### H. äº‹ä»¶ç¸½ç·š (EventBus)

**è·è²¬**: è§£è€¦ç³»çµ±é–“é€šè¨Šï¼Œæ¡ç”¨ç™¼å¸ƒ/è¨‚é–±æ¨¡å¼

**æ”¯æ´äº‹ä»¶**:

- `combat:start` / `combat:end`
- `tick:start` / `tick:end`
- `entity:attack` / `entity:damage` / `entity:death`
- `ultimate:cast`

**ä½¿ç”¨ç¯„ä¾‹**:

```typescript
// è¨‚é–±äº‹ä»¶
context.eventBus.on('entity:death', (payload) => {
  console.log(`${payload.targetId} æ­»äº¡`)
})

// ç™¼å¸ƒäº‹ä»¶
context.eventBus.emit('entity:death', { targetId: 'Goblin1' })
```

**è¨­è¨ˆå„ªé»**:

- **é¬†è€¦åˆ**: ç³»çµ±ä¹‹é–“ä¸ç›´æ¥èª¿ç”¨
- **å¯æ“´å±•**: æ–°å¢ç›£è½å™¨ä¸å½±éŸ¿æ—¢æœ‰ç³»çµ±
- **è¨˜éŒ„å‹å–„**: Logger é€éç›£è½äº‹ä»¶è‡ªå‹•è¨˜éŒ„

---

### 2.3 Combat-Impl å¯¦ä½œå±¤

**ç›®éŒ„çµæ§‹**:

```
combat-impl/
â”œâ”€â”€ effects/          - å…·é«”æ•ˆæœå¯¦ä½œ
â”‚   â”œâ”€â”€ Equipment/    - è£å‚™æ•ˆæœï¼ˆChargedCriticalEffectï¼‰
â”‚   â””â”€â”€ NativeStatus/ - ç‹€æ…‹æ•ˆæœï¼ˆPoisonEffectï¼‰
â”œâ”€â”€ equipment/        - è£å‚™å®šç¾©ï¼ˆStormblade, GuardiansPlateï¼‰
â”œâ”€â”€ relics/           - éºç‰©å®šç¾©ï¼ˆPoisonVialï¼‰
â”œâ”€â”€ ultimates/        - å¤§æ‹›å®šç¾©ï¼ˆThunderStrike, BloodPactï¼‰
â””â”€â”€ examples/         - ä½¿ç”¨ç¯„ä¾‹ï¼ˆsimpleCombat.tsï¼‰
```

**å·²å¯¦ä½œå…§å®¹**:

| é¡å‹ | åç¨±                  | åŠŸèƒ½                   |
| ---- | --------------------- | ---------------------- |
| è£å‚™ | Stormblade            | å……èƒ½æ™‚æš´æ“Šç‡ç¿»å€       |
| è£å‚™ | Guardian's Plate      | ä½è¡€é‡æ™‚è­·ç”²æå‡       |
| éºç‰© | Poison Vial           | æ”»æ“Šé™„åŠ æ¯’ç´ ï¼ˆå¯å †ç–Šï¼‰ |
| å¤§æ‹› | Thunder Strike        | ç¯„åœå‚·å®³ï¼ˆç•¶å‰ç‚ºå–®é«”ï¼‰ |
| å¤§æ‹› | Blood Pact            | çŠ§ç‰²ç”Ÿå‘½å¼·åŒ–æ”»æ“Š       |
| æ•ˆæœ | PoisonEffect          | æŒçºŒå‚·å®³ + è¡°æ¸›        |
| æ•ˆæœ | BloodPactEffect       | å‚·å®³åŠ æˆ + è¨ˆæ•¸å™¨      |
| æ•ˆæœ | ChargedCriticalEffect | æš´æ“Šç‡ä¿®æ­£             |

---

## ä¸‰ã€æ¶æ§‹å„ªå‹¢åˆ†æ

### 3.1 è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨

| æ¨¡å¼           | æ‡‰ç”¨ä½ç½®                        | å„ªå‹¢                     |
| -------------- | ------------------------------- | ------------------------ |
| **è²¬ä»»éˆæ¨¡å¼** | DamageChain                     | å¯æ“´å±•ã€å¯ä¸­æ–·ã€é‚è¼¯æ¸…æ™° |
| **ç­–ç•¥æ¨¡å¼**   | TargetSelector                  | éˆæ´»åˆ‡æ›ç›®æ¨™é¸æ“‡é‚è¼¯     |
| **è§€å¯Ÿè€…æ¨¡å¼** | EventBus                        | è§£è€¦ç³»çµ±ã€æ˜“æ–¼æ“´å±•       |
| **å»ºé€ è€…æ¨¡å¼** | ResultBuilder                   | è¤‡é›œç‰©ä»¶å»ºæ§‹æ¸…æ™°         |
| **å·¥å» æ¨¡å¼**   | DamageFactory                   | çµ±ä¸€å»ºç«‹ DamageEvent     |
| **ç®¡ç†è€…æ¨¡å¼** | EffectManager, EquipmentManager | è·è²¬åˆ†é›¢ã€é«˜å…§èš         |
| **è¨»å†Šè¡¨æ¨¡å¼** | ResourceRegistry                | é›†ä¸­ç®¡ç†ã€é¿å…å¾ªç’°ä¾è³´   |

### 3.2 SOLID åŸå‰‡éµå¾ª

**S - å–®ä¸€è·è²¬åŸå‰‡ (SRP)**

- âœ… æ¯å€‹ Manager åªè™•ç†ä¸€ç¨®è³‡æº
- âœ… æ¯å€‹ Step åªè™•ç†ä¸€å€‹éšæ®µ
- âœ… Logger åªè² è²¬è¨˜éŒ„ï¼ŒSnapshot åªè² è²¬å¿«ç…§

**O - é–‹æ”¾å°é–‰åŸå‰‡ (OCP)**

- âœ… DamageChain é€é Hook æ“´å±•ï¼Œç„¡éœ€ä¿®æ”¹æ ¸å¿ƒ
- âœ… æ–°å¢æ•ˆæœ/è£å‚™åªéœ€å¯¦ä½œä»‹é¢

**L - é‡Œæ°æ›¿æ›åŸå‰‡ (LSP)**

- âœ… ITargetSelector æ‰€æœ‰å¯¦ä½œå¯äº’æ›
- âœ… IEffect æ‰€æœ‰å¯¦ä½œå¯äº’æ›

**I - ä»‹é¢éš”é›¢åŸå‰‡ (ISP)**

- âœ… ICombatHook æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯ optional
- âœ… IUltimateAbility åªå®šç¾©å¿…è¦æ–¹æ³•

**D - ä¾è³´å€’ç½®åŸå‰‡ (DIP)**

- âœ… é«˜å±¤æ¨¡çµ„ä¾è³´æŠ½è±¡ï¼ˆIResourceRegistry, ICombatContextï¼‰
- âš ï¸ **æœªå®Œå…¨å¯¦è¸**ï¼ˆè©³è¦‹ä¸‹æ–¹å•é¡Œåˆ†æï¼‰

### 3.3 æŠ€è¡“äº®é»

1. **Type-Safe Event System**
   - ä½¿ç”¨ TypeScript çš„ Mapped Types ä¿è­‰äº‹ä»¶é¡å‹å®‰å…¨
   - `EventMap` + `EventPayloads` é¿å…éŒ¯èª¤çš„ payload

2. **è³‡æº ID ç®¡ç†**
   - ä½¿ç”¨ nanoid ç”¢ç”Ÿå”¯ä¸€ ID
   - ç°¡åŒ–æŸ¥æ‰¾é‚è¼¯ï¼ˆå­—ä¸² ID vs ç‰©ä»¶å¼•ç”¨ï¼‰

3. **å±¬æ€§è¨ˆç®—åˆ†é›¢**
   - AttributeContainerï¼ˆè³‡æ–™ï¼‰èˆ‡ AttributeCalculatorï¼ˆé‚è¼¯ï¼‰åˆ†é›¢
   - æ”¯æ´ Modifier å„ªå…ˆé †åºèˆ‡åŠ /ä¹˜ç®—

4. **Hook ç³»çµ±å½ˆæ€§**
   - Effect åŒæ™‚å¯¦ä½œ IEffect èˆ‡ ICombatHook
   - åœ¨å‚·å®³éˆä»»æ„éšæ®µæ’å…¥é‚è¼¯

---

## å››ã€æ¶æ§‹ç¼ºé™·èˆ‡æ”¹é€²å»ºè­°ï¼ˆè³‡æ·±æ¶æ§‹å¸«è¦–è§’ï¼‰

### 4.1 åš´é‡å•é¡Œ

#### ğŸ”´ å•é¡Œ 1: ä¾è³´å€’ç½®åŸå‰‡æœªå¾¹åº•å¯¦è¸

**ç¾æ³**:

```typescript
// IEffect ä»‹é¢å®šç¾©åœ¨ domain å±¤ï¼Œå»ä¾è³´ context å±¤çš„å…·é«”å‹åˆ¥
import type { ICombatContext } from '@/modules/combat/context'

interface IEffect {
  onApply(characterId: string, context: ICombatContext): void
  onTick?(characterId: string, context: ICombatContext): void
}
```

**å•é¡Œ**:

- Domain å±¤ï¼ˆé«˜å±¤ï¼‰ä¾è³´ Context å±¤ï¼ˆä½å±¤ï¼‰çš„å…·é«”ä»‹é¢
- é•åã€Œä¾è³´ç®­é ­å‘ä¸‹ã€åŸå‰‡
- è‹¥é·ç§»åˆ° C#/Javaï¼Œæœƒå½¢æˆå°ˆæ¡ˆå¾ªç’°ä¾è³´

**è§£æ±ºæ–¹æ¡ˆ**:

```typescript
// å°‡ ICombatContext ç§»è‡³ domain/shared/interfaces/
// Domain å®šç¾©å¥‘ç´„ï¼ŒContext å±¤å¯¦ä½œå¥‘ç´„
domain/shared/interfaces/combat-context.interface.ts
  â†‘ (å®šç¾©)
context/combat.context.ts (å¯¦ä½œ)
```

**åƒè€ƒæ–‡æª”**: `dev_log/v0.5/å¾ªç’°.md` å·²è©³ç´°èªªæ˜

---

#### ğŸ”´ å•é¡Œ 2: CombatContext ä½œç‚º God Object

**ç¾æ³**:

```typescript
class CombatContext {
  readonly eventBus: EventBus
  readonly rng: CombatRandomGenerator
  readonly registry: IResourceRegistry

  getEntity(), addEntity(), removeEntity()
  getCurrentTick(), incrementTick(), resetTick()
  // æ‰€æœ‰ç³»çµ±éƒ½ä¾è³´é€™å€‹å·¨å‹ç‰©ä»¶
}
```

**å•é¡Œ**:

- é•åå–®ä¸€è·è²¬åŸå‰‡ï¼ˆç®¡ç†å¯¦é«” + Tick + æä¾›å·¥å…·ï¼‰
- æœªä¾†æ“´å±•æœƒè¶Šä¾†è¶Šè‡ƒè…«
- é›£ä»¥å–®å…ƒæ¸¬è©¦ï¼ˆMock æˆæœ¬é«˜ï¼‰

**å»ºè­°é‡æ§‹**:

```typescript
// æ‹†åˆ†ç‚ºå¤šå€‹å°ˆæ³¨çš„ Context
interface IEntityRepository {
  getEntity(id: string): IEntity | undefined
  addEntity(entity: IEntity): void
  // ...
}

interface ITickProvider {
  getCurrentTick(): number
  incrementTick(): void
}

interface ICombatInfrastructure {
  readonly eventBus: EventBus
  readonly rng: CombatRandomGenerator
}

// CombatContext çµ„åˆé€™äº›ä»‹é¢
class CombatContext {
  readonly entities: IEntityRepository
  readonly tick: ITickProvider
  readonly infra: ICombatInfrastructure
  readonly registry: IResourceRegistry
}
```

---

#### ğŸ”´ å•é¡Œ 3: Effect ä»‹é¢çš„é›™é‡è·è²¬

**ç¾æ³**:

```typescript
// IEffect åŒæ™‚æ˜¯è³‡æ–™èˆ‡è¡Œç‚º
interface IEffect {
  readonly id: string
  readonly name: string
  onApply(...)
  onTick(...)
  onRemove(...)
}

// å¯¦ä½œæ™‚åˆå¯¦ä½œ ICombatHook
class BloodPactEffect implements IEffect, ICombatHook {
  // ...
}
```

**å•é¡Œ**:

- Effectï¼ˆè³‡æ–™ï¼‰èˆ‡ Hookï¼ˆè¡Œç‚ºï¼‰æ··åˆ
- é•åå–®ä¸€è·è²¬åŸå‰‡
- æœªä¾†è‹¥è¦åˆ†é›¢ã€Œæ•ˆæœé¡¯ç¤ºã€èˆ‡ã€Œæ•ˆæœé‚è¼¯ã€æœƒå¾ˆç—›è‹¦

**å»ºè­°è¨­è¨ˆ**:

```typescript
// è³‡æ–™èˆ‡è¡Œç‚ºåˆ†é›¢
interface IEffectData {
  readonly id: string
  readonly name: string
  readonly duration?: number
  readonly stacks?: number
}

interface IEffectBehavior {
  onApply(effect: IEffectData, target: ICharacter, context): void
  onTick?(effect: IEffectData, target: ICharacter, context): void
  onRemove?(effect: IEffectData, target: ICharacter, context): void
}

// Effect æŒæœ‰è³‡æ–™ï¼ŒBehavior è™•ç†é‚è¼¯
class Effect {
  constructor(
    private data: IEffectData,
    private behavior: IEffectBehavior
  ) {}
}
```

---

### 4.2 ä¸­ç­‰å•é¡Œ

#### ğŸŸ¡ å•é¡Œ 4: æ™‚é–“ç®¡ç†è€¦åˆç€è¦½å™¨ API

**ç¾æ³**:

```typescript
// PoisonEffect.ts
const ticksPassed = currentTick - this.lastDecayTick
const secondsPassed = ticksPassed / 100 // å‡è¨­ 100 ticks = 1 ç§’
```

**å•é¡Œ**:

- ç¡¬ç·¨ç¢¼æ™‚é–“è½‰æ›ï¼ˆ100 ticks/ç§’ï¼‰
- è‹¥è¦æ”¯æ´è®Šé€Ÿå›æ”¾æˆ–ä¸åŒå¹€ç‡ï¼Œéœ€å¤§é‡ä¿®æ”¹
- ä¸ç¬¦åˆã€Œæ™‚é–“æŠ½è±¡ã€åŸå‰‡

**å»ºè­°**:

```typescript
// å¼•å…¥ TimeProvider
interface ITimeProvider {
  ticksToSeconds(ticks: number): number
  secondsToTicks(seconds: number): number
  readonly tickRate: number // ticks per second
}

// åœ¨ CombatConfig ä¸­é…ç½®
class CombatConfig {
  readonly tickRate: number = 100 // å¯èª¿æ•´
}

// Effect ä½¿ç”¨
const secondsPassed = context.time.ticksToSeconds(ticksPassed)
```

---

#### ğŸŸ¡ å•é¡Œ 5: è³‡æºæŸ¥æ‰¾æ•ˆèƒ½æœªå„ªåŒ–

**ç¾æ³**:

```typescript
// æ¯æ¬¡å­˜å–éƒ½éœ€è¦ Map æŸ¥æ‰¾
const effect = context.registry.getEffect(effectId)
const character = context.registry.getCharacter(characterId)
```

**å•é¡Œ**:

- é »ç¹æŸ¥æ‰¾æœƒæœ‰æ•ˆèƒ½é–‹éŠ·ï¼ˆé›–ç„¶ O(1)ï¼‰
- æœªä¾†è‹¥åˆ‡æ›åˆ° Redis ç­‰é ç«¯å„²å­˜ï¼Œæœƒè®Šæˆ async æ“ä½œ

**å»ºè­°**:

```typescript
// å¼•å…¥å¿«å–å±¤
class CachedResourceRegistry implements IResourceRegistry {
  private cache = new Map<string, any>()

  getEffect(id: string): IEffect | undefined {
    if (this.cache.has(id)) return this.cache.get(id)
    const effect = this.registry.getEffect(id)
    if (effect) this.cache.set(id, effect)
    return effect
  }
}
```

---

#### ğŸŸ¡ å•é¡Œ 6: ç¼ºä¹éŒ¯èª¤è™•ç†

**ç¾æ³**:

```typescript
// å¹¾ä¹æ‰€æœ‰æ–¹æ³•éƒ½æ²’æœ‰ try-catch
execute(event: DamageEvent): void {
  for (const step of this.steps) {
    const shouldContinue = step.execute(event, context)
    if (!shouldContinue) break
  }
}
```

**å•é¡Œ**:

- è‹¥æŸå€‹ Step æ‹‹å‡ºç•°å¸¸ï¼Œæ•´å€‹æˆ°é¬¥å´©æ½°
- ç„¡æ³•è¿½è¹¤éŒ¯èª¤ä¾†æº
- ä¸ç¬¦åˆå·¥ç¨‹ç©©å¥æ€§è¦æ±‚

**å»ºè­°**:

```typescript
execute(event: DamageEvent): void {
  for (const step of this.steps) {
    try {
      const shouldContinue = step.execute(event, context)
      if (!shouldContinue) break
    } catch (error) {
      console.error(`Step ${step.constructor.name} failed:`, error)
      context.eventBus.emit('combat:error', { step, error, event })
      break // æˆ–ç¹¼çºŒä¸‹ä¸€å€‹ step
    }
  }
}
```

---

### 4.3 å°å•é¡Œ

#### ğŸŸ¢ å•é¡Œ 7: ç¼ºä¹å–®å…ƒæ¸¬è©¦

**ç¾æ³**: ç„¡ä»»ä½•æ¸¬è©¦æª”æ¡ˆ

**å½±éŸ¿**: é‡æ§‹é¢¨éšªé«˜ï¼Œç„¡æ³•ä¿è­‰æ­£ç¢ºæ€§

**å»ºè­°**:

- å„ªå…ˆæ¸¬è©¦ DamageChainï¼ˆæ ¸å¿ƒé‚è¼¯ï¼‰
- æ¸¬è©¦ AttributeCalculatorï¼ˆè¤‡é›œè¨ˆç®—ï¼‰
- æ¸¬è©¦ Effect ç”Ÿå‘½é€±æœŸ

---

#### ğŸŸ¢ å•é¡Œ 8: é­”æ³•æ•¸å­—èˆ‡å­—ä¸²

**ç¾æ³**:

```typescript
const sacrifice = maxHp * 0.2 // 20% æ˜¯ä»€éº¼ï¼Ÿ
const damageMultiplier = 2.0 // ç‚ºä½•æ˜¯ 2ï¼Ÿ
```

**å»ºè­°**:

```typescript
// åœ¨ config ä¸­å®šç¾©
export const BloodPactConfig = {
  HP_SACRIFICE_RATIO: 0.2,
  DAMAGE_MULTIPLIER: 2.0,
  ATTACK_COUNT: 3,
} as const
```

---

#### ğŸŸ¢ å•é¡Œ 9: è¨˜æ†¶é«”ç®¡ç†æœªè€ƒæ…®

**ç¾æ³**:

- æˆ°é¬¥çµæŸå¾Œï¼Œæ‰€æœ‰ç‰©ä»¶ä»åœ¨è¨˜æ†¶é«”ä¸­
- æœªä¸»å‹•æ¸…ç†äº‹ä»¶ç›£è½å™¨

**å»ºè­°**:

```typescript
// åœ¨ CombatEngine.dispose() ä¸­
dispose(): void {
  this.ticker.stop()
  this.tickActionSystem.dispose()
  this.snapshotCollector.dispose()
  this.context.eventBus.removeAllListeners() // æ¸…ç†æ‰€æœ‰ç›£è½
  this.context.registry.clear() // æ¸…ç©º Registry
}
```

---

## äº”ã€ä¸‹ä¸€æ­¥è¦åŠƒå»ºè­°

### 5.1 çŸ­æœŸï¼ˆ1-2 é€±ï¼‰

1. **è§£æ±ºå¾ªç’°ä¾è³´å•é¡Œ**
   - å¯¦ä½œ DIP é‡æ§‹ï¼ˆåƒè€ƒ `dev_log/v0.5/å¾ªç’°.md`ï¼‰
   - å°‡ `ICombatContext` ç§»è‡³ `domain/shared/interfaces/`

2. **æ–°å¢å–®å…ƒæ¸¬è©¦**
   - DamageChain æ¸¬è©¦ï¼ˆ8 å€‹ Stepï¼‰
   - AttributeCalculator æ¸¬è©¦
   - Effect ç”Ÿå‘½é€±æœŸæ¸¬è©¦

3. **å®Œå–„éŒ¯èª¤è™•ç†**
   - åœ¨é—œéµè·¯å¾‘åŠ å…¥ try-catch
   - æ–°å¢ `combat:error` äº‹ä»¶

### 5.2 ä¸­æœŸï¼ˆ1 å€‹æœˆï¼‰

1. **é‡æ§‹ CombatContext**
   - æ‹†åˆ†ç‚º EntityRepository, TickProvider, Infrastructure

2. **æ™‚é–“ç³»çµ±æŠ½è±¡**
   - å¼•å…¥ ITimeProvider
   - æ”¯æ´å¯é…ç½®çš„ tick rate

3. **æ•ˆèƒ½å„ªåŒ–**
   - å¯¦ä½œå¿«å–å±¤
   - Benchmark æ¸¬è©¦ï¼ˆ1000+ å›åˆæˆ°é¬¥ï¼‰

### 5.3 é•·æœŸï¼ˆ3 å€‹æœˆ+ï¼‰

1. **UI æ•´åˆ**
   - æˆ°é¬¥å›æ”¾ä»‹é¢ï¼ˆåŸºæ–¼ Replay æ¨¡çµ„ï¼‰
   - å³æ™‚æˆ°é¬¥é¡¯ç¤º

2. **æˆ°é¬¥å¤–ç³»çµ±**
   - é—œå¡é¸æ“‡
   - å•†åº—ç³»çµ±
   - è§’è‰²é¤Šæˆ

3. **æŒä¹…åŒ–**
   - å­˜æª”ç³»çµ±
   - è³‡æ–™åº«æ•´åˆï¼ˆè€ƒæ…® Redisï¼‰

---

## å…­ã€ç¸½çµ

### å„ªé»

1. âœ… **åˆ†å±¤æ¸…æ™°**ï¼šå…­å±¤æ¶æ§‹ï¼Œè·è²¬æ˜ç¢º
2. âœ… **ä½è€¦åˆ**ï¼šäº‹ä»¶é©…å‹•ï¼Œç³»çµ±é–“é¬†æ•£è€¦åˆ
3. âœ… **é«˜å¯è®€æ€§**ï¼šå‘½åèªç¾©åŒ–ï¼Œè¨»è§£å®Œæ•´
4. âœ… **å¯æ“´å±•**ï¼šHook æ©Ÿåˆ¶ï¼Œç„¡éœ€ä¿®æ”¹æ ¸å¿ƒå³å¯æ“´å±•
5. âœ… **å‹åˆ¥å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨ TypeScript éœæ…‹æª¢æŸ¥

### ç¼ºé»

1. âŒ **DIP æœªå¾¹åº•**ï¼šå­˜åœ¨å‘ä¸Šä¾è³´
2. âŒ **God Object**ï¼šCombatContext è·è²¬éå¤š
3. âŒ **ç¼ºä¹æ¸¬è©¦**ï¼šé‡æ§‹é¢¨éšªé«˜
4. âŒ **éŒ¯èª¤è™•ç†ä¸è¶³**ï¼šç©©å¥æ€§å¾…åŠ å¼·
5. âŒ **è¨˜æ†¶é«”ç®¡ç†**ï¼šæœªè€ƒæ…®é•·æ™‚é–“é‹è¡Œ

### æ•´é«”è©•åƒ¹

**ç•¶å‰ç‹€æ…‹**: â­â­â­â­â˜† (4/5)

- ä½œç‚º v0.5 åŸå‹ï¼Œå·²å±•ç¾è‰¯å¥½çš„æ¶æ§‹è¨­è¨ˆèƒ½åŠ›
- æ ¸å¿ƒåŠŸèƒ½å®Œæ•´å¯ç”¨ï¼Œå¯æ”¯æ´è¤‡é›œæˆ°é¬¥æ¨¡æ“¬
- éœ€è§£æ±ºæ¶æ§‹ç¼ºé™·å¾Œï¼Œæ‰é©åˆé€²å…¥ç”Ÿç”¢ç’°å¢ƒ

**å»ºè­°**: å„ªå…ˆè™•ç† DIP å•é¡Œèˆ‡å–®å…ƒæ¸¬è©¦ï¼Œå†é€²è¡ŒåŠŸèƒ½æ“´å±•ã€‚

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-02  
**æ’°å¯«è€…**: GitHub Copilot (AI Assistant)
