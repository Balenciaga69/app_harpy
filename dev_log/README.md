# 摘要

## _2025/11/30_

- 今天是禮拜日，終於完成了基於 Tick 機制的戰鬥系統初步原型。為了支援複雜非線性戰鬥邏輯，複雜度遠超預期。我原本希望實現類似《流亡黯道》中「物理傷害轉為火焰傷害」、「承受冰傷害視為毒傷害」、或「暴擊時觸發兩次運算」之類的特殊規則，結果在架構設計與數據模型上花了大量時間打底。
- 開發過程中，我負責整體架構設計、數據模型繪製，以及各種設計模式與架構取捨；Copilot 生產了約 99% 程式碼，我只需做最後的修整與整合。
- 一開始構想很單純：建立一個每 Tick 發事件、每 Tick 收事件的 Queue 系統，再以事件優先級決定執行順序，藉此模擬複雜戰鬥邏輯。實作後才發現管理成本高得離譜，因此決定重構成 v0.2。
- 在開發到一半時，我重新審視遊戲整體機制。研究《聯盟戰棋》、《選技大亂鬥》、《背包大亂鬥》等作品後，發現它們的輕量化核心更符合我專案目前的方向，因此決定從遊戲設計層面重新調整戰鬥系統的根本理念。
- 調整方向包括：導入「大招系統」，並移除或大幅簡化複雜的元素抗性與多重傷害轉換。所幸前期架構保持乾淨、模組化，變更影響被控制在合理範圍內。

### v0.2(combat)

- 由於發現原本流亡黯道那種複雜傷害計算，在目前量級超難做，而且也不有趣，所以往讓戰鬥機制更輕量、更直覺的方向前進。
- 用更簡單的事件觀察者模式取代原本的事件隊列系統，降低複雜度。

## _2025/12/01_

- 開始思考數值與屬性，並參考《聯盟戰棋》、《選技大亂鬥》的定位與數值邏輯，也開始規劃大招特性的核心方向。
- 重新檢視分層架構與單向依賴，降低模組耦合度。
- 導入物品系統與大招系統。

### v0.3(combat)

- 新增物品與大招系統機制
- 重構代碼，讓每塊代碼都更獨立、更整齊，未來新增功能或修改 bug 時會更有效率。

## _2025/12/02_

- 回放系統交由 AI 自動生成初版，雖然還沒檢視效果，但預感不妙，後續需要打磨。
- 開始反思循環依賴與多個 combat 元件之間的關係，AI 自動生成的部分有些混亂，考慮導入洋蔥架構並以 eslint 約束依賴邊界。

### v0.3(combat)

- 目的: 降低耦合度、解決物件循環依賴問題。
- 戰鬥邏輯跟角色屬性綁得太緊了，所以拆解它們之間的關聯，讓戰鬥系統可以獨立運作，為未來的擴展打好基礎。
- 將 AbilitySystem 與 Tick 功能整合為 TickActionSystem，使其更貼合 Tick 機制的實際運作。

### v0.3(combat)

- 目的: 統一管理資源、遵循單一職責原則。
- 引入資源 Registry 作為中央資源管理系統，所有角色、裝備、大招等，都必須透過這個「中央銀行」來互相查找和調用，這樣就能避免大家「私下聯繫」導致程式混亂。
- 我們把 TickActionSystem 拆成了「每 Tick 發出/處理訊號」兩個核心元件，
- 加入了更多細緻的「戰鬥流程檢查點（CombatHooks）」，這樣未來要新增或修改戰鬥中的特殊判定（例如：閃避、格檔）就會非常方便。

## _2025/12/03_

- 權衡 mitt 與同步嚴格性在我的 combat 模組中的用途與意義。
- 重新構思 效果系統與疊層機制
- CODE REVIEW AI 生成的回放系統與戰鬥範例

### v0.3.1:(combat)

- 目的: 統一管理資源、遵循單一職責原則、乾淨代碼。
- 把角色屬性和效果的程式碼都拆分得更細，讓每個小區塊的功能都更專一。
- 重新檢查了所有檔案和變數的名稱，讓它們的命名更符合專案的標準
- TickActionSystem 現在可以把一個複雜的動作（如：放一個大招）拆成幾個更小的階段（Phase 拼裝），這讓戰鬥邏輯的控制更精準、更有彈性。

## _2025/12/04_

- 繼續構思與修正 Replay 模組並對 AI 生成的代碼進行 Code Review
- 上班太累，懶得更深入思考新的業務邏輯。做些簡單的事情。

### v0.3.1:(replay)

- 替 AI 生成的 Replay Module 決定採用 MVC 架構
- 對模組設下了嚴格的規範，限制了哪些功能可以 export，確保它的穩定性。

## _2025/12/05_

- 探討純函數 ECS 與 OOP 開發上的差異
- 研究 immer.js 與純函數
- 研究 不使用 Global Singleton 的依賴注入模式的原因(單例測試困難、跨語言移植、多實例支援)

### v0.3.1:(combat)

- 新增 CharacterBuilder 讓建立角色更方便
- 將 BattleState 從 CombatContext 中拆分出來，讓系統對戰鬥過程的數據追蹤更集中、更單純。
- 預計在 v0.4 從物件導向設計改為資料驅動的不可變純函數版本，讓狀態溯源、複雜邏輯交互更好追蹤。

### v0.3.2:(combat)

- 新增 Error Handling 與 更詳細的事件日誌
