# 摘要

## _2025/11/30_

- 今天是禮拜日，終於完成了基於 Tick 機制的戰鬥系統初步原型。為了支援複雜非線性戰鬥邏輯，複雜度遠超預期。我原本希望實現類似《流亡黯道》中「物理傷害轉為火焰傷害」、「承受冰傷害視為毒傷害」、或「暴擊時觸發兩次運算」之類的特殊規則，結果在架構設計與數據模型上花了大量時間打底。
- 開發過程中，我負責整體架構設計、數據模型繪製，以及各種設計模式與架構取捨；Copilot 生產了約 99% 程式碼，我只需做最後的修整與整合。
- 一開始構想很單純：建立一個每 Tick 發事件、每 Tick 收事件的 Queue 系統，再以事件優先級決定執行順序，藉此模擬複雜戰鬥邏輯。實作後才發現管理成本高得離譜，因此決定重構成 v0.2。
- 在開發到一半時，我重新審視遊戲整體機制。研究《聯盟戰棋》、《選技大亂鬥》、《背包大亂鬥》等作品後，發現它們的輕量化核心更符合我專案目前的方向，因此決定從遊戲設計層面重新調整戰鬥系統的根本理念。
- 調整方向包括：導入「大招系統」，並移除或大幅簡化複雜的元素抗性與多重傷害轉換。所幸前期架構保持乾淨、模組化，變更影響被控制在合理範圍內。

### v0.2(combat)

- 角色屬性與戰鬥流程從 POE 式重度複雜轉向更輕量、更易維護的設計。
- 用更簡單的事件觀察者模式取代原本的事件隊列系統，降低複雜度。

## _2025/12/01_

- 開始思考數值與屬性，並參考《聯盟戰棋》、《選技大亂鬥》的定位與數值邏輯，也開始規劃大招特性的核心方向。
- 重新檢視分層架構與單向依賴，降低模組耦合度。
- 導入物品系統與大招系統。

### v0.3(combat)

- 新增物品與大招系統，並優化戰鬥模組的分層與依賴設計。

## _2025/12/02_

- 回放系統交由 AI 自動生成初版，雖然還沒檢視效果，但預感不妙，後續需要打磨。
- 開始反思循環依賴與多個 combat 元件之間的關係，AI 自動生成的部分有些混亂，考慮導入洋蔥架構並以 eslint 約束依賴邊界。

### v0.3(combat)

- 目的: 降低耦合度、解決物件循環依賴問題。
- 改善介面與依賴，降低耦合度，但目前戰鬥與角色仍深度綁定，未來若要支援非同步模式會受限。
- 將 ability-system 與 Tick 功能整合為 tick-action-system，使其更貼合 Tick 機制的實際運作。

### v0.3(combat)

- 目的: 統一管理資源、遵循單一職責原則。
- 引入資源 Registry 作為中央資源管理系統，並將介面改為 unknown 型別以避免循環依賴。
- 移除無用的 character id、entity id，改以資源 ID 並透過 Registry 查詢實體。
- 為大招、裝備、聖物新增專屬管理器（比照效果管理器），皆透過 Registry 解耦角色依賴。
- 將 TickActionSystem 拆成更小的子系統。
- 調整為「每 Tick 發事件」與「每 Tick 處理事件」的雙元件模式，並將效果、大招全面物件化、註冊化、管理化。導入更細緻的事件觸發與戰鬥流程鉤子，每個鉤子負責當前階段的專屬事件處理。

## _2025/12/03_

- 權衡 mitt 與同步嚴格性在我的 combat 模組中的用途與意義。
- 重新構思 效果系統與疊層機制
- CODE REVIEW AI 生成的回放系統與戰鬥範例

### v0.3.1:(combat)

- 目的: 統一管理資源、遵循單一職責原則、乾淨代碼。
- combat 屬性與效果模塊代碼拆分細緻化，同時重新定義語意表達。
- 重新 rename folder,file names 與 internal naming，使其更符合專案命名規範與語意。
- TickActionSystem 添加 Phase 拼裝概念，讓觸發流程可以被拆分成更細的階段。

## _2025/12/04_

- 繼續構思與修正 Replay 模組並對 AI 生成的代碼進行 Code Review
- 上班太累，懶得更深入思考新的業務邏輯。做些簡單的事情。

### v0.3.2:(replay)

- 定義好 replay 模組內部架構 model-service-controller
- 對模組 export 的代碼附加更嚴格限制

## _2025/12/05_

- 探討純函數 ECS 與 OOP 開發上的差異
- 研究 immer.js 與純函數
- 研究 不使用 Global Singleton 的依賴注入模式的原因(單例測試困難、跨語言移植、多實例支援)

### v0.3.2:(combat)

- 新增 CharacterBuilder 讓建立角色更方便
- 拆分 CombatContext 分離出 BattleState 物件
