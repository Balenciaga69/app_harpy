認證機制方案科普與權衡分析

我決定採用 JWT 你覺得要定案還是討論?

Access Token 15 min 存在 Memory 中。
Refresh Token 7 days 存在 HttpOnly Cookie，專門用來換取新的 Access Token。
---
在 Serverless (Lambda) 環境下，Session-Based 會讓你非常痛苦，因為 Lambda 是無狀態的，你必須強迫每一台分散的運算節點去連線同一個 Redis 或資料庫來驗證 Session。 似乎很痛苦?
---
不要發一個有效期一年的 Token 給玩家。
如果玩家帳號被盜，你可以註銷該 Refresh Token
JWT 的內容是 Base64 編碼，任何人都能解碼。 所以別放任何遊戲數值

利用 API Gateway 的內建功能，它會在請求到達 Lambda 前先幫你擋掉無效的 Token。


匿名階段 (Anonymous)
玩家打開遊戲，Lambda 發一個 JWT 給他，裡面的 sub (Subject) 放一個隨機 UUID。
在後端資料庫（如 DynamoDB,redis aof, pgsql等等）幫這個 UUID 建立一份「臨時帳號」。
但他沒存檔功能

玩家決定用 Google 或 Email 登入。(但我們先假定大家密碼都是12345)
或者我們乾脆做一個臨時的創帳號測試 api 帳號我輸入 但密碼統一 12345
關鍵動作：Lambda 將「臨時帳號」下的存檔數據移轉到「正式帳號」下。
重新發一個 anonymous: false 的正式 JWT 給玩家。

sub (Subject): 最重要欄位。放用戶的唯一 UUID。Lambda 收到請求後，直接拿這個 ID 去 DynamoDB 讀取存檔。

iss (Issuer): 簽發者，防止別人的 Token 混進來。

iat / exp: 簽發時間與過期時間。這是由 AWS API Gateway 或你的驗證庫自動檢查的，防止 Token 被無限期使用。

role / scopes: 權限標記。例如 admin 或 player。

is_anon (自定義): 布林值。標記這是否為「匿名帳號」。如果是 true，Lambda 可以限制他不能上傳排行榜數據。

ver (版本號): 當你以後更改了存檔結構或安全策略，可以用這個版本號強制舊版的 Token 失效。

@nestjs/jwt
. 實作 JwtStrategy (Passport) JWT 模組 等等
自定義 Guard 來分辨「這是一個匿名 JWT」還是「這是一個正式用戶 JWT」，