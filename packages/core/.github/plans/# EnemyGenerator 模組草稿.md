# EnemyGenerator 模組規格說明

## 簡介

EnemyGenerator 模組負責根據難度係數生成敵人實例，包括基礎屬性、裝備遺物和大招選擇。模組採用工廠模式整合 DifficultyScaler 和 ItemGenerator，確保敵人強度與遊戲進度匹配。支援固定模板與動態調整的混合設計，簡化敵人定義同時保持平衡性。最後更新時間：2025/12/10。

## 輸入與輸出

### 主要輸入

- 難度係數（difficulty: number）：決定敵人屬性範圍、裝備品質和大招強度
- 敵人模板 ID（enemyTemplateId: string）：指定敵人類型（如普通敵人、Boss）
- 隨機種子（seed: string）：確保生成可重現性

### 主要輸出

- 敵人實例（IEnemyInstance）：包含屬性、裝備遺物和大招的完整敵人物件
- 錯誤資訊（EnemyGeneratorError）：生成失敗時的領域錯誤

## 元件盤點

### 核心元件

- EnemyGenerator：主協調器，整合子生成器並處理生成請求。負責錯誤處理和資源清理。

### 生成器元件

- AttributeGenerator：屬性生成器，根據難度係數和模板計算敵人基礎屬性（如 HP、攻擊力）。支援固定模板與動態調整。
- EquipmentAssigner：裝備分配器，從 ItemGenerator 獲取裝備實例並分配給敵人。根據難度決定裝備槽位填充率。
- RelicAssigner：遺物分配器，類似裝備分配器，處理遺物堆疊邏輯。
- UltimateSelector：大招選擇器，根據敵人模板和大招池選擇終極技能。支援難度調整（如強化版本）。

### 模板元件

- IEnemyTemplate：敵人模板介面，定義敵人類型、屬性範圍、裝備槽位和大招池。作為靜態配置，支援註冊表管理。
- EnemyTemplateRegistry：敵人模板註冊表，提供模板查詢和註冊功能。

### 工具元件

- DifficultyAdjuster：難度調整器，應用難度係數到屬性、裝備和大招。使用線性或指數公式確保平衡。
- RandomUtil：隨機工具，基於種子生成可重現的隨機數。

## 模組依賴誰?或被誰依賴?

### 依賴的模組

- DifficultyScaler：提供難度係數，調整敵人生成參數
- ItemGenerator：生成裝備和遺物實例，分配給敵人

### 被依賴的模組

- Combat：戰鬥系統，依賴敵人實例參與戰鬥
- Run：運行模組，依賴敵人生成填充遭遇節點

## 設計建議與參考

### 敵人設計原則

- 敵人與玩家共享角色系統：使用相同屬性、裝備、遺物和大招結構，確保一致性。敵人實例可視為特殊玩家角色，簡化邏輯重用。
- 固定 vs 動態平衡：大招、裝備和遺物基於模板固定，但數值由難度係數調整。避免過度隨機化，保持遊戲可預測性。
- 參考同款遊戲：如《Slay the Spire》或《Hades》，敵人通常有固定能力但隨難度強化。建議敵人模板定義為「敵人職業」，類似玩家職業，但專注於對抗邏輯。

### 實作建議

- 模板優先：先定義敵人模板（JSON 配置），包含屬性基線、裝備池和大招列表。生成時應用難度倍率。
- 擴充性：支援敵人變體（如精英版本），透過模板繼承或標籤系統。
- 測試重點：確保難度調整公式平衡，避免敵人過強或過弱。使用單元測試驗證生成一致性。
