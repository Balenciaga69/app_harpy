{
  "reportDate": "2025-12-26",
  "repository": "app_harpy/packages/backend",
  "scanPath": "src/",
  "statistics": {
    "filesScanned": 82,
    "classesWithDocstring": "34.6%",
    "methodsWithDocstring": "41.8%",
    "filesOver500Lines": 0,
    "filesWithDocstring": "63.4%",
    "averageFileSize": 34,
    "healthyRange": {
      "start": 200,
      "end": 500
    }
  },
  "fileSizeAnalysis": {
    "under200Lines": {
      "count": 71,
      "percentage": "86.6%",
      "status": "✓ Good - Files are well-segmented"
    },
    "between200and500": {
      "count": 11,
      "percentage": "13.4%",
      "status": "✓ Acceptable - Some consolidation possible"
    },
    "over500Lines": {
      "count": 0,
      "percentage": "0%",
      "status": "✓ Excellent - No files exceed size limit"
    }
  },
  "largestFiles": [
    {
      "name": "StashService.ts",
      "path": "application/stash/service/",
      "lines": 186,
      "directory": "application",
      "status": "✓ HEALTHY (186 lines)",
      "docstringQuality": "HIGH - Well documented with JSDoc for all methods"
    },
    {
      "name": "GameConfigAssembler.ts",
      "path": "application/core-infrastructure/static-config/assembler/",
      "lines": 94,
      "directory": "application",
      "status": "✓ OPTIMAL",
      "docstringQuality": "GOOD - Clear class-level documentation"
    },
    {
      "name": "RunInitializationService.ts",
      "path": "application/run-lifecycle/service/",
      "lines": 131,
      "directory": "application",
      "status": "✓ HEALTHY",
      "docstringQuality": "MEDIUM - Missing method-level JSDoc"
    },
    {
      "name": "ItemStore.ts",
      "path": "application/core-infrastructure/static-config/store/",
      "lines": 65,
      "directory": "application",
      "status": "✓ OPTIMAL",
      "docstringQuality": "MEDIUM"
    },
    {
      "name": "UnitStatAggregate.ts",
      "path": "domain/stats/",
      "lines": 44,
      "directory": "domain",
      "status": "✓ OPTIMAL",
      "docstringQuality": "LOW - Lacks documentation"
    }
  ],
  "priorityIssues": {
    "domain": [
      {
        "file": "Enemy.ts",
        "path": "domain/entity/",
        "lines": 22,
        "issues": ["缺少方法級 Docstring", "業務邏輯規則需要補充說明"],
        "severity": "MEDIUM",
        "recommendation": "為 Enemy 類和相關方法添加業務邏輯說明"
      },
      {
        "file": "UnitStatAggregate.ts",
        "path": "domain/stats/",
        "lines": 44,
        "issues": ["缺少類別和方法 Docstring", "複雜運算邏輯缺乏註解說明"],
        "severity": "MEDIUM",
        "recommendation": "添加統計聚合邏輯的詳細說明文檔"
      },
      {
        "file": "Stash.ts",
        "path": "domain/stash/",
        "lines": 72,
        "issues": ["缺少邊界條件說明", "業務規則檢查方法需要更詳細的文檔"],
        "severity": "LOW",
        "recommendation": "為容量管理和物品檢驗邏輯補充說明"
      }
    ],
    "application": [
      {
        "file": "EnemyFactory.ts",
        "path": "application/content-generation/factory/",
        "lines": 66,
        "issues": ["缺少方法級 Docstring", "TODO 註解表示邏輯不完整", "複雜創建邏輯缺乏說明"],
        "severity": "HIGH",
        "recommendation": "完成 TODO 任務並補充方法文檔"
      },
      {
        "file": "RunInitializationService.ts",
        "path": "application/run-lifecycle/service/",
        "lines": 131,
        "issues": ["缺少主要方法的 JSDoc", "初始化流程的邊界條件未明確"],
        "severity": "MEDIUM",
        "recommendation": "補充 initialize() 和 buildContexts() 方法的詳細文檔"
      },
      {
        "file": "ItemRollService.ts",
        "path": "application/item-generation/service/",
        "lines": 30,
        "issues": ["骰選流程複雜但文檔簡略", "缺少參數和返回值的詳細說明"],
        "severity": "MEDIUM",
        "recommendation": "補充骰選流程的業務邏輯文檔"
      },
      {
        "file": "ItemModifierAggregationService.ts",
        "path": "application/item-generation/service/",
        "lines": 57,
        "issues": ["私有方法的業務邏輯需要更詳細的說明", "閾值常數 (threshold=5) 缺乏說明"],
        "severity": "LOW",
        "recommendation": "補充修飾符聚合算法的詳細註解"
      },
      {
        "file": "ItemConstraintService.ts",
        "path": "application/item-generation/service/",
        "lines": 47,
        "issues": ["複雜驗證邏輯的說明不足"],
        "severity": "LOW",
        "recommendation": "補充約束驗證規則的文檔"
      }
    ],
    "infra": [
      {
        "file": "InternalEnemyConfigLoader.ts",
        "path": "infra/loader/",
        "lines": 14,
        "issues": ["配置加載邏輯說明簡略"],
        "severity": "LOW",
        "recommendation": "補充加載和轉換過程的文檔"
      }
    ]
  },
  "examples": {
    "excellentDocumentation": [
      {
        "file": "StashService.ts",
        "reason": "所有主要方法都有完整的 JSDoc，包含副作用和邊界條件說明",
        "example": "/**\n * 根據操作日誌更新玩家背包內容，並進行合法性驗證。\n * - 副作用：更新背包內容和角色遺物。\n * - 邊界條件：\n *   - 背包容量不得超過限制。\n *   - 操作日誌必須合法。\n *   - characterId 必須對應有效的角色。\n */"
      },
      {
        "file": "DifficultyHelper.ts",
        "reason": "詳細的演算法說明和線性插值邏輯註解",
        "example": "/**\n * 根據章節, 關卡與是否為無盡模式計算難度係數\n * ...(詳細的計算邏輯說明)"
      }
    ],
    "missingDocstringExamples": [
      {
        "file": "EnemyFactory.ts",
        "issue": "關鍵方法缺少 JSDoc",
        "code": "const createRandomOne = (appCtx: IAppContext) => { ... }",
        "recommended": "/** 根據應用上下文隨機生成敵人實例，包含難度調整 */\nconst createRandomOne = (appCtx: IAppContext) => { ... }"
      },
      {
        "file": "UnitStatAggregate.ts",
        "issue": "複雜計算邏輯缺乏說明",
        "code": "function computeAggregatedValue(base: number, mods: UnitStatModifier[]): number { ... }",
        "recommended": "/**\n * 聚合基礎值和所有修飾符，應用加成和倍增效果\n * - 先計算加法修飾符總和\n * - 再應用乘法修飾符\n * - 邊界：最終值不得低於 0\n */"
      }
    ],
    "excessiveInlineCommentsExamples": [
      {
        "file": "DifficultyHelper.ts",
        "issue": "線性插值部分有大量步驟註解（第 25-30 行）",
        "ratio": "約 50% 的行是註解",
        "recommendation": "可提取為 calculateEndlessModeDifficulty() 函數以提高可讀性"
      }
    ],
    "inconsistentNaming": [
      {
        "category": "簡約命名",
        "examples": ["ctx (應為 context)", "mod (應為 modifier)", "char (應為 character)", "repo (應為 repository)"],
        "recommendation": "統一使用完整名稱以提高代碼可讀性"
      },
      {
        "category": "類似命名容易混淆",
        "examples": [
          "IStashService vs IInternalStashService (用戶版 vs 內部版)",
          "itemTemplateId vs templateId (在不同上下文中縮寫程度不同)"
        ],
        "recommendation": "在命名時明確區分用途和作用域"
      }
    ]
  },
  "recommendations": {
    "priority1_Critical": [
      {
        "title": "完成 EnemyFactory 中的 TODO 任務",
        "urgency": "HIGH",
        "affectedFiles": ["EnemyFactory.ts"],
        "action": "搜尋並完成所有 'TODO' 標記，補充錯誤處理邏輯"
      },
      {
        "title": "為所有 Service 類補充完整 JSDoc",
        "urgency": "HIGH",
        "affectedFiles": ["RunInitializationService.ts", "ItemRollService.ts", "ItemModifierAggregationService.ts"],
        "action": "為所有公開方法添加 JSDoc，說明：參數含義、返回值、副作用、邊界條件"
      }
    ],
    "priority2_Important": [
      {
        "title": "統一簡略變數名稱",
        "urgency": "MEDIUM",
        "scope": ["整個 application 層"],
        "examples": {
          "current": "ctx, mod, char, repo, conf",
          "recommended": "context, modifier, character, repository, config"
        },
        "action": "建立命名規範文檔並逐步重構"
      },
      {
        "title": "補充複雜業務邏輯的詳細註解",
        "urgency": "MEDIUM",
        "affectedFiles": ["UnitStatAggregate.ts", "ItemModifierAggregationService.ts", "ItemConstraintService.ts"],
        "action": "為統計聚合、修飾符應用、約束驗證添加詳細說明"
      },
      {
        "title": "補充邊界條件和副作用說明",
        "urgency": "MEDIUM",
        "affectedFiles": ["Stash.ts", "Character.ts", "Enemy.ts"],
        "action": "按 StashService 的文檔風格為領域對象補充說明"
      }
    ],
    "priority3_Enhancement": [
      {
        "title": "提取重複的驗證邏輯",
        "urgency": "LOW",
        "affectedFiles": ["ItemConstraintService.ts"],
        "action": "檢查是否有重複的驗證邏輯可提取為通用函數"
      },
      {
        "title": "補充配置加載邏輯的說明",
        "urgency": "LOW",
        "affectedFiles": ["GameConfigAssembler.ts", "所有 *ConfigLoader"],
        "action": "補充配置流程和數據轉換的文檔"
      }
    ]
  },
  "bestPractices": {
    "observed": [
      {
        "practice": "業務邏輯和邊界說明",
        "example": "StashService - 每個方法都清楚說明副作用和邊界條件",
        "adoption": "65% 的 service 類已採用"
      },
      {
        "practice": "介面優先設計",
        "example": "IStashService, IInternalStashService 分離用戶和內部 API",
        "adoption": "70% 的 service 已遵循"
      },
      {
        "practice": "依賴注入",
        "example": "通過 constructor 注入必要的 repository 和 service",
        "adoption": "95% 的 service 已實現"
      }
    ],
    "missingBestPractices": [
      {
        "practice": "統一的文檔風格",
        "issue": "不同文件的 JSDoc 風格和詳細程度不一致",
        "recommendation": "建立公司級的 JSDoc 規範"
      },
      {
        "practice": "TODO 追蹤",
        "issue": "存在多個 'TODO: 拋領域錯誤' 的占位符，未清楚追蹤",
        "recommendation": "使用 Issue 系統追蹤待完成的任務"
      },
      {
        "practice": "複雜算法的單元測試",
        "issue": "難度計算和修飾符聚合邏輯缺少測試用例",
        "recommendation": "為關鍵業務邏輯補充單元測試和邊界用例"
      }
    ]
  },
  "summary": {
    "overallQuality": "GOOD (77/100)",
    "strengths": [
      "✓ 文件大小控制良好 - 86.6% 文件在 200 行以下",
      "✓ 主要服務類有完整文檔 - StashService 是優秀範例",
      "✓ 依賴注入設計清晰 - 易於測試和擴展",
      "✓ 業務邏輯分層明確 - domain/application/infra 職責清晰"
    ],
    "weaknesses": [
      "✗ 約 35% 的類缺少主要說明",
      "✗ 約 58% 的方法缺少 JSDoc",
      "✗ 存在多個 TODO 標記未追蹤",
      "✗ 簡略變數名稱降低可讀性 (ctx, mod, char)",
      "✗ 邊界條件和副作用說明不夠一致"
    ],
    "estimatedEffort": {
      "criticalFixes": "2-3 天",
      "importantImprovements": "1 週",
      "fullOptimization": "2-3 週"
    }
  },
  "nextSteps": [
    {
      "order": 1,
      "task": "完成 EnemyFactory 中的 TODO 任務",
      "owner": "Backend Team",
      "deadline": "本週"
    },
    {
      "order": 2,
      "task": "為 service 層補充完整 JSDoc（以 StashService 為範本）",
      "owner": "Backend Team",
      "deadline": "2 週內"
    },
    {
      "order": 3,
      "task": "建立代碼文檔規範文檔",
      "owner": "Tech Lead",
      "deadline": "1 週內"
    },
    {
      "order": 4,
      "task": "統一變數命名風格",
      "owner": "Team Lead",
      "deadline": "持續重構"
    },
    {
      "order": 5,
      "task": "為複雜業務邏輯補充單元測試",
      "owner": "QA/Backend",
      "deadline": "1 月內"
    }
  ]
}
