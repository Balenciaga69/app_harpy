# 異常狀態設計概述

## 語意級

### 靜態模板設計

- 名稱、ID、類型。
- 是否可疊加，最大/最小疊層。
- 是否可被清除。
- 行為規則（效果模組）。
- 通用資料結構（如 JSON），供所有遊戲內容引用。
- 遊戲啟動或戰鬥加載時載入，內容靜態不變。
- 每個狀態（如 Chill）需有完整靜態定義。

### 狀態實例設計

- 套用目標（entity/生物）。
- 當前疊層（currentStack）。
- 狀態來源（source）。
- 儲存於角色戰鬥 Context。
- 狀態賦予時創建對應實例。

## 架構級

### 狀態處理流程

- 每 Tick 步驟：
  - 觸發狀態效果。
  - 清除過期/可移除狀態。
  - 聚合所有異常狀態對 stat 的影響。

### 為何不採用類別處理器

- 若用類別處理器，需遍歷所有處理器，效率低。
- 新增狀態需改核心代碼，維護成本高。

## 代碼級

### Affix 附加狀態設計

- 執行行為（effectModule/action，如 APPLY_STATUS）。
- 明確指定觸發時機與效果。

### Affix 運作流程（以冰緩為例）

1. 事件觸發：攻擊事件命中敵人時，事件管理器觸發 ON_HIT。
2. 執行詞綴行為：監聽器捕獲事件，執行 action: "APPLY_STATUS"，呼叫 Status System 的 ApplyStatusEffect。
