# Shop（商店）

## 語意級

### 主要功能

- 購買：
  - 玩家可從商店購買物品
  - 觸發金幣扣除、物品加入倉庫等系統
- 出售：
  - 玩家可將物品賣給商店
  - 出售後獲得金幣，物品從倉庫移除
- 商店刷新：
  - 刷新可能需消耗資源或金幣
  - 刷新時，後端立即生成新物品列表並鎖定，視覺動畫（Roulette）只是前端效果

## 架構級

### 子系統：商店交易系統（Trade System）

- 維護當前物品列表與狀態（已購買、已售出、可刷新等）
- 定價系統：
  - 隨難度提升，價格根據係數增加
  - 支援特價活動，部分物品可臨時降價
- 交易協調：
  - 買賣行為涉及：商店生成物品、倉庫存取、金幣更新
  - 交易系統作為防腐層（ACL），保護核心邏輯不受外部變動影響
  - 買賣規則變更時僅需修改交易系統
- 交易流程：
  - 玩家發起買賣請求
  - 交易系統協調金幣、倉庫、商店三方操作
  - 完成交易後回饋結果給玩家
- 交易原子性：
  - 由外部 Transaction 系統處理（本專案不負責實作細節，另在 DynamoDB 專案中實作）

## 前端視覺上

- 商店的刷新本身要像是 Roulette 旋轉調出的結果，視覺效果吸引人
- 實際上，後端在動畫開始前就已經生成並鎖定物品列表，動畫只是視覺效果，不會改變後端結果

## 多設備同步

- 商店狀態為唯一權威且版本一致
- 多設備登入時，當舊的購買請求到達時，會被拒絕並回傳最新狀態給客戶端
