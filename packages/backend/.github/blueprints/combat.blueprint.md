## Combat

## 戰鬥極度繁雜

- 基於 Tick 輪作
- 每個 Tick 下事件的處理順序是嚴格定義的。
- 同 Tick 下，假設我將被攻擊致死，但我又有滿血恢復事件會觸發。不能每次處理結果不同。
- 處理所有瞬發的戰鬥事件，通常以事件隊列/連鎖/管道等等方式確保事件發生順序
- 處理狀態(Buff,DeBuff,回血,回魔)等等
- 重新聚合屬性(HP,魔力,攻擊速度提升)
- 寫入日誌(放置遊戲類)/返回前端(即時戰鬥類)
- 所有戰鬥邏輯都在伺服器上的單一主執行緒以同步方式執行，程式碼總是從上到下按照預定的階段順序執行。
- 同Tick下 每個行為都會被轉換成 Event 物件進入 Queue 排隊

## 每 Tick 下

- (攻擊、放技能)將 Tick 所有行動轉換成 Event 物件 塞入 Queue
- (Queue)Sync 按順序處理 Queue 事件(傷害計算、命中判定、即時 HP/MP 扣除等等)
- (狀態系統) 處理狀態
- 聚合最終屬性 Stat
- 生物狀態(誰死了，誰還活著)

## 被哪些系統影響(也就是我可能會拆成這幾套系統甚至更細，全部合在一起才叫做戰鬥系統)

- (我們假設我們玩的是TFT，無法在戰鬥時人為操控，且會自動攻擊與施放技能)
- Tick 系統
- 角色 與 屬性聚合系統(在 tick 結束前，為所有戰鬥行為（如命中判定、傷害輸出）提供最權威的數值。)
- 狀態處理系統(Buff,Debuff,Aura,或單純的指示器)等等持續性的 Stat 變化
- 攻擊與技能系統
- 戰鬥傷害與防禦應對系統

## 一些雜談

- 瞬發的戰鬥事件 他將會是一個 Damage Event ，且被 傷害解析管道系統 處理成最終值，分成多個階段，每個階段參與的監聽的效果將會被處理
