# Item (物品)

## 語意級 (設計師閱讀)

### 系統概述

物品系統分類繁多, 主題可拆分多套 (暫定八套以上)

物品包含:

- 掉落池:物品可用池
- 原型 (Template):靜態定義
- 實例 (Instance):運行時實例
- 生成流程:直接使用模板中的 affixes 清單

### 詞綴與物品的關係

- 詞池已固定 (詞綴綴定在模板中)
- 物品模板由 affixes 清單預先綁定
- 實例化時直接使用模板中的清單, 無需 roll 或動態選擇

### 數值調整與難度係數

- 物品, 裝備的 affix 數值會根據「難度係數倍率」進行調整
- 物品實例化時, 會根據當前關卡或遊戲進度帶入難度係數, 計算最終 affix 數值
- 這讓同一物品模板在不同進度下有不同強度, 提升遊戲平衡與多樣性

#### Relic (遺物)難度係數設計

- Relic Affix 難度係數倍率應設為 -1 或 0 (不應用難度係數)
- 設計理由:
  - Relic 設計風格傾向規則性疊加, 而非純數值成長
  - Relic 通常提供機制增強或觸發條件, 其效果應保持穩定, 不隨難度改變倍率
  - 避免 Relic 在高難度時過度強勢或過度弱勢
  - 示例:「每層冰緩攻擊力 +5%」這類規則, 應維持固定效果而非按難度倍數增長

## 架構級

### 物品配置 (Item Template)

靜態定義, 由設計師配置 包含物品的所有靜態屬性與綁定詞綴:

- 名稱, 類型, 稀有度, 裝備槽位
- 是否可堆疊, 綁定詞綴陣列, 獨特效果
- 配置檔 (JSON)形式存儲所有靜態屬性與詞綴列表

### 物品實例 (Item Instance)

運行時物品, 真正存在倉庫或裝備身上:

- `itemTemplateId`:指向對應的物品配置
- `affixes`:由配置預定義的詞綴實例陣列 (`AffixInstance[]`)
- 序列化存入存檔, 反序列化時復原完整狀態

### 物品生成系統

物品生成分為多個環節, 逐步構建最終實例:

1. **配置載入**:解析設定, 讀取物品配置檔
2. **基底選擇**:根據物品等級, 類型從配置池選擇合適的物品基底
3. **詞綴綁定**:直接從物品配置中讀取預定義的詞綴列表
4. **實例化**:創建 `ItemInstance`, 附加所有詞綴實例
5. **特殊處理**:處理詞綴對戰鬥事件的影響

### 遺物與裝備

兩者都是物品系統的組成部分, 但設計風格與規則有所不同:

- **裝備 (Equipment)**
  - 有穿戴限制, 每個槽位限一種裝備
  - 詞綴數值隨難度係數動態調整
  - 代表玩家戰鬥力的核心成長方式
- **遺物 (Relic)**
  - 設計風格傾向規則性疊加而非純數值成長 (參考《Risk of Rain 2》設計)
  - 詞綴數值不受難度係數影響, 維持固定規則
  - 通常提供機制增強或條件觸發, 改變玩法而非單純提升數值
- 兩者皆能改變玩法或補足屬性缺口

## 代碼級

### 物品行為與屬性聚合

物品在戰鬥或裝備時的處理流程:

- 監聽器根據詞綴效果觸發特殊行為
- 屬性聚合系統提取 `AffixInstance`, 解析為 `StatModifier`
- 將修飾符應用到最終的戰鬥或面板數值計算中

### 資料快取與同步

若採用 Redis 快取層:

- 避免頻繁查詢低速資料庫
- 玩家完整角色數據包 (含物品, 裝備, 遺物)存於快取層
- 確保多設備登入時資料一致性

### 詞綴實例的生命週期

- **綁定**:物品配置包含預定義的詞綴組合列表
- **實例化**:創建物品實例時直接使用該組合, 無動態 roll
- **運行時**:詞綴實例化為 `AffixInstance`, 戰鬥中作為 `Modifier` 來源
- **持久化**:戰鬥後詞綴保留在物品實例中, 存入存檔
