## Item

### 物品與詞綴系統

- 體系龐大 分類繁多 可能有八套以上主題拆分系統(暫時粗略劃分)
- 物品 掉落池、原型、實例、生成
- 詞綴 掉落池、定義、實例、生成

### 物品原型 (Item Template)

- 定義物品在被創造之前的靜態數據和行為規則
- 名稱、類型、稀有度、裝備槽位、它是否可以被堆疊？可能的詞綴？獨特傳奇效果的具體邏輯？
- 最大工作量會出現在設定檔，一個 JSON 物件定義了該物品的所有靜態屬性和詞綴列表。

### 物品實例 (Item Instance)

- 真正被放在倉庫、裝備身上的
- ItemInstance 會被序列化存入存檔系統，下次使用再返序列化回來

### 物品生成系統

- 包含實例化系統、骰出詞綴(詞綴 Instance 系統)。
- 實例化系統只負責解析和執行這些數據定義的規則。
- 靜態數據與動態邏輯嚴格分離。基礎範本定義、詞綴池定義。
- 首先 藍圖載入與實例創建 > 數值滾動 > 處理特殊行為模組(詞綴不會直接影響單純的屬性數值，而是會影響戰鬥事件的處理邏輯)

### 戰鬥時或被裝備時

- 就兩套系統在運作: 事件監聽不同時機點與屬性聚合
- 如果有特殊觸發行為，戰鬥系統中預先設置一個監聽器，當 XXXX 這個事件發生時，監聽器會通知物品實例執行它的特殊效果邏輯。
- 當玩家裝備上物品後，屬性聚合系統會提取裝備上的詞綴轉化為可以被帶入戰鬥或面板顯示的數值。

### 物品就兩種身分

- 在倉庫或商店內就是一種數據容器(被動的數據表現)
- 在戰鬥中被當成一種詞綴的擁有者，會被提取每個詞綴的功用真正運用在戰鬥上

### 物品的 meta data

- 它是除了數值效果以外，所有其他影響物品行為、視覺和規則的靜態信息。
- 基礎型(啥名字、長怎樣)、規則型(可以堆疊嗎?可以賣掉嗎?)、用於生成型(詞綴池、詞綴數量)

#### 某些小事

- (假設我們有用 Redis)，為了避免每次操作都去查詢緩慢的資料庫，系統可能會將玩家的完整角色數據包存放在快取中。當玩家的裝備發生變化時，系統會先更新記憶體中的實例，然後更新快取，最後再擇機將更新寫入資料庫

## 詞綴

### 是甚麼?

- Modifier: 戰鬥中或真的要被運算時候的修飾符
- Affix: 藍圖上設定好的詞綴'
- 一個 Affix 可能會衍伸出多個 Modifiers (同時補HP又加暴擊)

### 結構大概長怎樣?

- 每個詞綴，不論是存在於物品範本或物品實例中，都會被定義為一個獨立的數據結構
- 影響的屬性 ／ 透過Added,Multi,More運算 ／ Rolled後的Value ／ 生效條件(例如低於50%魔力)／TAGs／生成限制(Requirements 等級、關卡門檻等等)

### 詞綴表(這張表定義了單一詞綴的所有靜態屬性。)

- 有 ID/Tags/MinMaxRange/CalcType(加乘)/TargetStat(生命、攻擊速度等等)/等等更多

### 詞綴池表

- 這張表定義了哪些詞綴出現的概率
- 詞綴ID/抽中weight/哪個物品會可以抽到affix(ItemTemplate)

### 怎麼生成?

- 從詞綴池中撈出符合條件的Affixes
- 撈出排他 Exclusion Group 防止已經有攻擊速度又再加上攻擊速度
- Weight 抽出來 Roll，塞到 Item Instance 上
