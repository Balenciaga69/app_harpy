## Item

### 系統概述

- 物品系統分類繁多，主題可拆分多套（暫定八套以上）
- 物品內容：
  - 掉落池、原型（Template）、實例（Instance）、生成流程
- 詞綴內容：
  - 掉落池、定義、實例、生成流程

### 物品原型（Item Template）

- 定義靜態數據與行為規則：
  - 名稱、類型、稀有度、裝備槽位、可否堆疊、可能詞綴、獨特效果
- 設定檔（JSON）定義所有靜態屬性與詞綴列表

### 物品實例（Item Instance）

- 真正放在倉庫/裝備身上的物品
- 會序列化存入存檔，返序列化還原

### 物品生成系統

- 實例化系統：解析數據定義，分離靜態與動態邏輯
- 詞綴生成系統：骰出詞綴，定義範本與詞綴池
- 生成流程：
  1. 藍圖載入與實例創建
  2. 數值滾動
  3. 處理特殊行為模組（詞綴影響戰鬥事件，不直接改屬性數值）

### 物品行為與屬性聚合

- 戰鬥或裝備時：
  - 事件監聽、屬性聚合系統同時運作
  - 監聽器觸發特殊效果
  - 屬性聚合系統提取詞綴，轉為戰鬥/面板數值

### 物品的兩種身分

- 倉庫/商店內：數據容器（被動）
- 戰鬥中：詞綴擁有者，詞綴功能實際運用

### 物品 meta data

- 除數值效果外，所有影響行為、視覺、規則的靜態資訊：
  - 名稱、外觀、可否堆疊、可否賣掉、詞綴池、詞綴數量

### 數據快取與同步

- 若用 Redis，避免頻繁查詢慢速資料庫：
  - 玩家完整角色數據包存於快取
  - 裝備變化時，先更新記憶體，再同步快取，最後寫入資料庫

## 詞綴（Affix/Modifier）

### 詞綴定義

- Modifier：戰鬥或運算時的修飾符
- Affix：藍圖設定的詞綴，一個 Affix 可衍生多個 Modifier（如同時補 HP 又加暴擊）

### 詞綴結構

- 每個詞綴為獨立數據結構，存在於範本或實例
- 結構內容：
  - 影響屬性、運算方式（Added, Multi, More）、Rolled Value、生效條件（如低於 50% 魔力）、TAGs、生成限制（如等級、關卡門檻）

### 詞綴表（Affix Table）

- 定義單一詞綴所有靜態屬性：ID、Tags、MinMaxRange、CalcType、TargetStat 等

### 詞綴池表（Affix Pool Table）

- 定義詞綴出現概率：詞綴 ID、抽中 weight、可抽 affix 的 ItemTemplate

### 詞綴生成流程

1. 從詞綴池撈出符合條件的 Affix
2. 檢查排他（Exclusion Group，防止重複）
3. 根據 Weight 抽出並 Roll
4. 將詞綴塞到 Item Instance
