# Item（物品）

## 語意級

### 系統概述

物品系統分類繁多，主題可拆分多套（暫定八套以上）。

物品包含：

- 掉落池：物品可用池。
- 原型（Template）：靜態定義。
- 實例（Instance）：運行時實例。
- 生成流程：詞綴組合選擇機制。

### 詞綴與物品的關係

- 詞池已固定（詞綴綴定在模板中）。
- 物品模板由 affixes 清單預先綁定。
- 實例化時直接使用模板中的清單。

## 架構級

### 物品模板（Item Template）

靜態定義包括：

- 名稱、類型、稀有度、裝備窗位。
- 可否堆疊、綁定詞綴陣列、獨特效果。
- 設定檔（JSON）定義所有靜態屬性與詞綴清單。

### 物品實例（Item Instance）

真正存在倉庫/裝備身上的物品：

- itemTemplateId：指向物品模板。
- affixes：由模板預定義的詞綴實例陣列。
- 序列化存入存檔，返序列化還原。

### 物品生成系統

流程層次：

1. 實例化系統：解析設定，讀取模板。
2. 詞綴上載系統：直接從模板中的詞綴。
3. 生成流程：
   - 藍圖載入與實例創建。
   - 根據物品等級、類型從模板池時選擇物品基底。
   - 讀取該基底的詞綴。
   - 處理特殊行為模組（詞綴影響戰鬥事件）。

### 遺物與裝備

- 底層都被視為物品。
- 裝備：有穿戴限制，每個 Slot 限一種。
- 遺物：設計偏向疊屬性或疊機制（類似 Risk of Rain 2）。
- 各自能改變玩法或補足屬性。

## 代碼級

### 物品行為與屬性聚合

戰鬥或裝備時：

- 監聽器觸發特殊效果。
- 屬性聚合系統提取 AffixInstance，解析為 StatModifier。
- 轉為戰鬥/面板數值。

### 資料快取與同步

若用 Redis：

- 避免頻繁查詢慢速資料庫。
- 玩家完整角色數據包存於快取。

### 詞綴實例的生命週期

- 物品基底擁有預定義詞綴組合。
- 實例化時選擇其中一個組合。
- 組合內詞綴實例化為 AffixInstance。
- 戰鬥中作為 Modifier 來源。
- 戰鬥後保留在物品中。
