## 漢摩拉比法典 Relic 實作工作流程

### 階段 1: 設計師概念定義與資料輸入

設計師首先在設計文檔中記錄新 Relic 的完整規格：

- 名稱: 漢摩拉比法典
- 類型: Relic（可堆疊）
- 稀有度: 傳說級
- 最大堆疊: 99
- 效果描述:
  - 被動效果：每堆疊 +10 HP
  - 主動效果：受到攻擊時，反擊當前生命值 1% 的真實傷害給攻擊者
- 美術需求: 古老石碑造型，帶有楔形文字
- 音效需求: 反擊時播放石頭碎裂音效

設計師將這些資訊輸入到 Google Sheets 的 Relic 設計表中，包含：

- ID: `hammurabi_code`
- 平衡數值：HP 加成 = 10，傷害反彈百分比 = 0.01
- 標籤：defense, retaliation

### 階段 2: 資料結構定義與驗證

工程師根據設計規格更新相關的 TypeScript 介面和模板：

- 在 `relic-templates.ts` 中新增定義
- 確保 `IRelicDefinition` 介面支援新的效果類型
- 驗證資料完整性（所有參考的 effectTemplateId 都存在）

此階段會觸發自動化檢查，確保新 Relic 不會破壞現有系統。

### 階段 3: 效果系統實作

實作兩個獨立的效果模板：

- HP 加成效果: 屬於常駐類型，依堆疊數量疊加
- 傷害反彈效果: 屬於觸發類型，監聽受傷事件並反擊

工程師會在 Effect 系統中實作對應的邏輯，確保：

- 反擊傷害計算正確（當前 HP × 百分比 × 堆疊數）
- 傷害類型為真實傷害（True Damage）
- 不會造成無限迴圈（反擊不觸發反擊）

### 階段 4: 整合到物品生成系統

更新 ItemGenerator 模組：

- 新增漢摩拉比法典到傳說級 Relic 池
- 設定生成權重（相對稀有）
- 確保職業相容性（所有職業皆可獲得）

### 階段 5: 角色屬性計算整合

在 CharacterSheetCalculator 中加入對新 Relic 的支援：

- HP 加成自動累計到最終屬性
- 傷害反彈效果註冊到戰鬥系統

### 階段 6: 戰鬥系統整合

更新 CombatEngine 以支援新效果：

- 新增受傷事件監聽器
- 實作反擊傷害計算和應用
- 確保反擊發生在正確的戰鬥階段

### 階段 7: UI 與美術整合

美術團隊提供 Relic 圖示和動畫，前端工程師：

- 在倉庫和裝備介面中顯示新 Relic
- 實作堆疊數量顯示
- 新增反擊時的特效

### 階段 8: 平衡測試與調整

QA 團隊進行全面測試：

- 單人測試：驗證 HP 加成和反擊機制
- 多人測試：檢查在不同戰鬥情境下的表現
- 平衡測試：調整數值確保不過強或過弱

設計師根據測試結果調整：

- HP 加成可能從 10 調整為 8
- 反彈百分比可能從 1% 調整為 0.8%

### 階段 9: 部署與監控

完成實作後：

- 部署到測試環境
- 收集玩家回饋
- 監控遊戲數據（使用率、勝率影響）
- 準備熱更新修補任何發現的問題

### 關鍵技術考量

- 資料驅動設計: 所有數值都從外部配置檔案載入，便於平衡調整
- 模組化架構: 新效果不會影響現有系統，只需在 EffectFactory 中註冊
- 效能優化: 反擊計算在戰鬥引擎中高效處理，不影響前端表現
- 可測試性: 每個效果都有獨立單元測試，確保可靠性

這個流程確保了從概念到實作的完整追溯性，並維持了團隊的高效率分工。
