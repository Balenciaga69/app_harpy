# Item,Equipment,Relic

## What is an Item, Equipment, or Relic?

- 物品
  - 物品是遺物的基底。
  - 物品是有稀有度的
  - 物品沒有等級概念, 但在生成時會受到難度係數影響而有變化
  - 物品的設計是固定模板
  - 物品往往都有模板定義好的詞綴,透過 id 關聯
  - 物品是有負載值(loadCost)的
- 遺物(也是目前遊戲唯一的物品類型)
  - 遺物則是可堆疊的物品。
  - 遺物設計通常往可疊加的小功能發展或單一強力效果

## 消耗品(Consumable)

- 有些遺物被設計成消耗品
- 當裝備到身上時候會觸發不同的一次性效果事件
- 使用後該物品會被刪除
  - 例如: 技能石: 能夠替換掉玩家的大絕招。
  - 例如: 煥然一新: 能更新穿戴的所有遺物與大絕招的難度係數,使其能跟上當前遊戲難度。

## 如何獲取物品?

- 來自商店, 關卡獎勵, 事件

## 物品怎麼設計的?

- 由設計師設計物品的模板, 包含名字, 稀有度, 詞綴等等設定
- 每個物品都是來自模板, 詞綴是固定的, 並不像 DiabloLike 那樣隨機生成

## 關於稀有度

- 稀有度與難度強度無關
- 稀有度最值觀的地方在於影響物品詞綴數量
  - 普通(Common): 1 個詞綴
  - 稀有(Uncommon): 2 個詞綴
  - 史詩(Epic): 3 個詞綴
  - 傳說(Legendary): 1-3 個詞綴(但獨特)
- 稀有度會影響物品生成的機率分布
- 稀有度由設計師決定的,設計師會構思這物品該有哪些詞綴而分配到不同稀有度

## 關於物品生成

### 靜態概率表

- 來自外部定義的表格 通常由設計師定義與維護
- 內容相對單純不會因為遊戲進度改變
- 定義不同生成原因對於各種物品類型 稀有度 等等因素的生成概率分佈

### 動態概率調整

- 玩家的 RunContext 會包含物品生成骰修飾符(ItemRollModifier)
- 包含各種 (tags/templateId) 與 weight multiplier 以及 duration/permanent 標記
- 這些修飾符會持久化存放於 Run 上下文
- 有些在遊戲過程中推進時會自動添加
- 有些會在每輪一或多個物品生成前進行動態運算

### 大致流程

- [TODO:] 生成來源眾多, 目前尚未完全實裝
- 先拿靜態機率表（類型、稀有度分佈）
- 動態機率會根據玩家狀態、遺物、標籤去調整
- 生成流程分層處理（漏斗機制 Funnel）：
  - 篩選點: 決定類型（目前只有遺物）
  - 篩選點: 決定稀有度（普通／稀有／史詩／傳說）
  - 篩選點: 同稀有度下用權重抽物品
  - 篩選點: 檢查排他條件（重複、神器、堆疊上限等）
  - 篩選點: 產生最終物品
- 例子：商店刷新時，靜態分佈與玩家身上動態物品生成Weight一起算
  - 某個遺物多，該遺物機率 ++
  - 毒標籤多，毒物品權重 ++
  - MaxStack=1 已有，該物品直接排除
  - 排除表可限制任務專用、章節出現等
- 也支援直接指定 id 生成物品

## 關於物品限制表

- 我將有張靜態哈希表記錄各種限制條件
- 每次抽到物品時都要檢查:
  - 不存在於該表則無限制
  - 任務物品只能任務出現
  - 高階物品只能第三章後出現
  - 垃圾道具只會在第一章出現
  - 特定掉落物只能特定關卡出現

### POE 的物品設計思路

- 基底, 稀有度, 隨機前後綴, 插槽, 技能寶石
- 高度複雜度, 高度隨機性
- 強調無限組合與獨特性

## LOL 的物品設計思路

- 固定裝備, 固定屬性, 固定效果, 可合成
- 強調效果可預期與快速決策
