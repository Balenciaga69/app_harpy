# Item, Equipment, Relic

## What is an Item, Equipment, or Relic?

- 物品 (Item)：
  - 作為遺物的基底，具有以下特性：
    - 稀有度：每個物品都有稀有度。
    - 固定模板：物品的設計基於固定模板。
    - 無等級概念：但生成時會受到難度係數影響。
    - 標籤類型：物品擁有標籤（`tags`）以描述其特性。
    - 詞綴關聯：物品的詞綴通過模板中的 ID 定義。
    - 負載值 (loadCost)：每個物品都有負載值。
- 遺物 (Relic)：
  - 遺物是目前遊戲中唯一的物品類型，具有以下特性：
    - 可堆疊：每個遺物都有堆疊上限值。
    - 功能設計：通常設計為可疊加的小功能或單一強力效果。

## Consumables (消耗品)

- 特性：
  - 某些遺物被設計為消耗品。
  - 裝備後會觸發一次性效果，使用後物品會被刪除。
- 例子：
  - 技能石：替換玩家的大絕招。
  - 煥然一新：刷新所有遺物和大絕招的難度係數，使其適應當前遊戲難度。

## How to Obtain Items? (如何獲取物品)

- 來源：
  - 商店。
  - 關卡獎勵。
  - 事件。

## How Are Items Designed? (物品怎麼設計的)

- 設計流程：
  - 由設計師創建物品模板，包含以下內容：
    - 名稱。
    - 稀有度。
    - 詞綴等屬性。
  - 固定詞綴：每個物品的詞綴是固定的，並非隨機生成（不像 DiabloLike 遊戲）。

## 關於稀有度

- 稀有度的影響：
  - 與難度強度無關。
  - 影響物品的詞綴數量和生成機率分布。
- 詞綴數量：
  - 普通（Common）：1 個詞綴。
  - 稀有（Uncommon）：2 個詞綴。
  - 史詩（Epic）：3 個詞綴。
  - 傳說（Legendary）：1-3 個獨特詞綴。
- 設計師的角色：
  - 稀有度由設計師決定。
  - 設計師根據物品的詞綴特性分配稀有度。

---

## 關於物品生成

### 靜態概率表

- 定義：
  - 由設計師維護的外部表格。
  - 定義不同生成來源對於物品類型、稀有度等的概率分布。
- 特性：
  - 內容固定，不會因遊戲進度改變。

### 動態概率調整

- 修飾符的來源：
  - 來自玩家的 `RunContext`。
  - 包含以下屬性：
    - `tags` 或 `templateId`：影響特定標籤或模板的生成概率。
    - `weight multiplier`：調整生成概率的倍率。
    - `duration` 或 `permanent`：修飾符的持續時間。
- 修飾符的添加方式：
  - 自動添加：隨遊戲進度推進。
  - 動態運算：在每輪生成前進行計算。

### 大致流程

1. 生成來源：
   - [TODO:] 支援多種生成來源，目前尚未完全實裝。
2. 靜態機率表：
   - 根據設計師定義的靜態表格，確定物品類型和稀有度的基礎分佈。
3. 動態機率調整：
   - 根據玩家的狀態、已擁有的遺物和標籤，動態調整生成權重。
4. 分層處理（漏斗機制 Funnel）：
   - 篩選點 1：決定物品類型（目前僅支援遺物）。
   - 篩選點 2：決定稀有度（普通／稀有／史詩／傳說）。
   - 篩選點 3：在同稀有度下，根據權重抽取具體物品。
   - 篩選點 4：檢查排他條件（如重複、神器、堆疊上限等）。
   - 篩選點 5：生成最終物品。
5. 例子：
   - 商店刷新時，靜態分佈與玩家的動態物品生成權重結合：
     - 某個遺物數量多，該遺物生成機率增加。
     - 擁有毒標籤的物品數量多，毒屬性物品的生成權重增加。
     - 若某物品堆疊上限（MaxStack）已達到，則直接排除。
     - 排除表限制特定物品的生成條件（如任務專用、章節限定等）。
   - 支援直接指定 ID 生成物品。

---

## 關於物品限制表

1. 靜態哈希表：
   - 記錄各種物品的生成限制條件。
2. 檢查邏輯：
   - 若物品不在限制表中，則無限制。
   - 常見限制條件：
     - 任務物品僅能在任務中生成。
     - 高階物品僅能在第三章後生成。
     - 垃圾道具僅會在第一章生成。
     - 特定掉落物僅能在特定關卡生成。

---

### POE 的物品設計思路

- 特性：
  - 基底、稀有度、隨機前後綴、插槽、技能寶石。
  - 高度複雜性與隨機性。
- 設計目標：
  - 強調無限組合與獨特性。

---

## LOL 的物品設計思路

- 特性：
  - 固定裝備、固定屬性、固定效果、可合成。
- 設計目標：
  - 強調效果可預期與快速決策。
