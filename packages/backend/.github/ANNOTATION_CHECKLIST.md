# æ–°è¨»è§£è¦ç¯„å¯¦æ–½æª¢æŸ¥æ¸…å–®

å¿«é€Ÿåƒè€ƒï¼Œç”¨æ–¼é©—è­‰ä»£ç¢¼æ˜¯å¦ç¬¦åˆæ–°è¦ç¯„ã€‚

---

## ğŸ“‹ ä»£ç¢¼å¯©æŸ¥æ¸…å–® - æª”æ¡ˆå±¤ç´š

### **é¡åˆ¥/ä»‹é¢ï¼ˆInterfaceï¼‰**

ä½¿ç”¨æ­¤æ¸…å–®å¯©æŸ¥æ¯å€‹å…¬é–‹é¡åˆ¥æˆ–ä»‹é¢ï¼š

```
â–¡ æœ‰å–®è¡ŒåŠŸèƒ½æè¿° Docstring
  â–¡ æ ¼å¼: /** [å‹•è©] + [å°è±¡] + [ç´„æŸ/å ´æ™¯] */
  â–¡ ä¾‹: /** ç®¡ç†ç‰©å“åº«å­˜ï¼Œæ”¯æŒå®¹é‡æ“´å±•èˆ‡ç‰©å“æ“ä½œ */

â–¡ è‹¥é¡åˆ¥æ¶‰åŠè¤‡é›œé‚è¼¯ï¼Œè£œå……ã€Œè·è²¬ã€èˆ‡ã€Œé‚Šç•Œã€
  â–¡ è·è²¬: æ­¤é¡è² è²¬ä»€éº¼ï¼Ÿä¸è² è²¬ä»€éº¼ï¼Ÿ
  â–¡ é‚Šç•Œ: èˆ‡ç›¸é„°é¡åˆ¥çš„åˆ†ç•Œç·šï¼Ÿ

â–¡ è‹¥éœ€è¦åˆå§‹åŒ–åƒæ•¸èªªæ˜
  â–¡ æ˜ç¢ºå‰ç½®æ¢ä»¶ï¼ˆåƒæ•¸ç¯„åœã€æœ‰æ•ˆæ€§ï¼‰
  â–¡ æ˜ç¢ºåˆå§‹åŒ–æ˜¯å¦é©—è­‰è¼¸å…¥

â–¡ å…¬é–‹æ–¹æ³•æ˜¯å¦éƒ½æœ‰ç°¡çŸ­æè¿°ï¼ˆè¦‹ã€Œæ–¹æ³•å±¤ç´šã€ï¼‰
```

### **æ–¹æ³•/å‡½æ•¸**

å°æ¯å€‹ **å…¬é–‹æˆ–è¤‡é›œ** çš„æ–¹æ³•æª¢æŸ¥ï¼š

#### **åŸºç¤æª¢æŸ¥ï¼ˆæ‰€æœ‰å…¬é–‹æ–¹æ³•ï¼‰**

```
â–¡ æœ‰å–®è¡ŒåŠŸèƒ½æè¿° Docstring
  ç¯„ä¾‹:
  /** æ·»åŠ ç‰©å“åˆ°åº«å­˜ï¼Œè‡ªå‹•æª¢æŸ¥å®¹é‡é™åˆ¶ */
  addItem(item: ItemInstance): boolean

â–¡ è¤‡é›œæ–¹æ³•ï¼ˆ>3 è¡Œé‚è¼¯ï¼‰è£œå……é¡å¤–èªªæ˜
  â–¡ å‰¯ä½œç”¨: ä¿®æ”¹ä»€éº¼ï¼Ÿä¸ä¿®æ”¹ä»€éº¼ï¼Ÿ
  â–¡ é‚Šç•Œ: åƒæ•¸ç¯„åœï¼Ÿå‰ç½®æ¢ä»¶ï¼Ÿ
  â–¡ å›å‚³å€¼: ç‰¹åˆ¥æ˜¯ null/false/ç•°å¸¸æƒ…æ³çš„å«ç¾©
```

#### **é€²éšæª¢æŸ¥ï¼ˆè¤‡é›œæ¥­å‹™é‚è¼¯ï¼‰**

```
â–¡ æ¥­å‹™è¦å‰‡æ˜ç¢ºåŒ–
  æ ¼å¼:
  æ¥­å‹™è¦å‰‡:
  1. XXX æ“ä½œå„ªå…ˆç´šæœ€é«˜
  2. XXX æ¢ä»¶ä¸‹è¿”å›ç‰¹æ®Šå€¼
  3. XXX é ç•™ä½ç½®ç”¨æ–¼ YYY

â–¡ è¤‡é›œæ¼”ç®—æ³•çš„æ­¥é©Ÿèªªæ˜
  æ ¼å¼:
  æµç¨‹:
  1. [å‹•ä½œ] â†’ [çµæœ]
  2. [å‹•ä½œ] â†’ [çµæœ]
  3. [é‚Šç•Œæƒ…æ³è™•ç†]

â–¡ ä¾è³´é—œä¿‚æ˜ç¢ºåŒ–
  æ ¼å¼:
  ä¾è³´: æ­¤æ–¹æ³•èª¿ç”¨ XXXï¼Œå¾Œè€…è² è²¬ ZZZ
```

#### **ç°¡å–®æ–¹æ³•ï¼ˆä¸éœ€é¡å¤–èªªæ˜ï¼‰**

```
âœ“ Getter/Setter - å¦‚æœåç¨±æ¸…æ™°ï¼Œç„¡éœ€é¡å¤–èªªæ˜
âœ“ ç°¡å–®æŸ¥è©¢ - capacity() ä¸éœ€å¯«ã€Œè¿”å›å®¹é‡ã€
âœ“ æ˜ç¢ºåç¨±çš„æ“ä½œ - removeItem(id) ç„¡éœ€è©³è§£ç§»é™¤é‚è¼¯

ä½†ä»éœ€æœ‰å–®è¡Œæè¿°ï¼
```

### **å¸¸æ•¸èˆ‡åˆ—èˆ‰**

```
â–¡ æœ‰æç¤ºèªªæ˜å«ç¾©
  âœ“ const MAX_CAPACITY = 100  // ç‰©å“æ¬„æœ€å¤§æ ¼å­æ•¸
  âœ“ enum ItemRarity { COMMON, RARE, EPIC }  // ç‰©å“ç¨€æœ‰åº¦ç­‰ç´š

â–¡ æ•¸å€¼é‚Šç•Œæ˜ç¢º
  âœ“ æœ€å¤§å®¹é‡ï¼ˆç‚ºä½•æ˜¯ 100ï¼Ÿï¼‰
  âœ“ æœ€å°æœ‰æ•ˆå€¼
```

---

## ğŸ”´ å¸¸è¦‹é•åæƒ…æ³ - å¿«é€Ÿæª¢æ¸¬

### **é•å 1ï¼šéåº¦è¡Œå…§è¨»è§£**

âŒ **éŒ¯èª¤ï¼ˆä¸å¯©æŸ¥é€™æ¨£çš„ä»£ç¢¼ï¼‰ï¼š**

```typescript
for (const m of modifiers) {  // éæ­·æ‰€æœ‰ä¿®é£¾ç¬¦
  switch (m.operation) {  // æª¢æŸ¥æ“ä½œé¡å‹
    case 'ADD':  // å¦‚æœæ˜¯åŠ æ³•æ“ä½œ
      addSum += m.value  // åŠ ä¸Šå€¼åˆ°ç¸½å’Œ
      break
```

âœ… **æ­£ç¢ºï¼ˆè£œå……å‰ç½®çš„ Docstringï¼‰ï¼š**

```typescript
/**
 * è¨ˆç®—çµ±è¨ˆå€¼ï¼Œæ‡‰ç”¨ ADD â†’ MULTIPLY â†’ SET çš„å„ªå…ˆç´šé †åº
 * æ¥­å‹™è¦å‰‡: SET å„ªå…ˆç´šæœ€é«˜ï¼Œè¦†è“‹ä¹‹å‰çš„è¨ˆç®—çµæœ
 */
function computeAggregatedValue(base: number, mods: UnitStatModifier[]): number {
  let addSum = 0
  let multiplySum = 0
  let lastSet: number | undefined = undefined

  for (const m of mods) {
    switch (m.operation) {
      case 'ADD': addSum += m.value; break
      case 'MULTIPLY': multiplySum += m.value; break
      case 'SET': lastSet = m.value; break
    }
  }
```

**æª¢æ¸¬æ–¹æ³•ï¼š** å¦‚æœè¨»è§£å‡ºç¾åœ¨æ¯ä¸€è¡Œï¼Œæª¢æŸ¥æ˜¯å¦æ‡‰è©²åˆä½µç‚ºæ–¹æ³•ç´šåˆ¥çš„ Docstringã€‚

---

### **é•å 2ï¼šç¼ºå°‘å‰¯ä½œç”¨èªªæ˜**

âŒ **éŒ¯èª¤ï¼ˆå±éšªçš„æ–¹æ³•ï¼‰ï¼š**

```typescript
/** æ›´æ–°ç‰©å“åˆ—è¡¨ */
updateItems(items: ItemInstance[]): void {
  this.characterContext.items = items  // â“ æœƒä¿®æ”¹ä»€éº¼ï¼Ÿ
}
```

âœ… **æ­£ç¢ºï¼š**

```typescript
/**
 * æ›´æ–°è§’è‰²çš„ç‰©å“åˆ—è¡¨
 * å‰¯ä½œç”¨: ä¿®æ”¹ characterContext.items ç‹€æ…‹
 * é‚Šç•Œ: ä¸é©—è­‰ç‰©å“æœ‰æ•ˆæ€§ï¼ˆç”± ItemConstraintService è² è²¬ï¼‰
 */
updateItems(items: ItemInstance[]): void {
  this.characterContext.items = items
}
```

**æª¢æ¸¬æ–¹æ³•ï¼š** æ–¹æ³•ç°½åä¸­æœ‰ void æˆ–ä¿®æ”¹å…§éƒ¨ç‹€æ…‹ï¼Ÿæ·»åŠ ã€Œå‰¯ä½œç”¨ã€èªªæ˜ã€‚

---

### **é•å 3ï¼šè·¨è¶Šé˜²è…å±¤**

âŒ **éŒ¯èª¤ï¼ˆé˜²è…å±¤è¢«ç¹éï¼‰ï¼š**

```typescript
// åœ¨æŸå€‹ Service ä¸­
const runContext = appContextService.GetContexts().runContext
runContext.seed = newSeed // âŒ ç›´æ¥ä¿®æ”¹ï¼
```

âœ… **æ­£ç¢ºï¼ˆé€šéé˜²è…å±¤ï¼‰ï¼š**

```typescript
// RunContextService æä¾›é˜²è…å±¤
export class RunContextService {
  /** æ›´æ–°éŠæˆ²ç¨®å­ï¼Œé‡æ–°ç”Ÿæˆåœ°åœ– */
  updateSeed(newSeed: number): void {
    // é©—è­‰èˆ‡é‡æ–°ç”Ÿæˆé‚è¼¯é›†ä¸­åœ¨æ­¤
    this.contextService.updateSeed(newSeed)
  }
}

// å…¶ä»–åœ°æ–¹ä½¿ç”¨
runContextService.updateSeed(newSeed) // âœ“ é€šéé˜²è…å±¤
```

**æª¢æ¸¬æ–¹æ³•ï¼š** æœç´¢ `GetContexts()` æˆ– `GetConfig()`ï¼Œæª¢æŸ¥å¾ŒçºŒæ“ä½œæ˜¯å¦è¶Šç•Œä¿®æ”¹ã€‚

---

### **é•å 4ï¼šç°¡ç´„è®Šæ•¸å**

âŒ **éŒ¯èª¤ï¼š**

```typescript
const ctx = this.appContextService.GetContexts()
const cfg = this.appContextService.GetConfig()
const mods = modifiers.filter((m) => m.durationStages !== 0)
const f = m.field as keyof UnitStats
```

âœ… **æ­£ç¢ºï¼š**

```typescript
const contexts = this.appContextService.GetContexts()
const config = this.appContextService.GetConfig()
const activeModifiers = modifiers.filter((m) => m.durationStages !== 0)
const field = m.field as keyof UnitStats
```

**æª¢æ¸¬æ–¹æ³•ï¼š** é›™å­—æ¯æˆ–å–®å­—æ¯è®Šæ•¸ï¼ˆctx, cfg, mods, m, f, vï¼‰ï¼Ÿæ›¿æ›ç‚ºæ¸…æ™°åç¨±ã€‚

---

### **é•å 5ï¼šé‚Šç•Œæ¢ä»¶æœªèªªæ˜**

âŒ **éŒ¯èª¤ï¼š**

```typescript
/** æ“´å±•å®¹é‡ */
expandCapacity(newCapacity: number): boolean {
  this._capacity = newCapacity  // â“ èƒ½é™ä½å—ï¼Ÿæ–°å€¼å¯ä»¥æ˜¯è² æ•¸å—ï¼Ÿ
  return true
}
```

âœ… **æ­£ç¢ºï¼š**

```typescript
/**
 * æ“´å±•å®¹é‡ä¸Šé™
 * é‚Šç•Œ: å®¹é‡åªèƒ½å¢åŠ ä¸èƒ½æ¸›å°‘ï¼Œæ–°å€¼é ˆ > èˆŠå€¼
 * å‰¯ä½œç”¨: ä¿®æ”¹ _capacity
 * å›å‚³: true = æˆåŠŸæ“´å±•ï¼Œfalse = æ–°å€¼ä¸å¤§æ–¼èˆŠå€¼
 */
expandCapacity(newCapacity: number): boolean {
  if (newCapacity <= this._capacity) return false
  this._capacity = newCapacity
  return true
}
```

**æª¢æ¸¬æ–¹æ³•ï¼š** æ˜¯å¦æ˜ç¢ºäº†åƒæ•¸çš„æœ‰æ•ˆç¯„åœï¼Ÿæ˜¯å¦æœ‰éš±å«å‰ç½®æ¢ä»¶ï¼Ÿ

---

## âœ… å¿«é€Ÿæª¢æŸ¥ç¯„æœ¬

### **Phase 1: é¡åˆ¥æª¢æŸ¥ï¼ˆ5 åˆ†é˜ï¼‰**

```
æª”æ¡ˆ: ___________________
é¡åˆ¥: ___________________

â–¡ é¡åˆ¥æœ‰ Docstringï¼Ÿ           [ ] æœ‰  [ ] ç„¡  [ ] éœ€æ”¹é€²
â–¡ èªªæ˜è·è²¬èˆ‡é‚Šç•Œï¼Ÿ              [ ] æœ‰  [ ] ç„¡  [ ] éœ€æ”¹é€²
â–¡ è¤‡é›œæ–¹æ³•éƒ½æœ‰èªªæ˜ï¼Ÿ            [ ] æœ‰  [ ] ç„¡  [ ] éœ€æ”¹é€²
â–¡ æœ‰ç„¡ç°¡ç´„è®Šæ•¸åï¼ˆctx/cfgï¼‰ï¼Ÿ   [ ] ç„¡  [ ] æœ‰ï¼ˆéœ€æ”¹ï¼‰
â–¡ æœ‰ç„¡è·¨è¶Šé˜²è…å±¤ï¼Ÿ              [ ] ç„¡  [ ] æœ‰ï¼ˆéœ€ä¿®ï¼‰

å»ºè­°:
```

### **Phase 2: æ–¹æ³•æª¢æŸ¥ï¼ˆ10 åˆ†é˜ï¼‰**

é‡å°è¤‡é›œæ–¹æ³•è©³ç´°æª¢æŸ¥ï¼š

```
æ–¹æ³•: ___________________

â–¡ å–®è¡ŒåŠŸèƒ½æè¿°              [ ] æœ‰  [ ] ç„¡
â–¡ å‰¯ä½œç”¨èªªæ˜                [ ] æœ‰  [ ] ç„¡  [ ] N/A
â–¡ é‚Šç•Œæ¢ä»¶èªªæ˜              [ ] æœ‰  [ ] ç„¡  [ ] N/A
â–¡ å›å‚³å€¼æ˜ç¢º                [ ] æœ‰  [ ] ç„¡  [ ] N/A
â–¡ æ¥­å‹™é‚è¼¯èªªæ˜ï¼ˆè‹¥è¤‡é›œï¼‰    [ ] æœ‰  [ ] ç„¡  [ ] N/A
â–¡ æµç¨‹æ­¥é©Ÿè¨»è§£ï¼ˆè‹¥æ¶‰åŠï¼‰    [ ] æœ‰  [ ] ç„¡  [ ] N/A

é‚è¼¯è¤‡é›œåº¦: [ ] ç°¡å–® [ ] ä¸­ç­‰ [ ] è¤‡é›œ
éœ€è¦æ–‡æª”: [ ] Docstring [ ] + é‚Šç•Œèªªæ˜ [ ] + æ¥­å‹™è¦å‰‡

å»ºè­°:
```

---

## ğŸ¯ å°æ‡‰æ”¹é€²å„ªå…ˆåº¦

æ ¹æ“šæª¢æŸ¥çµæœï¼ŒæŒ‰å„ªå…ˆåº¦ä¿®æ”¹ï¼š

### **å„ªå…ˆåº¦ 1ï¼ˆç«‹å³ä¿®æ”¹ï¼‰**

```
[ ] å…¬é–‹é¡åˆ¥ç¼ºå°‘ Docstring
[ ] Service æ–¹æ³•ç„¡ã€Œå‰¯ä½œç”¨ã€èªªæ˜
[ ] é˜²è…å±¤è¢«è·¨è¶Šï¼ˆç›´æ¥ä¿®æ”¹ contextï¼‰
[ ] ç°¡ç´„è®Šæ•¸åå°è‡´èªæ„ä¸æ¸…
[ ] Null/False å›å‚³å€¼å«ç¾©æœªèªªæ˜
```

### **å„ªå…ˆåº¦ 2ï¼ˆæœ¬é€±ä¿®æ”¹ï¼‰**

```
[ ] è¤‡é›œé‚è¼¯ç¼ºå°‘æ¥­å‹™è¦å‰‡èªªæ˜
[ ] é‚Šç•Œæ¢ä»¶èªªæ˜ä¸å®Œæ•´
[ ] éåº¦è¡Œå…§è¨»è§£éœ€è¦åˆä½µç‚º Docstring
[ ] TODO è¨»è§£éœ€è¦å¯¦ç¾æˆ–å‡ç´šç‚º Issue
```

### **å„ªå…ˆåº¦ 3ï¼ˆæŒçºŒæ”¹é€²ï¼‰**

```
[ ] è£œå……ç°¡å–®æ–¹æ³•çš„é«˜å±¤è¨»è§£
[ ] å„ªåŒ–è®Šæ•¸å‘½åä¸€è‡´æ€§
[ ] çµ±ä¸€ Docstring é¢¨æ ¼
[ ] è£œå……å–®å…ƒæ¸¬è©¦çš„è¤‡é›œé‚è¼¯èªªæ˜
```

---

## ğŸ“Š æ‰¹é‡æª¢æŸ¥æŒ‡ä»¤

### **æ‰¾å‡ºç¼ºå°‘ Docstring çš„å…¬é–‹é¡åˆ¥**

```bash
# æœç´¢æ‰€æœ‰ export class/interface ä½†ç¼ºå°‘ /** çš„
grep -r "^export \(class\|interface\)" src/ | grep -v "\.ts:"
# ç„¶å¾Œæ‰‹å‹•æª¢æŸ¥å‰é¢æ˜¯å¦æœ‰ /**
```

### **æ‰¾å‡ºç°¡ç´„è®Šæ•¸å**

```bash
# æœç´¢å¸¸è¦‹ç°¡ç´„å
grep -rn "\bctx\b\|\bcfg\b\|\bmods\b\|\b[a-z]\s*:" src/ --include="*.ts"
```

### **æ‰¾å‡ºéåº¦è¡Œå…§è¨»è§£**

```bash
# æœç´¢æ¯è¡Œéƒ½æœ‰ // çš„æ®µè½
grep -A 5 "^[^/]*//.*$" src/ --include="*.ts" | grep "^[^/]*//.*$" | head -20
```

---

## ğŸ“ˆ æ”¹é€²é€²åº¦è¿½è¹¤

åœ¨é–‹ç™¼éç¨‹ä¸­è¿½è¹¤æ”¹é€²ï¼š

```
ã€ç¬¬ 1 é€±ã€‘
- [ ] Domain å±¤ 100% è£œå…… Docstring
- [ ] ç§»é™¤ç°¡ç´„è®Šæ•¸å
- [ ] è£œå……é‚Šç•Œæ¢ä»¶èªªæ˜
é€²åº¦: ___ / 100

ã€ç¬¬ 2 é€±ã€‘
- [ ] Application å±¤ Service è£œå……è¤‡é›œé‚è¼¯èªªæ˜
- [ ] å®Œæˆæ‰€æœ‰ TODO æˆ–å‡ç´šç‚º Issue
- [ ] çµ±ä¸€å‰¯ä½œç”¨æ¨™è¨˜
é€²åº¦: ___ / 100

ã€ç¬¬ 3 é€±ã€‘
- [ ] Infra å±¤è£œå……é…ç½®èªªæ˜
- [ ] PR æª¢æŸ¥æµç¨‹é›†æˆæ–°è¦ç¯„
- [ ] åœ˜éšŠåŸ¹è¨“æ–°è¦ç¯„
é€²åº¦: ___ / 100
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **å€‹äººæª¢æŸ¥** - ç”¨æ­¤æ¸…å–®å¯©æŸ¥è‡ªå·±çš„ä»£ç¢¼
2. **Code Review** - åœ¨ PR æ™‚åƒè€ƒæ­¤æ¸…å–®
3. **åœ˜éšŠåˆ†äº«** - åˆ†äº« AI_COLLABORATION_GUIDE.md
4. **è¿­ä»£æ”¹é€²** - æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´è¦ç¯„

---

## ğŸ“š åƒè€ƒæ–‡æª”

- [ANNOTATION_STRATEGY.md](./ANNOTATION_STRATEGY.md) - å®Œæ•´è¦ç¯„
- [ANNOTATION_CASE_STUDIES.md](./ANNOTATION_CASE_STUDIES.md) - å…·é«”ç¯„ä¾‹
- [AI_COLLABORATION_GUIDE.md](./AI_COLLABORATION_GUIDE.md) - AI å”ä½œæŒ‡å—
