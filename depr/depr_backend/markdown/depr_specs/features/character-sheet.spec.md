# Character-Sheet 模組

## 簡介

- 功能: 負責計算角色的完整屬性表，整合基礎屬性、裝備詞綴和遺物效果。
- 特性: 支援動態修飾器應用和屬性聚合。
- 最後更新時間: 2025-12-13。

## 輸入與輸出

### 主要輸入

- ICharacterSheetInput ： 包含基礎屬性、裝備實例和遺物實例。

### 主要輸出

- ICharacterSheet ： 包含計算後的屬性值、基礎屬性值和修飾器計數。

## 元件盤點

- CharacterSheetCalculator ： 屬性表計算器，整合所有處理器並計算最終屬性。
- EquipmentProcessor ： 裝備處理器，處理裝備詞綴並生成修飾器。
- RelicProcessor ： 遺物處理器，處理遺物效果並生成修飾器。
- AffixRegistry ： 詞綴註冊表，定義詞綴到屬性的映射。
- RelicRegistry ： 遺物註冊表，定義遺物效果計算邏輯。
- 介面層 ： 定義ICharacterSheet、ICharacterSheetCalculator等契約，確保元件間一致性。

## 模組依賴誰?或被誰依賴?

- Character-Sheet 模組依賴 attribute 模組的屬性管理器和計算器，item 模組的裝備和遺物實例，以及 definition-config 模組的詞綴和遺物定義。
- Character-Sheet 模組被 combat 模組依賴，用於戰鬥屬性計算，以及 UI 模組依賴，用於角色屬性顯示。

---

#### 角色屬性計算模組的職責

- 管理角色的基礎屬性（如攻擊力、HP、暴擊率等）。
- 根據角色身上的裝備與遺物，計算所有屬性的最終數值。
- 將裝備與遺物的詞綴（affix）或堆疊效果，轉換成屬性修飾器（AttributeModifier）。
- 支援加法、乘法等不同加成模式，並能追蹤來源（裝備/遺物）。
- 提供一個統一的計算流程，讓外部只需給定角色資料，就能得到完整的屬性表。

#### 什麼時候會用到這個模組？

- 玩家換裝備或取得新遺物時，需要即時重新計算角色所有屬性。
- 進入戰鬥前，系統要取得角色的最終屬性數值。
- UI 介面要顯示角色目前的屬性明細與來源。
- 你要 debug 某個屬性為什麼異常時，可以查詢所有加成來源與計算過程。
- 單元測試時，可以模擬不同裝備/遺物組合，驗證屬性計算是否正確。

#### 生動例子

- 玩家撿到一把「+50攻擊力」的劍，裝備上去後，這個模組會自動把劍的詞綴轉成攻擊力修飾器，加到角色屬性上。
- 玩家獲得一個「每10點最大HP給2點護甲」的遺物，這個模組會根據角色當前最大HP與遺物堆疊數，自動計算出護甲加成。
- 你想知道角色的暴擊率為什麼變高了，可以查詢所有來自裝備與遺物的暴擊率修飾器。

#### 拆解閱讀建議

- 先看 `CharacterSheetCalculator`，理解計算流程與資料流動。
- 再看 `EquipmentProcessor`、`RelicProcessor`，理解裝備與遺物如何轉成屬性修飾器。
- 最後看各種 Mapping 與 Modifier 的定義，了解加成來源與計算細節。
